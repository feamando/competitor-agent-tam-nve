
> competitor-research-agent@0.1.0 test:ci
> jest --ci --coverage --maxWorkers=2 --testTimeout=60000

‚úÖ Test database initialized
‚úÖ Global test setup complete - Phase 2 optimized
FAIL src/__tests__/integration/crossServiceValidation.test.ts
  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should integrate analysis service with report service

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      173 |         expect(reportResult).toBeDefined();
      174 |         expect(reportResult.report).toBeDefined();
    > 175 |         expect(reportResult.report.sections.length).toBeGreaterThan(0);
          |                                                     ^
      176 |         expect(reportResult.generationTime).toBeDefined();
      177 |
      178 |         logger.info('Analysis-Report integration test completed', {

      at toBeGreaterThan (src/__tests__/integration/crossServiceValidation.test.ts:175:53)
      at Object.<anonymous> (src/__tests__/integration/crossServiceValidation.test.ts:189:7)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should validate UX analyzer integration with report service

    expect(received).toBeDefined()

    Received: undefined

      259 |         // Step 2: Verify UX analysis can be used in report generation
      260 |         // This validates that the UX analyzer output format is compatible with report service
    > 261 |         expect(uxAnalysis.metadata).toBeDefined();
          |                                     ^
      262 |         expect(uxAnalysis.metadata.correlationId).toBeDefined();
      263 |         expect(uxAnalysis.metadata.analyzedAt).toBeDefined();
      264 |

      at toBeDefined (src/__tests__/integration/crossServiceValidation.test.ts:261:37)
      at Object.<anonymous> (src/__tests__/integration/crossServiceValidation.test.ts:275:7)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should validate data consistency across services

    expect(received).toBe(expected) // Object.is equality

    Expected: "Consistency Test Product"
    Received: undefined

      514 |
      515 |       // Verify report data consistency
    > 516 |       expect(reportResult.report.metadata.productName).toBe('Consistency Test Product');
          |                                                        ^
      517 |       expect(reportResult.report.metadata.competitorCount).toBe(1);
      518 |       expect(reportResult.report.metadata.analysisId).toBe(analysis.id);
      519 |

      at Object.toBe (src/__tests__/integration/crossServiceValidation.test.ts:516:56)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: API Integration Testing ‚Ä∫ should validate service configuration and initialization

    expect(received).toBe(expected) // Object.is equality

    Expected: "ComparativeAnalysisService"
    Received: "Object"

      548 |     it('should validate service configuration and initialization', async () => {
      549 |       // Verify services are properly initialized (check constructor names since Jest mocks may interfere)
    > 550 |       expect(analysisService.constructor.name).toBe('ComparativeAnalysisService');
          |                                                ^
      551 |       expect(reportService.constructor.name).toBe('ComparativeReportService');
      552 |       expect(uxAnalyzer.constructor.name).toBe('UserExperienceAnalyzer');
      553 |       expect(autoReportService.constructor.name).toBe('AutoReportGenerationService');

      at Object.toBe (src/__tests__/integration/crossServiceValidation.test.ts:550:48)

FAIL src/__tests__/unit/conversation.test.ts
  ‚óè Console

    console.log
      [DEBUG] Initializing new project, current chat state: {
        currentStep: 0,
        stepDescription: 'Welcome',
        expectedInputType: 'text',
        useComprehensiveFlow: false
      }

      at ConversationManager.log [as handleProjectInitialization] (src/lib/chat/conversation.ts:157:13)

    console.log
      [DEBUG] Initializing new project, current chat state: {
        currentStep: 0,
        stepDescription: 'Welcome',
        expectedInputType: 'text',
        useComprehensiveFlow: true
      }

      at ConversationManager.log [as handleProjectInitialization] (src/lib/chat/conversation.ts:157:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.createComprehensiveConfirmation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1146:76)
          at ConversationManager.createComprehensiveConfirmation [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1030:23)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at ConversationManager.handleStep0 (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:14)
          at ConversationManager.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:24)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:103:24)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleStep0 (src/lib/chat/conversation.ts:172:14)
      at ConversationManager.processUserMessage (src/lib/chat/conversation.ts:72:24)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:103:24)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.createComprehensiveConfirmation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1146:76)
          at ConversationManager.createComprehensiveConfirmation [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1030:23)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at ConversationManager.handleStep0 (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:14)
          at ConversationManager.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:24)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:103:24)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleStep0 (src/lib/chat/conversation.ts:172:14)
      at ConversationManager.processUserMessage (src/lib/chat/conversation.ts:72:24)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:103:24)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.handleIncompleteSubmission (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:470:76)
          at ConversationManager.handleIncompleteSubmission [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1038:19)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:137:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:137:50)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.handleIncompleteSubmission (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:470:76)
          at ConversationManager.handleIncompleteSubmission [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1038:19)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:137:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:137:50)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.handleIncompleteSubmission (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:470:76)
          at ConversationManager.handleIncompleteSubmission [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1038:19)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:169:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:169:50)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.handleIncompleteSubmission (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:470:76)
          at ConversationManager.handleIncompleteSubmission [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1038:19)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:169:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:169:50)

    console.log
      [DEBUG] Initializing new project, current chat state: {
        currentStep: 0,
        stepDescription: 'Welcome',
        expectedInputType: 'text',
        useComprehensiveFlow: true,
        collectedData: { userEmail: 'migration@company.com' }
      }

      at ConversationManager.log [as handleProjectInitialization] (src/lib/chat/conversation.ts:157:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.createComprehensiveConfirmation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1146:76)
          at ConversationManager.createComprehensiveConfirmation [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1030:23)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at ConversationManager.handleStep0 (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:14)
          at ConversationManager.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:24)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:251:24)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleStep0 (src/lib/chat/conversation.ts:172:14)
      at ConversationManager.processUserMessage (src/lib/chat/conversation.ts:72:24)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:251:24)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'collectedData')
          at ConversationManager.createComprehensiveConfirmation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1146:76)
          at ConversationManager.createComprehensiveConfirmation [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1030:23)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at ConversationManager.handleStep0 (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:14)
          at ConversationManager.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:24)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:251:24)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleStep0 (src/lib/chat/conversation.ts:172:14)
      at ConversationManager.processUserMessage (src/lib/chat/conversation.ts:72:24)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:251:24)

    console.error
      Error in comprehensive input handling: Error: Parsing failed
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:262:15)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:265:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:265:50)

    console.error
      Parsing error occurred: Error: Parsing failed
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:262:15)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:265:50)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:265:50)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:276:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:276:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:276:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:276:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:133:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:277:33)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:133:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:277:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:133:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:277:33)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:133:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:277:33)

    console.error
      Error in comprehensive input handling: Error: Failed to parse input format
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:483:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:486:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:486:52)

    console.error
      Parsing error occurred: Error: Failed to parse input format
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:483:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:486:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:486:52)

    console.error
      Error in comprehensive input handling: Error: Input too long to process
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:501:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:504:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:504:52)

    console.error
      Parsing error occurred: Error: Input too long to process
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:501:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:504:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:504:52)

    console.error
      Error in comprehensive input handling: Error: Special characters not supported
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:514:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:517:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:517:52)

    console.error
      Parsing error occurred: Error: Special characters not supported
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:514:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:517:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:517:52)

    console.error
      Error in comprehensive input handling: Error: Generic parsing error
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:525:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:528:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:528:52)

    console.error
      Parsing error occurred: Error: Generic parsing error
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:525:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at ComprehensiveRequirementsCollector.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at ComprehensiveRequirementsCollector.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:528:52)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:528:52)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.error
      Failed to create project: Error: No project requirements found in chat state
          at ConversationManager.executeProjectCreation (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1392:15)
          at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1362:19)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1256:79)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1446 |       };
      1447 |     } catch (error) {
    > 1448 |       console.error('Failed to create project:', error);
           |               ^
      1449 |       
      1450 |       return {
      1451 |         message: `‚ùå **Error Creating Project**\n\nI encountered an error while creating your project: ${error instanceof Error ? error.message : 'Unknown error'}\n\nYour information has been saved. Would you like me to:\n\n1. **Retry** - Try creating the project again\n2. **Edit** - Modify the project information\n3. **Support** - Get help with this issue\n\nPlease respond with "retry", "edit", or "support".`,

      at ConversationManager.error [as executeProjectCreation] (src/lib/chat/conversation.ts:1448:15)
      at ConversationManager.executeProjectCreation [as handleConfirmationResponse] (src/lib/chat/conversation.ts:1362:19)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1256:79)

    console.log
      [DEBUG] Initializing new project, current chat state: {
        currentStep: 0,
        stepDescription: 'Welcome',
        expectedInputType: 'text',
        useComprehensiveFlow: true
      }

      at ConversationManager.log [as handleProjectInitialization] (src/lib/chat/conversation.ts:157:13)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1578:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1578:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1578:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1578:38)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1604:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1604:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1604:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1604:38)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1629:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1629:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1629:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1629:38)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.log
      Migration offered: User selected migration option

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1865:38)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1865:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1020:76)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1865:38)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1865:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1891:38)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1891:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1891:38)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1891:38)

    console.log
      [DEBUG] Initializing new project, current chat state: {
        currentStep: 0,
        stepDescription: 'Welcome',
        expectedInputType: 'text',
        useComprehensiveFlow: false
      }

      at ConversationManager.log [as handleProjectInitialization] (src/lib/chat/conversation.ts:157:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1928:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1928:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1928:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1928:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1931:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1931:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1931:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1931:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1949:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1949:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1949:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1949:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1952:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1952:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1952:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1952:38)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1968:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1979:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1979:21)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1968:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1979:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1979:21)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1968:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1982:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1982:38)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1968:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1982:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:1982:38)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1995:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2016:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2016:21)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1995:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2016:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2016:21)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1995:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2019:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2019:38)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:1995:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2019:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2019:38)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2033:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2043:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2043:21)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2033:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2043:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2043:21)

    console.error
      Error in comprehensive input handling: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2033:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2046:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2046:38)

    console.error
      Parsing error occurred: Error: Comprehensive parsing failed
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2033:17)
          at /Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
          at Object.mockConstructor [as parseComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
          at ConversationManager.parseComprehensiveInput [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1016:60)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2046:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2046:38)

    console.log
      Migration offered: User requested migration

      at ConversationManager.log [as offerMigrationToNewFlow] (src/lib/chat/conversation.ts:2113:13)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2106:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2106:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2106:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2106:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2109:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2109:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2109:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2109:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2122:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2122:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2122:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2122:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2125:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2125:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2125:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2125:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2140:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2140:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2140:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2140:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2150:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2150:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2150:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2150:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
          at Object.map (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2176:33)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2177:23)
          at Array.map (<anonymous>)
      at Object.map (src/__tests__/unit/conversation.test.ts:2176:33)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 0)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 0)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 0)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 0)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 1)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 1)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 1)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 1)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 2)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 2)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 2)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 2)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 3)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 3)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 3)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 3)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 4)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 4)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2178:24)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at async Promise.all (index 4)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2181:25)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at processUserMessage (src/__tests__/unit/conversation.test.ts:2178:24)
          at async Promise.all (index 4)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2181:25)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2206:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2206:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2206:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2206:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2207:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2207:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2207:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2207:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2232:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2232:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2232:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2232:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2233:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2233:38)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2233:38)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2233:38)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2256:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2256:21)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:120:21)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2256:21)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as routeMessage] (src/lib/chat/conversation.ts:120:21)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2256:21)

    console.error
      Error in comprehensive input handling: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2257:50)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1039 |       
      1040 |     } catch (error) {
    > 1041 |       console.error('Error in comprehensive input handling:', error);
           |               ^
      1042 |       
      1043 |       // Phase 3.2: Graceful error recovery with helpful guidance
      1044 |       return this.handleParsingError(content, error instanceof Error ? error : new Error(String(error)));

      at ConversationManager.error [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1041:15)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2257:50)

    console.error
      Parsing error occurred: TypeError: Cannot read properties of undefined (reading 'extractedData')
          at ConversationManager.extractedData [as handleComprehensiveInput] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1021:26)
          at ConversationManager.handleComprehensiveInput [as handleStep0] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:172:25)
          at ConversationManager.handleStep0 [as handleLegacySessionRouting] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1614:21)
          at ConversationManager.handleLegacySessionRouting [as routeMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:127:19)
          at ConversationManager.routeMessage [as processUserMessage] (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:72:35)
          at Object.processUserMessage (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/conversation.test.ts:2257:50)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)

      1050 |    */
      1051 |   private handleParsingError(content: string, error: Error): ChatResponse {
    > 1052 |     console.error('Parsing error occurred:', error);
           |             ^
      1053 |     
      1054 |     let message = `üîÑ **Oops! I had trouble parsing your input.**\n\n`;
      1055 |     message += `Don't worry - this happens sometimes. Let me help you get back on track!\n\n`;

      at ConversationManager.error [as handleParsingError] (src/lib/chat/conversation.ts:1052:13)
      at ConversationManager.handleParsingError [as handleComprehensiveInput] (src/lib/chat/conversation.ts:1044:19)
      at ConversationManager.handleComprehensiveInput [as handleStep0] (src/lib/chat/conversation.ts:172:25)
      at ConversationManager.handleStep0 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1614:21)
      at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
      at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
      at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2257:50)

    console.error
      Error during comparative report generation: TypeError: Failed to parse URL from /api/reports/comparative?projectId=existing-project-123
          at fetch (/Users/nikita.gorshkov/competitor-research-agent/node_modules/undici/index.js:113:13)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at ConversationManager.handleLegacyStep4 (/Users/nikita.gorshkov/competitor-research-agent/src/lib/chat/conversation.ts:1831:30) {
        [cause]: TypeError: Invalid URL: /api/reports/comparative?projectId=existing-project-123
            at ConversationManager.fetch [as handleLegacyStep4] (src/lib/chat/conversation.ts:1831:36)
            at ConversationManager.handleLegacyStep4 [as handleLegacySessionRouting] (src/lib/chat/conversation.ts:1624:21)
            at ConversationManager.handleLegacySessionRouting [as routeMessage] (src/lib/chat/conversation.ts:127:19)
            at ConversationManager.routeMessage [as processUserMessage] (src/lib/chat/conversation.ts:72:35)
            at Object.processUserMessage (src/__tests__/unit/conversation.test.ts:2323:38)
            at new Promise (<anonymous>)
      }

      1875 |       };
      1876 |     } catch (error) {
    > 1877 |       console.error('Error during comparative report generation:', error);
           |               ^
      1878 |       
      1879 |       return {
      1880 |         message: `‚ö†Ô∏è **Report Generation Issue**

      at ConversationManager.error [as handleLegacyStep4] (src/lib/chat/conversation.ts:1877:15)
      at ConversationManager.processUserMessage (src/lib/chat/conversation.ts:72:24)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:2323:24)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Feature Flag Support ‚Ä∫ should use legacy flow when comprehensive flow is disabled

    expect(received).toBe(expected) // Object.is equality

    Expected: "text"
    Received: "comprehensive_form"

      25 |       const response = await conversationManager.processUserMessage('');
      26 |       
    > 27 |       expect(response.expectedInputType).toBe('text');
         |                                          ^
      28 |       expect(response.message).toContain('Please tell me:');
      29 |       expect(response.message).toContain('Your email address');
      30 |     });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:27:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Feature Flag Support ‚Ä∫ should respect environment variable for feature flag

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      47 |       conversationManager = new ConversationManager();
      48 |       
    > 49 |       expect(conversationManager['useComprehensiveFlow']).toBe(true);
         |                                                           ^
      50 |       
      51 |       // Cleanup
      52 |       delete process.env.ENABLE_COMPREHENSIVE_FLOW;

      at Object.toBe (src/__tests__/unit/conversation.test.ts:49:59)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle complete comprehensive submission

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      103 |       const response = await conversationManager.processUserMessage(completeInput);
      104 |
    > 105 |       expect(response.projectCreated).toBe(true);
          |                                       ^
      106 |       expect(response.nextStep).toBe(1.5);
      107 |       expect(response.message).toContain('Project Created Successfully');
      108 |       expect(response.message).toContain('Test Product');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:105:39)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle partial comprehensive submission

    expect(received).toBe(expected) // Object.is equality

    Expected: "comprehensive_form"
    Received: "text"

      138 |
      139 |       expect(response.nextStep).toBe(0);
    > 140 |       expect(response.expectedInputType).toBe('comprehensive_form');
          |                                          ^
      141 |       expect(response.stepDescription).toBe('Complete Project Setup');
      142 |     });
      143 |

      at Object.toBe (src/__tests__/unit/conversation.test.ts:140:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle invalid input with validation errors

    expect(received).toBe(expected) // Object.is equality

    Expected: "comprehensive_form"
    Received: "text"

      170 |
      171 |       expect(response.nextStep).toBe(0);
    > 172 |       expect(response.expectedInputType).toBe('comprehensive_form');
          |                                          ^
      173 |     });
      174 |   });
      175 |

      at Object.toBe (src/__tests__/unit/conversation.test.ts:172:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Error Handling ‚Ä∫ should handle project creation failure gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Error Creating Project"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      252 |
      253 |       expect(response.error).toBeDefined();
    > 254 |       expect(response.message).toContain('Error Creating Project');
          |                                ^
      255 |       expect(response.message).toContain('retry');
      256 |     });
      257 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:254:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Error Handling ‚Ä∫ should handle parsing errors gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "error processing your request"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      266 |
      267 |       expect(response.error).toBeDefined();
    > 268 |       expect(response.message).toContain('error processing your request');
          |                                ^
      269 |     });
      270 |   });
      271 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:268:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should handle parsing errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Failed to parse input format"
    Received: "Unable to parse input: Format could not be recognized"

      486 |         const response = await conversationManager.processUserMessage(malformedInput);
      487 |
    > 488 |         expect(response.error).toBe('Failed to parse input format');
          |                                ^
      489 |         expect(response.message).toContain('Oops! I had trouble parsing');
      490 |         expect(response.message).toContain('What happened: Failed to parse input format');
      491 |         expect(response.message).toContain('Use numbered list');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:488:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should provide specific guidance for long inputs

    expect(received).toContain(expected) // indexOf

    Expected substring: "Try shorter format"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      504 |         const response = await conversationManager.processUserMessage(longInput);
      505 |
    > 506 |         expect(response.message).toContain('Try shorter format');
          |                                  ^
      507 |         expect(response.message).toContain('breaking it into key points');
      508 |       });
      509 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:506:34)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should provide specific guidance for special characters

    expect(received).toContain(expected) // indexOf

    Expected substring: "Simplify formatting"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      517 |         const response = await conversationManager.processUserMessage(specialCharInput);
      518 |
    > 519 |         expect(response.message).toContain('Simplify formatting');
          |                                  ^
      520 |         expect(response.message).toContain('basic punctuation');
      521 |       });
      522 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:519:34)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should maintain conversational tone during error recovery

    expect(received).toContain(expected) // indexOf

    Expected substring: "I'm here to help!"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      528 |         const response = await conversationManager.processUserMessage('Error input');
      529 |
    > 530 |         expect(response.message).toContain("I'm here to help!");
          |                                  ^
      531 |         expect(response.message).toContain('üòä');
      532 |         expect(response.message).toContain('comfortable for you');
      533 |       });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:530:34)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should create comprehensive confirmation display with all sections

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1056:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should display all contact and project information correctly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1072:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should display all product information correctly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1080:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should format multiline business context properly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1088:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include optional enhancements when provided

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1106:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include validation warnings when provided

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1127:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include data quality assessment

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1137:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include clear next step instructions

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1146:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Confirmation Response Handling ‚Ä∫ should handle edit requests

    expect(received).toContain(expected) // indexOf

    Expected substring: "Edit Your Information"
    Received string:    "ü§î **I didn't quite understand your response.**¬∑
    Please choose one of the following:¬∑
    ‚Ä¢ **\"yes\"** - Create the project and start analysis
    ‚Ä¢ **\"edit\"** - Modify the information
    ‚Ä¢ **\"cancel\"** - Start over¬∑
    What would you like to do?"

      1267 |         const result = await conversationManager['handleConfirmationResponse'](response);
      1268 |         
    > 1269 |         expect(result.message).toContain('Edit Your Information');
           |                                ^
      1270 |         expect(result.nextStep).toBe(0);
      1271 |         expect(result.stepDescription).toBe('Edit Project Information');
      1272 |         expect(result.expectedInputType).toBe('comprehensive_form');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1269:32)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Confirmation Response Handling ‚Ä∫ should handle cancellation requests

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      1281 |         
      1282 |         // Should return to project initialization
    > 1283 |         expect(result.message).toContain('comprehensive form');
           |                                ^
      1284 |         expect(result.expectedInputType).toBe('comprehensive_form');
      1285 |       }
      1286 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1283:32)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Integration with Validation ‚Ä∫ should integrate validation results into confirmation display

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1359:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Integration with Validation ‚Ä∫ should limit warnings and suggestions display

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `üéØ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1378:76)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Routing ‚Ä∫ should route to legacy step handlers when legacy session detected

    expect(received).toContain(expected) // indexOf

    Expected substring: "URL"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      1485 |       
      1486 |       // Should handle legacy step 1 (product data collection)
    > 1487 |       expect(response.message).toContain('URL');
           |                                ^
      1488 |       expect(response.stepDescription).toContain('Product');
      1489 |     });
      1490 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1487:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "migrate now" response

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the Enhanced Experience"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1578 |       const response = await manager.processUserMessage('migrate now');
      1579 |       
    > 1580 |       expect(response.message).toContain('Welcome to the Enhanced Experience');
           |                                ^
      1581 |       expect(response.message).toContain('comprehensive form');
      1582 |       expect(response.nextStep).toBe(0);
      1583 |       expect(response.stepDescription).toContain('Migrated');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1580:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "finish legacy" response

    expect(received).toContain(expected) // indexOf

    Expected substring: "Continuing Legacy Session"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1604 |       const response = await manager.processUserMessage('finish legacy');
      1605 |       
    > 1606 |       expect(response.message).toContain('Continuing Legacy Session');
           |                                ^
      1607 |       expect(response.message).toContain('step-by-step process');
      1608 |       expect(response.message).toContain('Next Time');
      1609 |       expect(response.expectedInputType).toBe('text');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1606:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "tell me more" response with feature details

    expect(received).toContain(expected) // indexOf

    Expected substring: "Enhanced Flow Features"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1629 |       const response = await manager.processUserMessage('tell me more');
      1630 |       
    > 1631 |       expect(response.message).toContain('Enhanced Flow Features');
           |                                ^
      1632 |       expect(response.message).toContain('Speed Improvements');
      1633 |       expect(response.message).toContain('Smart Intelligence');
      1634 |       expect(response.message).toContain('Professional Experience');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1631:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Recovery ‚Ä∫ should handle unknown legacy step with migration prompt

    expect(received).toContain(expected) // indexOf

    Expected substring: "Session State Recovery"
    Received string:    "üöÄ **Ready to upgrade your experience?**¬∑
    I can help you get started with our new comprehensive form that's much faster and easier!¬∑
    **Here's what you can do:**¬∑
    üìù **Switch to comprehensive form** - Type \"upgrade\" and I'll show you how to provide all your project information at once¬∑
    üîÑ **Continue with current flow** - Type \"continue\" to keep using the step-by-step process¬∑
    ‚≠ê **Start fresh** - Type \"restart\" to begin a new project¬∑
    What would you prefer?"

      1654 |       const response = await manager.processUserMessage('continue');
      1655 |       
    > 1656 |       expect(response.message).toContain('Session State Recovery');
           |                                ^
      1657 |       expect(response.message).toContain('comprehensive form');
      1658 |       expect(response.message).toContain('50% faster');
      1659 |       expect(response.stepDescription).toBe('Session Recovery');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1656:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Recovery ‚Ä∫ should preserve data during migration

    expect(received).toContain(expected) // indexOf

    Expected substring: "Migration Tip"
    Received string:    "üöÄ **Upgrade to Enhanced Experience!**¬∑
    I notice you're using our legacy step-by-step flow. Great news - we've launched a **much faster comprehensive form** that collects all requirements at once!¬∑
    **üÜï New Flow Benefits:**
    ‚Ä¢ **‚ö° 50% Faster** - Single form vs. 7+ sequential steps
    ‚Ä¢ **üéØ Clear Overview** - See all requirements upfront
    ‚Ä¢ **üß† Smart Validation** - Intelligent error checking and suggestions
    ‚Ä¢ **üìä Professional Confirmation** - Beautiful project summary before creation
    ‚Ä¢ **‚ú® Same Great Results** - Identical high-quality competitive analysis¬∑
    **üîÑ Migration Options:**
    1. **\"migrate now\"** - Switch to the new flow immediately (recommended)
    2. **\"finish legacy\"** - Complete current session, try new flow next time
    3. **\"tell me more\"** - Learn more about the new features¬∑
    **Your Progress:** Don't worry - all your current data is preserved regardless of your choice!¬∑
    What would you like to do?"

      1678 |       const response = await manager.processUserMessage('migrate now');
      1679 |       
    > 1680 |       expect(response.message).toContain('Migration Tip');
           |                                ^
      1681 |       expect(response.message).toContain('merge everything together');
      1682 |       
      1683 |       // Check that data is preserved in chat state

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1680:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Error Handling ‚Ä∫ should offer migration when legacy step encounters error

    expect(received).toContain(expected) // indexOf

    Expected substring: "Upgrade to Enhanced Experience"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      1717 |       const response = await manager.processUserMessage('Test Product');
      1718 |       
    > 1719 |       expect(response.message).toContain('Upgrade to Enhanced Experience');
           |                                ^
      1720 |       expect(response.message).toContain('Error in legacy flow');
      1721 |     });
      1722 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1719:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Flow Completion ‚Ä∫ should handle legacy step 6 final completion

    expect(received).toContain(expected) // indexOf

    Expected substring: "consolidated competitive report"
    Received string:    "Perfect! I'll send the consolidated comparative report to test@company.com now.¬∑
    üìß **Email Summary:**
    ‚Ä¢ **To:** test@company.com
    ‚Ä¢ **Subject:** Consolidated Competitive Analysis - Test Project
    ‚Ä¢ **Content:** Executive summary + link to full comparative report
    ‚Ä¢ **Delivery:** Within the next few minutes¬∑
    üí° **Future Projects:** Try our new single-form flow - it's 50% faster with the same great results!¬∑
    üéâ **Legacy Session Complete!**¬∑
    Your consolidated competitor research project \"Test Project\" is now active with:
    ‚Ä¢ **‚úÖ Project Created:** test-project-id
    ‚Ä¢ **‚úÖ Consolidated Reporting:** Single comparative report per analysis cycle
    ‚Ä¢ **‚úÖ AI-Powered Analysis:** Claude-driven competitive intelligence
    ‚Ä¢ **‚úÖ Strategic Insights:** Market-wide competitive analysis¬∑
    **Next Steps:**
    ‚Ä¢ Check the **Reports section** for your comparative analysis
    ‚Ä¢ Visit the **Projects section** to manage your project
    ‚Ä¢ **Try our new flow** for your next project - type \"start new project\"¬∑
    üöÄ **Ready for the Enhanced Experience?** Our new single-form flow provides the same excellent results in 50% less time!¬∑
    Thank you for using the Competitor Research Agent!"

      1792 |       
      1793 |       expect(response.message).toContain('Legacy Session Complete');
    > 1794 |       expect(response.message).toContain('consolidated competitive report');
           |                                ^
      1795 |       expect(response.message).toContain('test@company.com');
      1796 |       expect(response.message).toContain('Thank you for using');
      1797 |       expect(response.isComplete).toBe(true);

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1794:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Backward Compatibility ‚Ä∫ should detect comprehensive flow for new sessions

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the HelloFresh"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1866 |       
      1867 |       // Should start with comprehensive flow for new sessions
    > 1868 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1869 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1870 |       expect(response.stepDescription).toBe('Complete Project Setup');
      1871 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1868:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should default to comprehensive flow for new sessions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      1883 |       
      1884 |       // Phase 5.2: Should default to comprehensive flow
    > 1885 |       expect(chatState.useComprehensiveFlow).toBe(true);
           |                                              ^
      1886 |     });
      1887 |
      1888 |     test('should start with comprehensive form for project initialization', async () => {

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1885:46)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should start with comprehensive form for project initialization

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the HelloFresh"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1891 |       const response = await manager.processUserMessage('start new project');
      1892 |       
    > 1893 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1894 |       expect(response.message).toContain('comprehensive');
      1895 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1896 |       expect(response.stepDescription).toBe('Complete Project Setup');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1893:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should use comprehensive prompt by default

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      1903 |       const response = (manager as any).handleProjectInitialization();
      1904 |       
    > 1905 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1906 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1907 |       expect(response.stepDescription).toBe('Complete Project Setup');
      1908 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1905:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Comprehensive Flow Processing ‚Ä∫ should process complete comprehensive input successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      1932 |       
      1933 |       // Should move to confirmation step
    > 1934 |       expect(response.nextStep).toBe(1.5);
           |                                 ^
      1935 |       expect(response.stepDescription).toContain('Confirmation');
      1936 |       expect(response.message).toContain('Please review');
      1937 |     });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1934:33)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Comprehensive Flow Processing ‚Ä∫ should handle partial comprehensive input with guidance

    expect(received).toBe(expected) // Object.is equality

    Expected: "Complete Project Setup"
    Received: "Error Recovery"

      1954 |       // Should stay in step 0 with guidance
      1955 |       expect(response.nextStep).toBe(0);
    > 1956 |       expect(response.stepDescription).toBe('Complete Project Setup');
           |                                        ^
      1957 |       expect(response.message).toContain('Still need');
      1958 |     });
      1959 |   });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1956:40)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should fallback to legacy flow when comprehensive parsing fails

    expect(received).toContain(expected) // indexOf

    Expected substring: "Legacy Fallback"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      1983 |       
      1984 |       // Should fallback gracefully
    > 1985 |       expect(response.message).toContain('Legacy Fallback');
           |                                ^
      1986 |       expect(response.stepDescription).toContain('Legacy Fallback');
      1987 |     });
      1988 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1985:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should provide guidance when both parsing methods fail

    expect(received).toContain(expected) // indexOf

    Expected substring: "help you get started"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2020 |       
      2021 |       // Should provide helpful guidance
    > 2022 |       expect(response.message).toContain('help you get started');
           |                                ^
      2023 |       expect(response.message).toContain('comprehensive form');
      2024 |       expect(response.expectedInputType).toBe('comprehensive_form');
      2025 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2022:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should handle complete parsing failure with step-by-step guidance

    expect(received).toContain(expected) // indexOf

    Expected substring: "start fresh"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2047 |       
      2048 |       // Should provide basic step-by-step guidance
    > 2049 |       expect(response.message).toContain('start fresh');
           |                                ^
      2050 |       expect(response.message).toContain('step-by-step');
      2051 |       expect(response.stepDescription).toContain('Guided');
      2052 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2049:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should provide helpful examples when parsing fails

    expect(received).toContain(expected) // indexOf

    Expected substring: "Example format"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2110 |       
      2111 |       // Should provide examples and guidance
    > 2112 |       expect(response.message).toContain('Example format');
           |                                ^
      2113 |       expect(response.message).toContain('john.doe@company.com');
      2114 |       expect(response.message).toContain('numbered lists');
      2115 |       expect(response.expectedInputType).toBe('comprehensive_form');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2112:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should maintain user data during error recovery

    expect(received).toContain(expected) // indexOf

    Expected substring: "Still need"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2126 |       
      2127 |       // Should preserve data and ask for missing fields
    > 2128 |       expect(response.message).toContain('Still need');
           |                                ^
      2129 |       expect(response.nextStep).toBe(0);
      2130 |       
      2131 |       // Check that partial data is preserved

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2128:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should provide progressive completion encouragement

    expect(received).toContain(expected) // indexOf

    Expected substring: "Good"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2151 |       
      2152 |       // Should provide encouraging message about progress
    > 2153 |       expect(response.message).toContain('progress') || expect(response.message).toContain('Good');
           |                                                                                  ^
      2154 |       expect(response.nextStep).toBe(0);
      2155 |     });
      2156 |   });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2153:82)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Performance and Reliability ‚Ä∫ should handle concurrent comprehensive form submissions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      2183 |       // All should succeed
      2184 |       responses.forEach(response => {
    > 2185 |         expect(response.nextStep).toBe(1.5);
           |                                   ^
      2186 |         expect(response.stepDescription).toContain('Confirmation');
      2187 |       });
      2188 |     });

      at toBe (src/__tests__/unit/conversation.test.ts:2185:35)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/conversation.test.ts:2184:17)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Integration with Existing Features ‚Ä∫ should maintain compatibility with validation features

    expect(received).toContain(expected) // indexOf

    Expected substring: "email"
    Received string:    "üîÑ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    üí° **What happened:** System error occurred: Unexpected processing issue¬∑
    üöÄ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ü§ù"

      2234 |       
      2235 |       // Should provide validation feedback
    > 2236 |       expect(response.message).toContain('email') || expect(response.message).toContain('URL');
           |                                ^
      2237 |       expect(response.nextStep).toBe(0);
      2238 |     });
      2239 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2236:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Integration with Existing Features ‚Ä∫ should integrate with confirmation flow

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      2258 |       
      2259 |       // Should reach confirmation step
    > 2260 |       expect(confirmationResponse.nextStep).toBe(1.5);
           |                                             ^
      2261 |       
      2262 |       // Confirm project creation
      2263 |       const finalResponse = await manager.processUserMessage('yes, create project');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:2260:45)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should not use feature flags or environment variables

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      2277 |       
      2278 |       // Should default to comprehensive flow regardless of environment
    > 2279 |       expect(chatState.useComprehensiveFlow).toBe(true);
           |                                              ^
      2280 |       
      2281 |       // Should not depend on environment variables
      2282 |       delete process.env.ENABLE_COMPREHENSIVE_FLOW;

      at Object.toBe (src/__tests__/unit/conversation.test.ts:2279:46)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should provide clear migration path for legacy users

    expect(received).toContain(expected) // indexOf

    Expected substring: "Enhanced Experience"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      2302 |       const response = await manager.processUserMessage('I want to try the new flow');
      2303 |       
    > 2304 |       expect(response.message).toContain('Enhanced Experience') || 
           |                                ^
      2305 |              expect(response.message).toContain('comprehensive');
      2306 |     });
      2307 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2304:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should maintain zero breaking changes for existing users

    expect(received).toContain(expected) // indexOf

    Expected substring: "analysis"
    Received string:    "‚ö†Ô∏è **Report Generation Issue**¬∑
    I encountered an error while generating your consolidated comparative report: Failed to parse URL from /api/reports/comparative?projectId=existing-project-123¬∑
    **What happened:** The new consolidated reporting system had an issue, but don't worry - your project and data are saved.¬∑
    **Next steps:**
    1. **Retry** - Try again in a few minutes
    2. **Migrate** - Switch to our improved single-form flow for better reliability
    3. **Support** - Get help with this issue¬∑
    **Project Details:**
    - **Project:** undefined
    - **Project ID:** existing-project-123
    - **Product:** Existing Product¬∑
    Please respond with \"retry\", \"migrate\", or \"support\"."

      2325 |       expect(response.nextStep).toBe(5);
      2326 |       expect(response.message).toContain('Report') || 
    > 2327 |              expect(response.message).toContain('analysis');
           |                                       ^
      2328 |       
      2329 |       // State should be preserved
      2330 |       const chatState = manager.getChatState();

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2327:39)

FAIL src/__tests__/integration/systemIntegration.test.ts
  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should generate report with real-time status updates

    TypeError: realTimeStatusService.subscribeToProjectStatus is not a function

      157 |
      158 |         // Subscribe to real-time updates
    > 159 |         realTimeStatusService.subscribeToProjectStatus(projectId, statusCallback);
          |                               ^
      160 |
      161 |         try {
      162 |           // Generate initial report

      at Object.subscribeToProjectStatus (src/__tests__/integration/systemIntegration.test.ts:159:31)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should handle smart data collection integration

    Project jwe70kmra10k1jpjc6ima6ls not found

      248 |
      249 |       if (!project) {
    > 250 |         throw new Error(`Project ${projectId} not found`);
          |               ^
      251 |       }
      252 |
      253 |       const totalCompetitors = project.competitors.length;

      at SmartDataCollectionService.collectCompetitorDataWithPriorities (src/services/reports/smartDataCollectionService.ts:250:15)
      at SmartDataCollectionService.collectProjectData (src/services/reports/smartDataCollectionService.ts:108:36)
      at Object.<anonymous> (src/__tests__/integration/systemIntegration.test.ts:196:38)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should enforce rate limiting during concurrent operations

    expect(received).toBeGreaterThan(expected)

    Expected: > 10000
    Received:   1

      239 |
      240 |         expect(successfulReports.length).toBeLessThanOrEqual(5); // Max concurrent snapshots per project
    > 241 |         expect(endTime - startTime).toBeGreaterThan(10000); // Should take time due to rate limiting
          |                                     ^
      242 |
      243 |         // Add successful report IDs to cleanup
      244 |         successfulReports.forEach(result => {

      at Object.toBeGreaterThan (src/__tests__/integration/systemIntegration.test.ts:241:37)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ Configuration Management Integration ‚Ä∫ should update configuration and propagate changes

    TypeError: Cannot convert undefined or null to object
        at Function.keys (<anonymous>)

      220 |       logger.error('Configuration update failed', error as Error, {
      221 |         updatedBy,
    > 222 |         updateFields: Object.keys(updates),
          |                              ^
      223 |         rollbackToken
      224 |       });
      225 |

      at ConfigurationManagementService.keys [as updateConfiguration] (src/services/configurationManagementService.ts:222:30)
      at Object.updateConfiguration (src/__tests__/integration/systemIntegration.test.ts:259:50)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ API Endpoints Integration ‚Ä∫ Project Creation API Integration ‚Ä∫ should create project with immediate report generation

    TypeError: Cannot read properties of undefined (reading 'id')

      352 |         // For integration testing, we're testing the service integration
      353 |         const project = await createTestProjectWithData(projectData);
    > 354 |         testProjectIds.push(project.id);
          |                                     ^
      355 |
      356 |         expect(project).toBeDefined();
      357 |         expect(project.id).toBeDefined();

      at Object.id (src/__tests__/integration/systemIntegration.test.ts:354:37)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Infrastructure Integration ‚Ä∫ Database Schema Integration ‚Ä∫ should handle initial reports schema correctly

    TypeError: Cannot read properties of undefined (reading 'id')

      462 |         });
      463 |
    > 464 |         testReportIds.push(report.id);
          |                                   ^
      465 |
      466 |         expect(report).toBeDefined();
      467 |         expect(report.isInitialReport).toBe(true);

      at Object.id (src/__tests__/integration/systemIntegration.test.ts:464:35)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ End-to-End Integration ‚Ä∫ should complete full user journey with all systems

    Project v1whq1pe0d1tvf4jp7bcfxwl not found

      511 |
      512 |       if (!project) {
    > 513 |         throw new Error(`Project ${projectId} not found`);
          |               ^
      514 |       }
      515 |
      516 |       const missingData: string[] = [];

      at InitialComparativeReportService.validateProjectReadiness (src/services/reports/initialComparativeReportService.ts:513:15)
      at Object.<anonymous> (src/__tests__/integration/systemIntegration.test.ts:580:31)

FAIL src/__tests__/unit/comprehensiveRequirementsCollector.test.ts
  ‚óè Console

    console.log
      [DEBUG] Parsing comprehensive input: john.doe@company.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: john.doe@company.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: invalid-email...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: invalid-email...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: weekly reports...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: weekly reports...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: https://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: https://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: Project name: "Good Chop Analysis"...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: Project name: "Good Chop Analysis"...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: 
              1. john.doe@company.com
              2. Weekly
              3. Good Chop Analysis
              4. Good Chop
              5. https://goodchop.com
              6. Food delivery
              7. Premium meat delivery service ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. john.doe@company.com
       2. Weekly
       3. Good Chop Analysis
       4. Good Chop
       5. https://goodchop.com
       6. Food delivery
       7. Premium meat delivery service targeting health-conscious consumers
       8. 10,000+ cu...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'john.doe@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Good Chop Analysis',
        productName: 'Good Chop',
        productUrl: 'https://goodchop.com/',
        industry: 'Food delivery',
        positioning: 'Premium meat delivery service targeting health-conscious consumers',
        customerData: '10,000+ customers across urban markets',
        userProblem: 'Finding high-quality, ethically sourced meat'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: {
        userEmail: 100,
        reportFrequency: 100,
        projectName: 100,
        productName: 100,
        productUrl: 100,
        industry: 100,
        positioning: 100,
        customerData: 100,
        userProblem: 100
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 100

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: true,
        completeness: 100,
        missingRequiredFields: [],
        invalidFields: [],
        extractedData: {
          userEmail: 'john.doe@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Good Chop Analysis',
          productName: 'Good Chop',
          productUrl: 'https://goodchop.com/',
          industry: 'Food delivery',
          positioning: 'Premium meat delivery service targeting health-conscious consumers',
          customerData: '10,000+ customers across urban markets',
          userProblem: 'Finding high-quality, ethically sourced meat'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productName: 100,
          productUrl: 100,
          industry: 100,
          positioning: 100,
          customerData: 100,
          userProblem: 100
        },
        suggestions: []
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Hi! My email is john@company.com and I'd like weekly reports for my project called "Project Alpha". 
              We're analyzing our product "Product Beta" at https://beta.com. We're in the SaaS ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Hi! My email is john@company.com and I"d like weekly reports for my project called "Project Alpha". 
       We"re analyzing our product "Product Beta" at https://beta.com. We"re in the SaaS industry, 
       posi...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Email: john.doe@company.com
              Frequency: Weekly
              Project: Good Chop Analysis
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Email: john.doe@company.com
       Frequency: Weekly
       Project: Good Chop Analysis...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: invalid-email, Weekly, Project Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: invalid-email, Weekly, Project Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: john@company.com, Weekly, Project Name, Product Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: john@company.com, Weekly, Project Name, Product Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Converting to chat state: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project',
        productName: 'Test Product',
        productUrl: 'https://test.com',
        industry: 'SaaS',
        positioning: 'B2B software solution',
        customerData: '500+ enterprise customers',
        userProblem: 'Manual data processing'
      }

      at ComprehensiveRequirementsCollector.log [as toChatState] (src/lib/chat/comprehensiveRequirementsCollector.ts:999:13)

    console.log
      [DEBUG] Converted chat state: {
        collectedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          reportName: 'Test Project',
          productName: 'Test Product',
          productUrl: 'https://test.com',
          industry: 'SaaS',
          positioning: 'B2B software solution',
          customerData: '500+ enterprise customers',
          userProblem: 'Manual data processing',
          competitors: undefined
        }
      }

      at ComprehensiveRequirementsCollector.log [as toChatState] (src/lib/chat/comprehensiveRequirementsCollector.ts:1017:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              john@company.com
              Weekly
              "Project Alpha & Beta (2024)"
              Product with √©mojis üöÄ
              https://example.com/path?param=value
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: john@company.com
       Weekly
       "Project Alpha & Beta (2024)"
       Product with √©mojis üöÄ
       https://example.com/path?param=value...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Check out https://main-site.com and also https://backup-site.com
              Email: john@company.com
              Frequency: Monthly
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Check out https://main-site.com and also https://backup-site.com
       Email: john@company.com
       Frequency: Monthly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Email: john.doe@company.com
              Frequency: Weekly
              Project: Good Chop Competitive Analysis
              Product: Good Chop
              Website: https://goodchop.com
              Industry: Food d...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Email: john.doe@company.com
       Frequency: Weekly
       Project: Good Chop Competitive Analysis
       Product: Good Chop
       Website: https://goodchop.com
       Industry: Food delivery and meal kits
       Positioning: Premium ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly  
              3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly 
       3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 100, reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 44

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 44,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Test Project',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: ‚Ä¢ test@company.com
              ‚Ä¢ Weekly reports
              ‚Ä¢ Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: ‚Ä¢ test@company.com
       ‚Ä¢ Weekly reports
       ‚Ä¢ Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: bullet_points

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 90, reportFrequency: 85, projectName: 80 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 39

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 39,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Test Project',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 90,
          reportFrequency: 85,
          projectName: 80,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Nice format! You can also use numbered list for better accuracy',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: Hi! My email is test@company.com and I need weekly reports. 
              The project is called "Test Analysis" and we're in the SaaS industry. 
              Our product is called "TestApp" and it's at https://...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Hi! My email is test@company.com and I need weekly reports. 
       The project is called "Test Analysis" and we"re in the SaaS industry. 
       Our product is called "TestApp" and it"s at https://testapp.com....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: Email: test@company.com
              I want monthly reports
              1. Project name: Test Project
              URL: https://test.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Email: test@company.com
       I want monthly reports
       1. Project name: Test Project
       URL: https://test.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1.  test@company.com   
              2.   Weekly   
              3.  "Test Project"  ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com 
       2. Weekly 
       3. "Test Project"...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 100, reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 44

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 44,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Test Project',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly
              3. "Pr√∏ject An√°lysis"...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly
       3. "Pr√∏ject An√°lysis"...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Pr√∏ject An√°lysis'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 100, reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 44

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 44,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Pr√∏ject An√°lysis',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: We're building a SaaS platform for healthcare providers.
              Email: test@company.com
              Monthly reports please....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: We"re building a SaaS platform for healthcare providers.
       Email: test@company.com
       Monthly reports please....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: Our fintech startup processes payments for small businesses.
              Contact: john@paytech.com
              Need weekly competitive analysis....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Our fintech startup processes payments for small businesses.
       Contact: john@paytech.com
       Need weekly competitive analysis....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly
              3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly
       3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 100, reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 44

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 44,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Test Project',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: Maybe weekly reports? Email might be test@company.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Maybe weekly reports? Email might be test@company.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: Email: test@company.com, need reports weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Email: test@company.com, need reports weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: test@company.com, Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: test@company.com, Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. invalid-email-format
              2. Weekly
              3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. invalid-email-format
       2. Weekly
       3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: { reportFrequency: 'Weekly', projectName: 'Test Project' }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'userEmail',
        'productName',
        'productUrl',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 22

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 22,
        missingRequiredFields: [
          'userEmail',
          'productName',
          'productUrl',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [],
        extractedData: { reportFrequency: 'Weekly', projectName: 'Test Project' },
        confidence: { reportFrequency: 100, projectName: 100 },
        suggestions: [
          'Still need: Email, Product Name, Product URL, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üìß Include your email address for report delivery',
          'üîó Include your product website URL (https://yoursite.com)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly
              3. Test Project
              4. TestApp
              5. invalid-url-format...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly
       3. Test Project
       4. TestApp
       5. invalid-url-format...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Test Project',
        productName: 'TestApp'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: {
        userEmail: 100,
        reportFrequency: 100,
        projectName: 100,
        productName: 100
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [ 'industry', 'positioning', 'customerData', 'userProblem' ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 55

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 55,
        missingRequiredFields: [ 'industry', 'positioning', 'customerData', 'userProblem' ],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Test Project',
          productName: 'TestApp',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. sometimes
              3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. sometimes
       3. Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'sometimes',
        projectName: 'Test Project'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: { userEmail: 100, reportFrequency: 100, projectName: 100 }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: [
        'productName',
        'industry',
        'positioning',
        'customerData',
        'userProblem'
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 44

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: [
        {
          field: 'reportFrequency',
          reason: 'Frequency not recognized',
          suggestion: 'Please specify: Daily, Weekly, Monthly, or Quarterly'
        }
      ]

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: false,
        completeness: 44,
        missingRequiredFields: [
          'productName',
          'industry',
          'positioning',
          'customerData',
          'userProblem'
        ],
        invalidFields: [
          {
            field: 'reportFrequency',
            reason: 'Frequency not recognized',
            suggestion: 'Please specify: Daily, Weekly, Monthly, or Quarterly'
          }
        ],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'sometimes',
          projectName: 'Test Project',
          productUrl: 'https://company.com/'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productUrl: 95
        },
        suggestions: [
          'Still need: Product Name, Industry, Positioning, Customer Data, User Problems',
          '‚úì Great format! Continue using numbered list (1. 2. 3. ...)',
          'üè¢ Specify your industry (e.g., SaaS, Healthcare, E-commerce)'
        ]
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

    console.log
      [DEBUG] Parsing comprehensive input: 1. test@company.com
              2. Weekly
              3. Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very V...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: 1. test@company.com
       2. Weekly
       3. Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: numbered_list

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Extracted data after parsing: {
        userEmail: 'test@company.com',
        reportFrequency: 'Weekly',
        projectName: 'Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Long Project Name',
        productName: 'Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Name',
        productUrl: 'https://example.com/',
        industry: 'SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS Industry',
        positioning: 'We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide extensive positioning',
        customerData: 'Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers are diverse',
        userProblem: 'The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem is complexity'
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:457:13)

    console.log
      [DEBUG] Confidence scores: {
        userEmail: 100,
        reportFrequency: 100,
        projectName: 100,
        productName: 100,
        productUrl: 100,
        industry: 100,
        positioning: 100,
        customerData: 100,
        userProblem: 100
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:458:13)

    console.log
      [DEBUG] Missing required fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:512:13)

    console.log
      [DEBUG] Completeness percentage: 100

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:513:13)

    console.log
      [DEBUG] Invalid fields: []

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:514:13)

    console.log
      [DEBUG] Final validation result: {
        isValid: true,
        completeness: 100,
        missingRequiredFields: [],
        invalidFields: [],
        extractedData: {
          userEmail: 'test@company.com',
          reportFrequency: 'Weekly',
          projectName: 'Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Very Long Project Name',
          productName: 'Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Product Name',
          productUrl: 'https://example.com/',
          industry: 'SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS SaaS Industry',
          positioning: 'We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide We provide extensive positioning',
          customerData: 'Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers Our customers are diverse',
          userProblem: 'The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem The main problem is complexity'
        },
        confidence: {
          userEmail: 100,
          reportFrequency: 100,
          projectName: 100,
          productName: 100,
          productUrl: 100,
          industry: 100,
          positioning: 100,
          customerData: 100,
          userProblem: 100
        },
        suggestions: []
      }

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:529:13)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should generate a comprehensive prompt with all required sections

    expect(received).toContain(expected) // indexOf

    Expected substring: "OPTIONAL ENHANCEMENTS"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

      16 |       expect(prompt).toContain('PRODUCT INFORMATION');
      17 |       expect(prompt).toContain('BUSINESS CONTEXT');
    > 18 |       expect(prompt).toContain('OPTIONAL ENHANCEMENTS');
         |                      ^
      19 |       expect(prompt).toContain('HOW TO RESPOND');
      20 |       expect(prompt).toContain('Ready when you are');
      21 |     });

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:18:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should support different tones

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "üöÄ"
    Received string:        "üöÄ **Welcome to the Competitor Research Agent!**

    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!

    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?

    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?

    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics  
    9. **User problems** - Core problems your product solves

    **üìù HOW TO RESPOND:**

    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly  
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"

    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order

    Ready to start? Just provide your information in any format above! üéØ"

      28 |       expect(professionalPrompt).toContain('Competitor Research Agent');
      29 |       expect(professionalPrompt).toContain('competitive analysis');
    > 30 |       expect(professionalPrompt).not.toContain('üöÄ');
         |                                      ^
      31 |
      32 |       expect(friendlyPrompt).toContain('üöÄ');
      33 |       expect(friendlyPrompt).toContain('Ready when you are! üéâ');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:30:38)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should include industry-specific examples when requested

    expect(received).toContain(expected) // indexOf

    Expected substring: "SaaS"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

      48 |       });
      49 |
    > 50 |       expect(saasPrompt).toContain('SaaS');
         |                          ^
      51 |       expect(saasPrompt).toContain('B2B productivity platform');
      52 |       
      53 |       expect(foodPrompt).toContain('meal delivery');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:50:26)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should hide optional fields when requested

    expect(received).toContain(expected) // indexOf

    Expected substring: "OPTIONAL ENHANCEMENTS"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

      59 |       const withoutOptional = collector.generateComprehensivePrompt({ showOptionalFields: false });
      60 |
    > 61 |       expect(withOptional).toContain('OPTIONAL ENHANCEMENTS');
         |                            ^
      62 |       expect(withoutOptional).not.toContain('OPTIONAL ENHANCEMENTS');
      63 |     });
      64 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:61:28)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should customize contextual help

    expect(received).toContain(expected) // indexOf

    Expected substring: "intelligently parse"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

      67 |       const withoutHelp = collector.generateComprehensivePrompt({ includeContextualHelp: false });
      68 |
    > 69 |       expect(withHelp).toContain('intelligently parse');
         |                        ^
      70 |       expect(withoutHelp).not.toContain('intelligently parse');
      71 |     });
      72 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:69:24)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should emphasize speed when requested

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "faster"
    Received string:        "üöÄ **Welcome to the Competitor Research Agent!**

    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!

    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?

    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?

    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics  
    9. **User problems** - Core problems your product solves

    **üìù HOW TO RESPOND:**

    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly  
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"

    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order

    Ready to start? Just provide your information in any format above! üéØ"

      76 |
      77 |       expect(withSpeed).toContain('faster');
    > 78 |       expect(withoutSpeed).not.toContain('faster');
         |                                ^
      79 |     });
      80 |   });
      81 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:78:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateIndustrySpecificPrompt ‚Ä∫ should generate industry-specific prompts

    expect(received).toContain(expected) // indexOf

    Expected substring: "SaaS"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

      85 |       const fintech = collector.generateIndustrySpecificPrompt('fintech');
      86 |
    > 87 |       expect(saasPrompt).toContain('SaaS');
         |                          ^
      88 |       expect(saasPrompt).toContain('B2B productivity platform');
      89 |       
      90 |       expect(fintech).toContain('fintech');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:87:26)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateConcisePrompt ‚Ä∫ should generate a concise prompt

    expect(received).toContain(expected) // indexOf

    Expected substring: "Competitor Analysis Setup"
    Received string:    "üöÄ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **üìß CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **üéØ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **üìä BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **üìù HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **üí° IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! üéØ"

       97 |       const prompt = collector.generateConcisePrompt();
       98 |       
    >  99 |       expect(prompt).toContain('Competitor Analysis Setup');
          |                      ^
      100 |       expect(prompt).not.toContain('OPTIONAL ENHANCEMENTS');
      101 |       expect(prompt).not.toContain('üöÄ');
      102 |       expect(prompt).toContain('Ready for your input');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:99:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generatePartialPrompt ‚Ä∫ should generate helpful partial prompts

    expect(received).toContain(expected) // indexOf

    Expected substring: "Product Website"
    Received string:    "üìã **Almost Complete!** You've provided 7/9 required fields.¬∑
    **Still need:**
    ‚Ä¢ **Product URL**: Your product's website (e.g., https://myproduct.com)
    ‚Ä¢ **Industry**: Your market sector (e.g., SaaS)¬∑
    **Already have:**
    üìß Email: test@company.com
    üìÖ Frequency: Weekly
    üìã Project: Test Project¬∑
    Please provide the missing information in any format you prefer. I'll combine it with what you've already given me! üöÄ"

      117 |       expect(prompt).toContain('Almost Complete');
      118 |       expect(prompt).toContain('7/9 required fields');
    > 119 |       expect(prompt).toContain('Product Website');
          |                      ^
      120 |       expect(prompt).toContain('Industry/Market');
      121 |       expect(prompt).toContain('Already have');
      122 |       expect(prompt).toContain('test@company.com');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:119:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Email extraction ‚Ä∫ should extract email from various formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:150:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:149:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Email extraction ‚Ä∫ should handle invalid email formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:166:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:165:23)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Frequency extraction ‚Ä∫ should extract frequency keywords

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:183:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:182:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ URL extraction ‚Ä∫ should extract URLs with cleanup

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:199:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:198:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Project name extraction ‚Ä∫ should extract project names from various formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:215:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:214:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle complete single submission

    expect(received).toBe(expected) // Object.is equality

    Expected: "https://goodchop.com"
    Received: "https://goodchop.com/"

      244 |       expect(result.extractedData.projectName).toBe('Good Chop Analysis');
      245 |       expect(result.extractedData.productName).toBe('Good Chop');
    > 246 |       expect(result.extractedData.productUrl).toBe('https://goodchop.com');
          |                                               ^
      247 |       expect(result.extractedData.industry).toBe('Food delivery');
      248 |     });
      249 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:246:47)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle natural language format

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:258:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle partial submission gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:276:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Error handling and suggestions ‚Ä∫ should provide specific guidance for invalid email

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:320:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Error handling and suggestions ‚Ä∫ should handle missing URL gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:332:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ createMissingFieldsPrompt ‚Ä∫ should create helpful prompt for missing fields

    expect(received).toContain(expected) // indexOf

    Expected substring: "Product Website"
    Received string:    "üìä **Progress: 50% Complete**¬∑
    üìù **Still need the following required information:**
    ‚Ä¢ **Product URL**: Your product's website
      üí° Example: https://myproduct.com
    ‚Ä¢ **Industry**: Your market sector
      üí° Example: SaaS¬∑
    üí° **Helpful tips:**
    ‚Ä¢ Include your product website URL¬∑
    Please provide the missing information, and I'll create your competitive analysis project! üöÄ"

      353 |       expect(prompt).toContain('Progress: 50% Complete');
      354 |       expect(prompt).toContain('Still need the following');
    > 355 |       expect(prompt).toContain('Product Website');
          |                      ^
      356 |       expect(prompt).toContain('Industry/Market');
      357 |       expect(prompt).toContain('Helpful tips');
      358 |     });

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:355:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle special characters in project names

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:399:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle multiple URLs in text

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:410:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle empty input gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:415:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle very long input

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:424:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Performance ‚Ä∫ should parse typical input within reasonable time

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:446:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Parsing Strategy Detection ‚Ä∫ should detect natural language format

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:485:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Parsing Strategy Detection ‚Ä∫ should handle mixed format intelligently

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:498:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Contextual Intelligence ‚Ä∫ should detect industry context from content

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:536:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Contextual Intelligence ‚Ä∫ should use contextual clues for better extraction

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:548:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Smart Completeness Calculation ‚Ä∫ should handle partial credit for uncertain extractions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:572:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should provide format-specific suggestions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:585:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should suggest optimal format for mixed inputs

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:594:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should provide context-aware field suggestions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:602:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Enhanced Field Validation ‚Ä∫ should validate email formats contextually

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      616 |         const result = collector.parseComprehensiveInput(input);
      617 |         
    > 618 |         expect(result.invalidFields.some(f => f.field === 'userEmail')).toBe(true);
          |                                                                         ^
      619 |         expect(result.invalidFields.some(f => f.reason.includes('Invalid email format'))).toBe(true);
      620 |       });
      621 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:618:73)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Enhanced Field Validation ‚Ä∫ should validate URL formats with suggestions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      629 |         const result = collector.parseComprehensiveInput(input);
      630 |         
    > 631 |         expect(result.invalidFields.some(f => f.field === 'productUrl')).toBe(true);
          |                                                                          ^
      632 |         expect(result.invalidFields.some(f => f.suggestion.includes('https://'))).toBe(true);
      633 |       });
      634 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:631:74)

FAIL src/__tests__/integration/productVsCompetitorApiIntegration.test.ts
  ‚óè Console

    console.log
      üöÄ Testing product creation API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:183:15)

    console.log
      ‚úÖ Product creation API completed successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:222:15)

    console.log
      üìä Product ID: product-1752147469824

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:223:15)

    console.log
      üîó Correlation ID: correlation-1752147469824-o5b93q6

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:224:15)

    console.log
      ‚ö° Processing time: 45ms

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:225:15)

    console.log
      üöÄ Testing product retrieval API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:229:15)

    console.log
      ‚úÖ Product retrieval API completed successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:253:15)

    console.log
      ‚ö° API response time: 31ms

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:254:15)

    console.log
      üìä Products retrieved: 1

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:255:15)

    console.log
      üîó Correlation ID: correlation-1752147469856-5hbu49u

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:256:15)

    console.log
      üöÄ Testing API validation errors with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:260:15)

    console.log
      ‚úÖ API validation error handling verified with Fix 7.1c

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:282:15)

    console.log
      üîó Error correlation ID: correlation-1752147469857-umijuds

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:283:15)

    console.log
      üìä Validation errors: 2

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:284:15)

    console.log
      üöÄ Testing comparative report generation API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:290:15)

    console.log
      ‚úÖ Comparative report generation API completed successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:315:15)

    console.log
      üìä Report ID: report-1752147469939

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:316:15)

    console.log
      üîó Correlation ID: correlation-1752147469939-dgsvdhh

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:317:15)

    console.log
      ‚ö° Processing time: 1200ms

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:318:15)

    console.log
      üöÄ Testing comparative report status API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:322:15)

    console.log
      üöÄ Testing report schedule creation API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:346:15)

    console.log
      üöÄ Testing schedule retrieval API with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:377:15)

    console.log
      üöÄ Testing complete E2E API workflow with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:406:15)

    console.log
      üöÄ Testing E2E error handling with Fix 7.1c...

      at Object.log (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:488:15)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Comparative Report API Endpoints - Fix 7.1c Applied ‚Ä∫ should get comparative report status with realistic tracking

    TypeError: mockWorkflow.apiService.getComparativeStatus is not a function

      322 |       console.log('üöÄ Testing comparative report status API with Fix 7.1c...');
      323 |
    > 324 |       const mockApiResponse = await mockWorkflow.apiService.getComparativeStatus({ productId: testProductId });
          |                                                             ^
      325 |
      326 |       expect(mockApiResponse.status).toBe(200);
      327 |       expect(mockApiResponse.data.success).toBe(true);

      at Object.getComparativeStatus (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:324:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Report Scheduling API Endpoints - Fix 7.1c Applied ‚Ä∫ should create report schedule with realistic workflow patterns

    TypeError: mockWorkflow.apiService.createSchedule is not a function

      354 |       };
      355 |
    > 356 |       const mockApiResponse = await mockWorkflow.apiService.createSchedule(scheduleData);
          |                                                             ^
      357 |
      358 |       expect(mockApiResponse.status).toBe(200);
      359 |       expect(mockApiResponse.data.success).toBe(true);

      at Object.createSchedule (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:356:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Report Scheduling API Endpoints - Fix 7.1c Applied ‚Ä∫ should get schedules with realistic pagination and filtering

    TypeError: mockWorkflow.apiService.getSchedules is not a function

      377 |       console.log('üöÄ Testing schedule retrieval API with Fix 7.1c...');
      378 |
    > 379 |       const mockApiResponse = await mockWorkflow.apiService.getSchedules({ 
          |                                                             ^
      380 |         productId: testProductId,
      381 |         page: 1,
      382 |         limit: 10 

      at Object.getSchedules (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:379:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ End-to-End API Workflow - Fix 7.1c Applied ‚Ä∫ should execute complete product vs competitor workflow with realistic data flow

    TypeError: mockWorkflow.apiService.generateAnalysis is not a function

      432 |       };
      433 |
    > 434 |       const analysisResponse = await mockWorkflow.apiService.generateAnalysis(analysisData);
          |                                                              ^
      435 |       expect(analysisResponse.status).toBe(200);
      436 |       const analysisId = analysisResponse.data.data.analysisId;
      437 |

      at Object.generateAnalysis (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:434:62)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ End-to-End API Workflow - Fix 7.1c Applied ‚Ä∫ should handle error scenarios in E2E workflow with realistic error recovery

    TypeError: mockWorkflow.apiService.generateAnalysis is not a function

      506 |       };
      507 |
    > 508 |       const analysisErrorResponse = await mockWorkflow.apiService.generateAnalysis(invalidAnalysisData);
          |                                                                   ^
      509 |       expect(analysisErrorResponse.status).toBe(404);
      510 |       expect(analysisErrorResponse.data.success).toBe(false);
      511 |       expect(analysisErrorResponse.data.error.type).toBe('resource_not_found');

      at Object.generateAnalysis (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:508:67)

FAIL src/app/api/projects/__tests__/route.immediateReports.test.ts
  ‚óè Console

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:171:24)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:171:24)

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:195:24)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:195:24)

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:239:24)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:239:24)

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:273:24)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:273:24)

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:303:7)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:303:7)

    console.error
      Error creating project: TypeError: Cannot read properties of undefined (reading 'id')
          at ProjectService.id [as createProject] (/Users/nikita.gorshkov/competitor-research-agent/src/services/projectService.ts:86:28)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at POST (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/route.ts:85:21)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/app/api/projects/__tests__/route.immediateReports.test.ts:343:24)

      94 |
      95 |   } catch (error) {
    > 96 |     console.error('Error creating project:', error);
         |             ^
      97 |     const errorObj = error instanceof Error ? error : new Error(String(error));
      98 |     logger.error('Failed to create project', errorObj);
      99 |     

      at error (src/app/api/projects/route.ts:96:13)
      at Object.<anonymous> (src/app/api/projects/__tests__/route.immediateReports.test.ts:343:24)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Basic Request Handling ‚Ä∫ should handle simple request parsing

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      171 |       const response = await POST(request);
      172 |       
    > 173 |       expect(response.status).toBe(201);
          |                               ^
      174 |     }, 10000);  // 10 second timeout
      175 |   });
      176 |

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:173:31)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should generate initial report immediately when requested

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"enableGracefulDegradation": true, "fallbackToQueue": true, "maxConcurrentProcessing": 5, "notifyOnCompletion": false, "priority": "high", "retryAttempts": 2, "timeout": 45000}

    Number of calls: 0

      197 |
      198 |       // Verify asyncReportProcessingService was called (this is what the API route actually uses)
    > 199 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith(
          |                                                                 ^
      200 |         'project-1',
      201 |         expect.objectContaining({
      202 |           timeout: 45000,

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:199:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should respect generateInitialReport=false flag

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      242 |       expect(asyncReportProcessingService.processInitialReport).not.toHaveBeenCalled();
      243 |       
    > 244 |       expect(response.status).toBe(201);
          |                               ^
      245 |     }, 10000);
      246 |
      247 |     it('should fallback to queue when immediate generation fails', async () => {

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:244:31)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should fallback to queue when immediate generation fails

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", Any<Object>

    Number of calls: 0

      275 |
      276 |       // Verify processing service was called
    > 277 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith('project-1', expect.any(Object));
          |                                                                 ^
      278 |       
      279 |       expect(responseData.reportGeneration).toEqual(
      280 |         expect.objectContaining({

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:277:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should handle requireFreshSnapshots option

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"fallbackToQueue": true, "priority": "high", "timeout": 45000}

    Number of calls: 0

      304 |
      305 |       // The API route uses asyncReportProcessingService and the requireFreshSnapshots logic is handled internally
    > 306 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith(
          |                                                                 ^
      307 |         'project-1',
      308 |         expect.objectContaining({
      309 |           timeout: 45000,

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:306:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Project Creation Resilience ‚Ä∫ should create project successfully even when report generation fails completely

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      345 |
      346 |       // Project should still be created successfully
    > 347 |       expect(response.status).toBe(201);
          |                               ^
      348 |       expect(responseData.id).toBe('project-1');
      349 |       
      350 |       // Report generation should indicate failure

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:347:31)

FAIL src/services/__tests__/rateLimitingService.test.ts
  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should enforce daily cost limits

    expect(received).toContain(expected) // indexOf

    Expected substring: "Daily cost limit would be exceeded"
    Received string:    "Hourly cost limit would be exceeded ($12.00 > $2)"

      147 |       
      148 |       expect(decision.allowed).toBe(false);
    > 149 |       expect(decision.reason).toContain('Daily cost limit would be exceeded');
          |                               ^
      150 |       expect(decision.fallbackSuggested).toContain('tomorrow');
      151 |     });
      152 |

      at Object.toContain (src/services/__tests__/rateLimitingService.test.ts:149:31)

  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should enforce domain throttling

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      158 |       // Immediate second request to same domain should be throttled
      159 |       const decision2 = await rateLimitingService.checkRateLimit(mockContext);
    > 160 |       expect(decision2.allowed).toBe(false);
          |                                 ^
      161 |       expect(decision2.reason).toContain('throttled');
      162 |       expect(decision2.waitTimeMs).toBeGreaterThan(0);
      163 |     });

      at Object.toBe (src/services/__tests__/rateLimitingService.test.ts:160:33)

  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should provide meaningful fallback suggestions

    expect(received).toBeDefined()

    Received: undefined

      181 |       const decision = await rateLimitingService.checkRateLimit(throttledContext);
      182 |       
    > 183 |       expect(decision.fallbackSuggested).toBeDefined();
          |                                          ^
      184 |       expect(decision.fallbackSuggested).toContain('cached');
      185 |     });
      186 |   });

      at Object.toBeDefined (src/services/__tests__/rateLimitingService.test.ts:183:42)

  ‚óè RateLimitingService ‚Ä∫ Rate Limit Execution ‚Ä∫ should track concurrent requests correctly

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      249 |       // Check metrics during execution
      250 |       const metrics = rateLimitingService.getRateLimitingMetrics();
    > 251 |       expect(metrics.currentConcurrentRequests).toBeGreaterThan(0);
          |                                                 ^
      252 |       
      253 |       await Promise.all([promise1, promise2]);
      254 |       

      at Object.toBeGreaterThan (src/services/__tests__/rateLimitingService.test.ts:251:49)

  ‚óè RateLimitingService ‚Ä∫ Performance and Load Testing ‚Ä∫ should enforce global concurrency limits under load

    TypeError: Cannot use 'in' operator to search for 'error' in success

      473 |       
      474 |       // Some should succeed, some should be rate limited
    > 475 |       const successes = results.filter(r => !('error' in r)).length;
          |                                               ^
      476 |       const rateLimited = results.filter(r => 
      477 |         'error' in r && r.error.includes('Rate limit exceeded')
      478 |       ).length;

      at src/services/__tests__/rateLimitingService.test.ts:475:47
          at Array.filter (<anonymous>)
      at Object.filter (src/services/__tests__/rateLimitingService.test.ts:475:33)

  ‚óè RateLimitingService ‚Ä∫ Background Tasks and Maintenance ‚Ä∫ should initialize without errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Rate limiting service initialized", Any<Object>

    Number of calls: 0

      522 |     it('should initialize without errors', () => {
      523 |       expect(rateLimitingService).toBeDefined();
    > 524 |       expect(logger.info).toHaveBeenCalledWith(
          |                           ^
      525 |         'Rate limiting service initialized',
      526 |         expect.any(Object)
      527 |       );

      at Object.toHaveBeenCalledWith (src/services/__tests__/rateLimitingService.test.ts:524:27)

  ‚óè RateLimitingService ‚Ä∫ Background Tasks and Maintenance ‚Ä∫ should provide meaningful recommended actions when issues detected

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      533 |       
      534 |       const metrics = rateLimitingService.getRateLimitingMetrics();
    > 535 |       expect(metrics.recommendedActions.length).toBeGreaterThan(0);
          |                                                 ^
      536 |       expect(metrics.recommendedActions[0]).toContain('Circuit breaker');
      537 |     });
      538 |   });

      at Object.toBeGreaterThan (src/services/__tests__/rateLimitingService.test.ts:535:49)

FAIL src/__tests__/unit/smartDataCollectionEdgeCases.test.ts
  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle empty competitor list gracefully

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      51 |     smartDataCollectionService = new SmartDataCollectionService();
      52 |     
    > 53 |     const result = await smartDataCollectionService.collectCompetitorData([], { projectId: 'project-123' });
         |                                                     ^
      54 |     
      55 |     expect(result).toBeDefined();
      56 |     expect(result.success).toBe(true);

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:53:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle web scraper initialization failure

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      75 |     
      76 |     // Should still complete with fallback data
    > 77 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
         |                                                     ^
      78 |       projectId: 'project-123',
      79 |       requireFreshSnapshots: true
      80 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:77:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle invalid competitor websites

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      104 |     
      105 |     // Should handle invalid URL
    > 106 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      107 |       projectId: 'project-123',
      108 |       requireFreshSnapshots: true
      109 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:106:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle timeouts during data collection

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      137 |     
      138 |     // Should timeout and fall back to existing data
    > 139 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      140 |       projectId: 'project-123',
      141 |       requireFreshSnapshots: true,
      142 |       maxCaptureTime: 500 // Very short timeout (500ms)

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:139:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle corrupted existing snapshot data

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      179 |     
      180 |     // Should handle corrupted data gracefully
    > 181 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      182 |       projectId: 'project-123',
      183 |       requireFreshSnapshots: false // Fall back to existing data
      184 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:181:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle database failures during collection

    TypeError: Cannot read properties of undefined (reading 'create')

      210 |     
      211 |     // Database failure
    > 212 |     (prisma.competitorSnapshot.create as jest.Mock).mockRejectedValue(
          |                                ^
      213 |       new Error('Database error')
      214 |     );
      215 |     

      at Object.create (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:212:32)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle priority fallbacks properly

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      256 |     
      257 |     // Should fall back to existing snapshots (Priority 4)
    > 258 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      259 |       projectId: 'project-123',
      260 |       requireFreshSnapshots: true // Try fresh first, but allow fallback
      261 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:258:53)

FAIL src/__tests__/unit/initialComparativeReportEdgeCases.test.ts
  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle missing project data gracefully

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      56 |     
      57 |     // Act
    > 58 |     const result = await initialComparativeReportService.generateInitialReport('non-existent-id');
         |                                                          ^
      59 |     
      60 |     // Assert
      61 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:58:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle project with no competitors

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      81 |     
      82 |     // Act
    > 83 |     const result = await initialComparativeReportService.generateInitialReport('project-123');
         |                                                          ^
      84 |     
      85 |     // Assert
      86 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:83:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle project with missing product data

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      104 |     
      105 |     // Act
    > 106 |     const result = await initialComparativeReportService.generateInitialReport('project-123');
          |                                                          ^
      107 |     
      108 |     // Assert
      109 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:106:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle competitors with no snapshots

    TypeError: Cannot read properties of undefined (reading 'findMany')

      126 |     });
      127 |     
    > 128 |     (prisma.competitorSnapshot.findMany as jest.Mock).mockResolvedValue([]);
          |                                ^
      129 |     
      130 |     const { InitialComparativeReportService } = await import('@/services/reports/initialComparativeReportService');
      131 |     initialComparativeReportService = new InitialComparativeReportService();

      at Object.findMany (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:128:32)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle database connection failures during competitor snapshot capture

    TypeError: Cannot read properties of undefined (reading 'create')

      157 |     
      158 |     // Mock database connection failure
    > 159 |     (prisma.competitorSnapshot.create as jest.Mock).mockRejectedValue(
          |                                ^
      160 |       new Error('Database connection error')
      161 |     );
      162 |     

      at Object.create (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:159:32)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle malformed data from competitors

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      202 |     
      203 |     // Act - Force partial data handling
    > 204 |     const result = await initialComparativeReportService.generateInitialReport('project-123', {
          |                                                          ^
      205 |       fallbackToPartialData: true
      206 |     });
      207 |     

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:204:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle timeouts during report generation

    TypeError: Cannot read properties of undefined (reading 'findFirst')

      237 |     });
      238 |     
    > 239 |     (prisma.productSnapshot.findFirst as jest.Mock).mockResolvedValue({
          |                             ^
      240 |       id: 'prod-snap-1',
      241 |       productId: 'product-123',
      242 |       metadata: { data: 'test' },

      at Object.findFirst (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:239:29)

FAIL src/__tests__/unit/featureFlagService.test.ts
  ‚óè FeatureFlagService ‚Ä∫ Caching Behavior ‚Ä∫ should cache feature flag results

    expect(received).toBeLessThan(expected)

    Expected: < 0
    Received:   0

      324 |       
      325 |       expect(result1).toBe(result2);
    > 326 |       expect(duration2).toBeLessThan(duration1); // Cached should be faster
          |                         ^
      327 |       
      328 |       await service.cleanup();
      329 |     });

      at Object.toBeLessThan (src/__tests__/unit/featureFlagService.test.ts:326:25)

FAIL src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts
  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should use partial data generator when data completeness < 70%

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: null, ObjectContaining {"name": "Test Product"}, ObjectContaining {"id": "snapshot-1"}, ObjectContaining {"acknowledgeDataLimitations": true, "includeDataGapSection": true, "includeRecommendations": true, "partialDataInfo": ObjectContaining {"dataCompletenessScore": 55, "dataFreshness": "existing", "qualityTier": "enhanced"}, "template": "comprehensive"}

    Number of calls: 0

      184 |
      185 |       // Verify partial data generator was used
    > 186 |       expect(mockPartialDataGenerator.generatePartialDataReport).toHaveBeenCalledWith(
          |                                                                  ^
      187 |         null, // Analysis should be null due to failed analysis
      188 |         expect.objectContaining({ name: 'Test Product' }),
      189 |         expect.objectContaining({ id: 'snapshot-1' }),

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:186:66)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should handle analysis failure gracefully in partial data mode

    Insufficient competitor data for analysis

      361 |       // Mock analysis failure
      362 |       mockComparativeAnalysisService.analyzeProductVsCompetitors.mockRejectedValue(
    > 363 |         new Error('Insufficient competitor data for analysis')
          |         ^
      364 |       );
      365 |       
      366 |       mockPartialDataGenerator.generatePartialDataReport.mockResolvedValue(mockPartialReport);

      at Object.<anonymous> (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:363:9)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should build correct partial data info from smart collection result

    expect(received).toEqual(expected) // deep equality

    - Expected  - 7
    + Received  + 4

    @@ -6,20 +6,17 @@
          "hasProductData": true,
          "hasSnapshots": true,
        },
        "dataCompletenessScore": 65,
        "dataFreshness": "mixed",
    -   "dataGaps": ArrayContaining [
    -     ObjectContaining {
    -       "area": "Competitor Website Snapshots",
    -       "canBeImproved": true,
    -       "impact": "high",
    -     },
    -     ObjectContaining {
    +   "dataGaps": Array [
    +     Object {
            "area": "Competitor Data Coverage",
            "canBeImproved": true,
    +       "description": "Only 3/4 competitors have sufficient data for analysis.",
            "impact": "medium",
    +       "recommendation": "Collect additional competitor information to improve analysis completeness",
          },
        ],
        "missingData": Array [
          "2 fresh competitor snapshots",
        ],

      405 |       const partialDataInfo = (service as any).buildPartialDataInfo(mockSmartCollectionResult);
      406 |
    > 407 |       expect(partialDataInfo).toEqual({
          |                               ^
      408 |         dataCompletenessScore: 65,
      409 |         dataFreshness: 'mixed',
      410 |         availableData: {

      at Object.toEqual (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:407:31)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ buildPartialDataInfo ‚Ä∫ should build correct partial data info from smart collection result

    expect(received).toEqual(expected) // deep equality

    - Expected  - 7
    + Received  + 4

    @@ -6,20 +6,17 @@
          "hasProductData": true,
          "hasSnapshots": true,
        },
        "dataCompletenessScore": 65,
        "dataFreshness": "mixed",
    -   "dataGaps": ArrayContaining [
    -     ObjectContaining {
    -       "area": "Competitor Website Snapshots",
    -       "canBeImproved": true,
    -       "impact": "high",
    -     },
    -     ObjectContaining {
    +   "dataGaps": Array [
    +     Object {
            "area": "Competitor Data Coverage",
            "canBeImproved": true,
    +       "description": "Only 3/4 competitors have sufficient data for analysis.",
            "impact": "medium",
    +       "recommendation": "Collect additional competitor information to improve analysis completeness",
          },
        ],
        "missingData": Array [
          "2 fresh competitor snapshots",
        ],

      547 |       const partialDataInfo = (service as any).buildPartialDataInfo(mockSmartCollectionResult);
      548 |
    > 549 |       expect(partialDataInfo).toEqual({
          |                               ^
      550 |         dataCompletenessScore: 65,
      551 |         dataFreshness: 'mixed',
      552 |         availableData: {

      at Object.toEqual (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:549:31)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify no fresh snapshots gap

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:743:48)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify partial competitor coverage gap

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:764:48)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify overall data quality gap for very low scores

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:785:48)

FAIL src/__tests__/integration/observabilityIntegration.test.ts
  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should emit structured logs for immediate report generation

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should include correlation IDs across service calls

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should log security events appropriately

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should emit comprehensive metrics for report generation lifecycle

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should track snapshot capture metrics accurately

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should monitor queue and resource utilization

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Error Tracking Integration ‚Ä∫ should capture and contextualize report generation errors

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Error Tracking Integration ‚Ä∫ should track error patterns and recovery

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Performance Monitoring Integration ‚Ä∫ should track operation latencies and throughput

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Performance Monitoring Integration ‚Ä∫ should monitor resource utilization patterns

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Business Event Tracking ‚Ä∫ should track business metrics and user interactions

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Business Event Tracking ‚Ä∫ should track configuration and feature flag changes

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Alerting Integration ‚Ä∫ should trigger alerts for critical failures

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Alerting Integration ‚Ä∫ should track SLA violations and performance degradation

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Dashboard Integration Validation ‚Ä∫ should provide all necessary metrics for dashboards

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ End-to-End Observability Validation ‚Ä∫ should validate complete observability stack integration

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)


  ‚óè Test suite failed to run

    RangeError: Maximum call stack size exceeded
        at Array.at (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at ModuleMocker._ensureMockState (node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:208:36)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

FAIL src/__tests__/unit/services/comparativeReportService.test.ts
  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should generate comprehensive report with all sections

    expect(received).toContain(expected) // indexOf

    Expected substring: "Comprehensive"
    Received string:    "Test Product - Competitive Analysis"

      246 |       expect(result.report.id).toBeDefined();
      247 |       expect(result.report.title).toContain('Test Product');
    > 248 |       expect(result.report.title).toContain('Comprehensive');
          |                                   ^
      249 |       expect(result.report.projectId).toBe(sampleProduct.projectId);
      250 |       expect(result.report.productId).toBe(sampleProduct.id);
      251 |       expect(result.report.analysisId).toBe(sampleAnalysis.id);

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:248:35)

  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should use default template when none specified

    expect(received).toBe(expected) // Object.is equality

    Expected: "markdown"
    Received: undefined

      353 |
      354 |       expect(result.report.sections).toHaveLength(6); // Default comprehensive template
    > 355 |       expect(result.report.format).toBe('markdown'); // Default format
          |                                    ^
      356 |     });
      357 |
      358 |     it('should throw error for invalid template', async () => {

      at Object.toBe (src/__tests__/unit/services/comparativeReportService.test.ts:355:36)

  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should handle section generation errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cost": 0.0015, "errors": [], "generationTime": 1000, "report": {"analysisId": "mock-analysis-id", "competitiveIntelligence": {"competitiveAdvantages": ["AI-first approach"], "marketPosition": "competitive", "opportunities": ["Enterprise market"]}, "description": "Mock report description", "executiveSummary": "Mock executive summary", "format": undefined, "id": "mock-report-id", "keyFindings": ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"], "keyOpportunities": ["Mock opportunity 1"], "keyThreats": ["Mock threat 1"], "metadata": {"analysisMethod": "ai_powered", "competitorCount": 1, "confidenceScore": 92, "dataQuality": "high", "generatedAt": "2025-07-10T11:37:51.134Z", "productName": "Test Product", "template": "comprehensive", "version": "1.0"}, "productId": "mock-product-id", "projectId": "mock-project-id", "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 3, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "User experience comparison analysis", "id": "ux-comparison", "order": 4, "title": "User Experience", "type": "ux_comparison"}, {"content": "Customer targeting analysis", "id": "customer-targeting", "order": 5, "title": "Customer Targeting", "type": "customer_targeting"}, {"content": "Actionable recommendations based on analysis", "id": "recommendations", "order": 6, "title": "Strategic Recommendations", "type": "recommendations"}], "status": "completed", "strategicRecommendations": {"immediate": ["Improve mobile"], "longTerm": ["Expand to new markets"], "priorityScore": 88, "shortTerm": ["Add enterprise features"]}, "title": "Test Product - Competitive Analysis"}, "tokensUsed": 500, "warnings": []}

      376 |       } as unknown as ComparativeAnalysis;
      377 |
    > 378 |       await expect(service.generateComparativeReport(
          |                   ^
      379 |         incompleteAnalysis,
      380 |         sampleProduct,
      381 |         sampleProductSnapshot

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeReportService.test.ts:378:19)

  ‚óè ComparativeReportService ‚Ä∫ generateEnhancedReportContent ‚Ä∫ should generate enhanced content using AI

    TypeError: service.generateEnhancedReportContent is not a function

      403 |       mockBedrockService.generateCompletion.mockResolvedValue(mockEnhancedContent);
      404 |
    > 405 |       const result = await service.generateEnhancedReportContent(
          |                                    ^
      406 |         'test-analysis-id',
      407 |         REPORT_TEMPLATES.COMPREHENSIVE,
      408 |         {

      at Object.generateEnhancedReportContent (src/__tests__/unit/services/comparativeReportService.test.ts:405:36)

  ‚óè ComparativeReportService ‚Ä∫ generateEnhancedReportContent ‚Ä∫ should handle AI service errors

    TypeError: service.generateEnhancedReportContent is not a function

      431 |       mockBedrockService.generateCompletion.mockRejectedValue(new Error('AI service unavailable'));
      432 |
    > 433 |       await expect(service.generateEnhancedReportContent(
          |                            ^
      434 |         'test-analysis-id',
      435 |         REPORT_TEMPLATES.COMPREHENSIVE
      436 |       )).rejects.toThrow(ReportGenerationError);

      at Object.generateEnhancedReportContent (src/__tests__/unit/services/comparativeReportService.test.ts:433:28)

  ‚óè ComparativeReportService ‚Ä∫ getAvailableTemplates ‚Ä∫ should return all available templates

    expect(received).toBe(expected) // Object.is equality

    Expected: "Comprehensive Comparative Analysis"
    Received: "Comprehensive Analysis"

      453 |       const comprehensiveTemplate = templates.find(t => t.id === REPORT_TEMPLATES.COMPREHENSIVE);
      454 |       expect(comprehensiveTemplate).toBeDefined();
    > 455 |       expect(comprehensiveTemplate!.name).toBe('Comprehensive Comparative Analysis');
          |                                           ^
      456 |       expect(comprehensiveTemplate!.sectionTemplates).toHaveLength(6);
      457 |       expect(comprehensiveTemplate!.focusAreas).toEqual(['features', 'positioning', 'user_experience', 'customer_targeting']);
      458 |     });

      at Object.toBe (src/__tests__/unit/services/comparativeReportService.test.ts:455:43)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing detailed analysis

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: detailed"

    Received function did not throw

      481 |
      482 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 483 |         .toThrow('Analysis missing required field for reporting: detailed');
          |          ^
      484 |     });
      485 |
      486 |     it('should throw error for missing recommendations', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:483:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing recommendations

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: recommendations"

    Received function did not throw

      491 |
      492 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 493 |         .toThrow('Analysis missing required field for reporting: recommendations');
          |          ^
      494 |     });
      495 |
      496 |     it('should throw error for missing metadata', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:493:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing metadata

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: metadata"

    Received function did not throw

      501 |
      502 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 503 |         .toThrow('Analysis missing required field for reporting: metadata');
          |          ^
      504 |     });
      505 |
      506 |     it('should warn for low confidence analysis but not throw', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:503:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should warn for low confidence analysis but not throw

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Analysis confidence score is low for reporting", ObjectContaining {"analysisId": "test_analysis_123", "confidenceScore": 40}

    Number of calls: 0

      516 |
      517 |       expect(() => service.validateAnalysisForReporting(lowConfidenceAnalysis)).not.toThrow();
    > 518 |       expect(loggerSpy).toHaveBeenCalledWith(
          |                         ^
      519 |         'Analysis confidence score is low for reporting',
      520 |         expect.objectContaining({
      521 |           analysisId: sampleAnalysis.id,

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/comparativeReportService.test.ts:518:25)

  ‚óè ComparativeReportService ‚Ä∫ template content generation ‚Ä∫ should populate template variables correctly

    expect(received).toContain(expected) // indexOf

    Expected substring: "Test Product"
    Received string:    "Comprehensive executive summary of competitive analysis"

      538 |
      539 |       const executiveSummary = result.report.sections.find(s => s.type === 'executive_summary');
    > 540 |       expect(executiveSummary?.content).toContain('Test Product');
          |                                         ^
      541 |       expect(executiveSummary?.content).toContain('competitive');
      542 |       expect(executiveSummary?.content).toContain('85');
      543 |       expect(executiveSummary?.content).toContain('low');

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:540:41)

  ‚óè ComparativeReportService ‚Ä∫ report content structure ‚Ä∫ should include executive summary in keyFindings

    expect(received).toContain(expected) // indexOf

    Expected value: "Strength: Strong AI capabilities"
    Received array: ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"]

      585 |       );
      586 |
    > 587 |       expect(result.report.keyFindings).toContain('Strength: Strong AI capabilities');
          |                                         ^
      588 |       expect(result.report.keyFindings).toContain('Weakness: Limited market presence');
      589 |       expect(result.report.keyFindings).toContain('Market Position: competitive');
      590 |       expect(result.report.keyFindings).toContain('Opportunity Score: 85/100');

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:587:41)

  ‚óè ComparativeReportService ‚Ä∫ report content structure ‚Ä∫ should extract key threats correctly

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      598 |       );
      599 |
    > 600 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Overall threat level: low');
          |                                                                ^
      601 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Advanced API features');
      602 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Mobile optimization');
      603 |     });

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:600:64)

FAIL src/__tests__/integration/awsCredentialIntegration.test.ts
  ‚óè AWS Credential Integration ‚Ä∫ Bedrock Service Integration ‚Ä∫ should create Bedrock service with environment fallback

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      247 |       // Ensure no stored credentials
      248 |       const profiles = await awsCredentialService.listCredentialProfiles();
    > 249 |       expect(profiles.length).toBe(0);
          |                               ^
      250 |
      251 |       // Set environment variables
      252 |       process.env.AWS_ACCESS_KEY_ID = 'env-access-key';

      at Object.toBe (src/__tests__/integration/awsCredentialIntegration.test.ts:249:31)

  ‚óè AWS Credential Integration ‚Ä∫ Bedrock Service Integration ‚Ä∫ should create Bedrock service factory method with stored credentials

    TypeError: _bedrockservice.BedrockService.createWithStoredCredentials is not a function

      271 |
      272 |       // This should work without throwing
    > 273 |       const service = await BedrockService.createWithStoredCredentials('anthropic');
          |                                            ^
      274 |       expect(service).toBeInstanceOf(BedrockService);
      275 |     });
      276 |   });

      at Object.createWithStoredCredentials (src/__tests__/integration/awsCredentialIntegration.test.ts:273:44)

  ‚óè AWS Credential Integration ‚Ä∫ Analysis Service Integration ‚Ä∫ should initialize ComparativeAnalysisService with stored credentials

    expect(received).toBeInstanceOf(expected)

    Expected constructor: mockConstructor
    Received constructor: Object

      285 |       
      286 |       // This tests that the service can be created without throwing
    > 287 |       expect(analysisService).toBeInstanceOf(ComparativeAnalysisService);
          |                               ^
      288 |
      289 |       // Test configuration update (should trigger credential refresh)
      290 |       analysisService.updateAnalysisConfiguration({

      at Object.toBeInstanceOf (src/__tests__/integration/awsCredentialIntegration.test.ts:287:31)

  ‚óè AWS Credential Integration ‚Ä∫ Multiple Profile Support ‚Ä∫ should handle multiple credential profiles

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 1

      314 |       // List profiles
      315 |       const profiles = await awsCredentialService.listCredentialProfiles();
    > 316 |       expect(profiles.length).toBe(2);
          |                               ^
      317 |
      318 |       // Get credentials with preferred profile
      319 |       const credentials1 = await credentialProvider.getCredentials({

      at Object.toBe (src/__tests__/integration/awsCredentialIntegration.test.ts:316:31)

  ‚óè AWS Credential Integration ‚Ä∫ Multiple Profile Support ‚Ä∫ should use first valid profile when no preference specified

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 2

      Object {
    -   "accessKeyId": "AKIAZJC8IBPZHRQ",
    -   "secretAccessKey": "test-secret-2-uzob5drd56",
    +   "accessKeyId": "AKIAZLND9EFAF1",
    +   "secretAccessKey": "test-secret-8y3l642pi2f",
      }

      364 |       // Should use the valid profile
      365 |       const credentials = await credentialProvider.getCredentials();
    > 366 |       expect(credentials).toMatchObject({
          |                           ^
      367 |         accessKeyId: secondTestCredentials.accessKeyId,
      368 |         secretAccessKey: secondTestCredentials.secretAccessKey
      369 |       });

      at Object.toMatchObject (src/__tests__/integration/awsCredentialIntegration.test.ts:366:27)

FAIL src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts
  ‚óè Console

    console.log
      [DEBUG] Parsing comprehensive input: user@company.com
              Weekly
              Good Chop Analysis
              https://goodchop.com
              Product: Good Chop
              Industry: Food Delivery...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@company.com
       Weekly
       Good Chop Analysis
       https://goodchop.com
       Product: Good Chop
       Industry: Food Delivery...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@company.com
              Monthly
              Analysis Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@company.com
       Monthly
       Analysis Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@company.com
              Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@company.com
       Weekly...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: invalid-email
              Weekly
              Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: invalid-email
       Weekly
       Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@company.com
              InvalidFrequency
              Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@company.com
       InvalidFrequency
       Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Hi, I'd like to create a competitive analysis project.
              My email is john@startup.com and I want weekly reports.
              The project should be called "Startup Competitive Analysis".
         ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Hi, I"d like to create a competitive analysis project.
       My email is john@startup.com and I want weekly reports.
       The project should be called "Startup Competitive Analysis".
       Our product website is ht...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              Email: sarah@foodtech.com
              I need monthly competitive reports
              Project name: Food Delivery Analysis
              Our website: https://fooddelivery.app
              Industry: Food Technolo...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: Email: sarah@foodtech.com
       I need monthly competitive reports
       Project name: Food Delivery Analysis
       Our website: https://fooddelivery.app
       Industry: Food Technology...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              I want to analyze competitors but I don't have all the details yet.
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: I want to analyze competitors but I don"t have all the details yet....

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                https://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       https://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                not-a-url...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       not-a-url...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                ftp://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       ftp://example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                mailto:test@example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       mailto:test@example.com...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                javascript:alert(1)...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       javascript:alert(1)...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                http://...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       http://...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                https://...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       https://...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: invalid-email
              InvalidFrequency...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: invalid-email
       InvalidFrequency...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@company.com
              Weekly
              Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@company.com
       Weekly
       Test Project...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Good Chop Analysis...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Good Chop Analysis...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
              Weekly
              Generic Analysis Project
              Product: Specific Product Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Generic Analysis Project
       Product: Specific Product Name...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: user@test.com
                Weekly
                Test Project
                Industry: Food Technology...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Preprocessed message: user@test.com
       Weekly
       Test Project
       Industry: Food Technology...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)
          at Array.forEach (<anonymous>)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)
          at Array.forEach (<anonymous>)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should extract basic project information from structured input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      15 |       const result = enhancedProjectExtractor.extractProjectData(message);
      16 |
    > 17 |       expect(result.success).toBe(true);
         |                              ^
      18 |       expect(result.data).toEqual({
      19 |         userEmail: 'user@company.com',
      20 |         frequency: 'Weekly',

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:17:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should handle missing product website gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      39 |       const result = enhancedProjectExtractor.extractProjectData(message);
      40 |
    > 41 |       expect(result.success).toBe(true);
         |                              ^
      42 |       expect(result.data?.productWebsite).toBeUndefined();
      43 |       expect(result.suggestions).toContain('Consider including your product website URL for better analysis');
      44 |     });

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:41:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should fail with insufficient information

    expect(received).toContain(expected) // indexOf

    Expected value: "Project name too short or missing in third line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      53 |
      54 |       expect(result.success).toBe(false);
    > 55 |       expect(result.errors).toContain('Project name too short or missing in third line');
         |                             ^
      56 |     });
      57 |
      58 |     it('should validate email format', () => {

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:55:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should validate email format

    expect(received).toContain(expected) // indexOf

    Expected value: "Invalid email address format in first line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      66 |
      67 |       expect(result.success).toBe(false);
    > 68 |       expect(result.errors).toContain('Invalid email address format in first line');
         |                             ^
      69 |     });
      70 |
      71 |     it('should validate frequency format', () => {

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:68:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should validate frequency format

    expect(received).toContain(expected) // indexOf

    Expected value: "Invalid frequency in second line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      79 |
      80 |       expect(result.success).toBe(false);
    > 81 |       expect(result.errors).toContain('Invalid frequency in second line');
         |                             ^
      82 |     });
      83 |   });
      84 |

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:81:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should extract information from natural language input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

       96 |       const result = enhancedProjectExtractor.extractProjectData(message);
       97 |
    >  98 |       expect(result.success).toBe(true);
          |                              ^
       99 |       expect(result.data?.userEmail).toBe('john@startup.com');
      100 |       expect(result.data?.frequency).toBe('weekly');
      101 |       expect(result.data?.projectName).toBe('Startup Competitive Analysis');

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:98:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should handle mixed format input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      115 |       const result = enhancedProjectExtractor.extractProjectData(message);
      116 |
    > 117 |       expect(result.success).toBe(true);
          |                              ^
      118 |       expect(result.data?.userEmail).toBe('sarah@foodtech.com');
      119 |       expect(result.data?.frequency).toBe('monthly');
      120 |       expect(result.data?.projectName).toBe('Food Delivery Analysis');

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:117:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should fail gracefully with missing required information

    expect(received).toContain(expected) // indexOf

    Expected value: "Email address not found in message"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      131 |
      132 |       expect(result.success).toBe(false);
    > 133 |       expect(result.errors).toContain('Email address not found in message');
          |                             ^
      134 |       expect(result.errors).toContain('Report frequency not specified');
      135 |       expect(result.errors).toContain('Project name not identified');
      136 |     });

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:133:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ URL Validation ‚Ä∫ should validate and clean URLs correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      157 |
      158 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 159 |         expect(result.success).toBe(true);
          |                                ^
      160 |         expect(result.data?.productWebsite).toBe(expected);
      161 |       });
      162 |     });

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:159:32)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:150:17)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Error Messages ‚Ä∫ should return empty string for successful extractions

    expect(received).toBe(expected) // Object.is equality

    Expected: ""
    Received: "‚ö†Ô∏è **Missing Required Information**¬∑
    **Issues Found:**
    1. Failed to parse project information: this.extractFromLineByLineFormat is not a function¬∑
    **Please provide:**
    ‚Ä¢ Please provide your information in this format:
    ‚Ä¢ 1. Email address
    ‚Ä¢ 2. Report frequency (Weekly/Monthly)
    ‚Ä¢ 3. Project name
    ‚Ä¢ 4. Product website URL
    ‚Ä¢ 5. Product name (optional)
    ‚Ä¢ 6. Industry (optional)¬∑
    **üí° Tip:** You can provide information in any order or format. I'll extract what I need!"

      213 |       const errorMessage = enhancedProjectExtractor.createActionableErrorMessage(result);
      214 |
    > 215 |       expect(errorMessage).toBe('');
          |                            ^
      216 |     });
      217 |   });
      218 |

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:215:28)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Product Name Extraction ‚Ä∫ should extract product name from project name patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: "Good Chop"
    Received: undefined

      272 |
      273 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 274 |         expect(result.data?.productName).toBe(expected);
          |                                          ^
      275 |       });
      276 |     });
      277 |

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:274:42)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:266:17)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Product Name Extraction ‚Ä∫ should prioritize explicit product declarations

    expect(received).toBe(expected) // Object.is equality

    Expected: "Specific Product Name"
    Received: undefined

      285 |
      286 |       const result = enhancedProjectExtractor.extractProjectData(message);
    > 287 |       expect(result.data?.productName).toBe('Specific Product Name');
          |                                        ^
      288 |     });
      289 |   });
      290 |

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:287:40)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Industry Detection ‚Ä∫ should detect industry from various patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: "Food Technology"
    Received: undefined

      306 |
      307 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 308 |         expect(result.data?.industry).toBe(expected);
          |                                       ^
      309 |       });
      310 |     });
      311 |   });

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:308:39)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:299:17)

FAIL src/services/reports/__tests__/smartDataCollectionIntegration.test.ts
  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should use SmartDataCollectionService instead of basic capture methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      165 |         // Expected since we haven't mocked all the dependencies fully
      166 |         // The important thing is that smart data collection was called
    > 167 |         expect(collectProjectDataSpy).toHaveBeenCalled();
          |                                       ^
      168 |       }
      169 |     });
      170 |

      at Object.toHaveBeenCalled (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:167:39)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should handle smart data collection with priority fallbacks

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      228 |       } catch (error) {
      229 |         // Expected due to incomplete mocking
    > 230 |         expect(collectProjectDataSpy).toHaveBeenCalled();
          |                                       ^
      231 |       }
      232 |     });
      233 |

      at Object.toHaveBeenCalled (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:230:39)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should fail gracefully when smart data collection fails

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"analysisId": "mock-analysis-id", "competitiveIntelligence": {"competitiveAdvantages": ["AI-first approach"], "marketPosition": "competitive", "opportunities": ["Enterprise market"]}, "description": "Mock report description - Generated immediately upon project creation with 76% data completeness.", "executiveSummary": "Mock executive summary", "format": "markdown", "id": "mock-report-id", "keyFindings": ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"], "keyOpportunities": ["Mock opportunity 1"], "keyThreats": ["Mock threat 1"], "metadata": {"analysisMethod": "ai_powered", "competitorCount": 1, "confidenceScore": 92, "dataQuality": "high", "generatedAt": "2025-07-10T11:37:51.462Z", "productName": "Test Product", "reportVersion": "1.0-initial", "template": "comprehensive", "version": "1.0"}, "productId": "mock-product-id", "projectId": "mock-project-id", "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 3, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "User experience comparison analysis", "id": "ux-comparison", "order": 4, "title": "User Experience", "type": "ux_comparison"}, {"content": "Customer targeting analysis", "id": "customer-targeting", "order": 5, "title": "Customer Targeting", "type": "customer_targeting"}, {"content": "Actionable recommendations based on analysis", "id": "recommendations", "order": 6, "title": "Strategic Recommendations", "type": "recommendations"}], "status": "completed", "strategicRecommendations": {"immediate": ["Improve mobile"], "longTerm": ["Expand to new markets"], "priorityScore": 88, "shortTerm": ["Add enterprise features"]}, "title": "Test Product - Competitive Analysis (Initial Report)"}

      272 |         .mockResolvedValue(mockFailedResult as any);
      273 |
    > 274 |       await expect(
          |             ^
      275 |         initialReportService.generateInitialComparativeReport('project-1')
      276 |       ).rejects.toThrow('Smart data collection failed');
      277 |

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.expect (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:274:13)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Data Source Priority Verification ‚Ä∫ should prioritize fresh snapshots over existing data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"requireFreshSnapshots": true}

    Number of calls: 0

      292 |       }
      293 |
    > 294 |       expect(spy).toHaveBeenCalledWith('project-1', 
          |                   ^
      295 |         expect.objectContaining({
      296 |           requireFreshSnapshots: true
      297 |         })

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:294:19)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Data Source Priority Verification ‚Ä∫ should respect timeout allocation for data collection vs analysis

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"maxCaptureTime": 75000}

    Number of calls: 0

      310 |       }
      311 |
    > 312 |       expect(spy).toHaveBeenCalledWith('project-1',
          |                   ^
      313 |         expect.objectContaining({
      314 |           maxCaptureTime: 75000 // 90000 - 15000 reserved for analysis
      315 |         })

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:312:19)

FAIL src/services/__tests__/configurationManagementService.test.ts
  ‚óè ConfigurationManagementService ‚Ä∫ Configuration Updates ‚Ä∫ should successfully update valid configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      113 |       });
      114 |
    > 115 |       expect(result.success).toBe(true);
          |                              ^
      116 |       expect(result.updatedFields).toEqual(['SNAPSHOT_CAPTURE_TIMEOUT', 'MAX_CONCURRENT_SNAPSHOTS_PER_PROJECT']);
      117 |       expect(result.rollbackInfo).toBeDefined();
      118 |       expect(result.updatedBy).toBe('test-user');

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:115:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Configuration Updates ‚Ä∫ should create audit log entries for updates

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      170 |
      171 |       const auditLog = configService.getAuditLog(10);
    > 172 |       expect(auditLog.length).toBeGreaterThan(0);
          |                               ^
      173 |
      174 |       const latestEntry = auditLog[0];
      175 |       expect(latestEntry.action).toBe('update');

      at Object.toBeGreaterThan (src/services/__tests__/configurationManagementService.test.ts:172:31)

  ‚óè ConfigurationManagementService ‚Ä∫ Audit Log ‚Ä∫ should maintain audit log of all changes

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      291 |
      292 |       const auditLog = configService.getAuditLog(10);
    > 293 |       expect(auditLog.length).toBe(2);
          |                               ^
      294 |
      295 |       // Should be sorted by timestamp (newest first)
      296 |       expect(auditLog[0].updatedBy).toBe('user2');

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:293:31)

  ‚óè ConfigurationManagementService ‚Ä∫ Audit Log ‚Ä∫ should respect audit log limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 0

      309 |
      310 |       const limitedLog = configService.getAuditLog(3);
    > 311 |       expect(limitedLog.length).toBe(3);
          |                                 ^
      312 |     });
      313 |   });
      314 |

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:311:33)

  ‚óè ConfigurationManagementService ‚Ä∫ Rollback Functionality ‚Ä∫ should provide rollback tokens for updates

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      325 |       });
      326 |
    > 327 |       expect(result.success).toBe(true);
          |                              ^
      328 |       expect(result.rollbackInfo).toBeDefined();
      329 |       expect(result.rollbackInfo!.rollbackToken).toBeDefined();
      330 |       expect(result.rollbackInfo!.previousValues).toEqual({

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:327:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Error Handling ‚Ä∫ should handle missing configuration fields gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      384 |       });
      385 |
    > 386 |       expect(result.success).toBe(true);
          |                              ^
      387 |       expect(result.updatedFields).toEqual([]); // No valid fields updated
      388 |     });
      389 |

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:386:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Error Handling ‚Ä∫ should handle internal errors gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Internal error"
    Received string:    "HOURLY_SNAPSHOT_LIMIT: Hourly limit should not exceed daily limit when extrapolated"

      399 |       expect(result.success).toBe(false);
      400 |       expect(result.validationErrors).toBeDefined();
    > 401 |       expect(result.validationErrors![0]).toContain('Internal error');
          |                                           ^
      402 |     });
      403 |   });
      404 | }); 

      at Object.toContain (src/services/__tests__/configurationManagementService.test.ts:401:43)

FAIL src/__tests__/performance/cachingStrategy.test.ts
  ‚óè Console

    console.error
      Failed to initialize Redis client: TypeError: redisClient.on is not a function
          at on (/Users/nikita.gorshkov/competitor-research-agent/src/lib/redis-cache.ts:53:17)
          at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/performance/cachingStrategy.test.ts:105:32)
          at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

      72 |     await redisClient.connect();
      73 |   } catch (error) {
    > 74 |     console.error('Failed to initialize Redis client:', error);
         |             ^
      75 |     isConnected = false;
      76 |   }
      77 | }

      at error (src/lib/redis-cache.ts:74:13)
      at Object.<anonymous> (src/__tests__/performance/cachingStrategy.test.ts:105:32)

  ‚óè Redis Cache Implementation ‚Ä∫ should initialize Redis client successfully

    expect(received).toHaveBeenCalled()

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function initializeRedisClient]

      104 |   test('should initialize Redis client successfully', async () => {
      105 |     await initializeRedisClient();
    > 106 |     expect(initializeRedisClient).toHaveBeenCalled();
          |                                   ^
      107 |   });
      108 |
      109 |   test('should use withRedisCache correctly', async () => {

      at Object.toHaveBeenCalled (src/__tests__/performance/cachingStrategy.test.ts:106:35)

  ‚óè Redis Cache Integration with API Endpoints ‚Ä∫ should cache competitor list results

    TypeError: _rediscache.withRedisCache.mockImplementation is not a function

      139 |     
      140 |     // Reset withRedisCache mock for each test
    > 141 |     (withRedisCache as jest.Mock).mockImplementation(async (fn, keyPrefix, params) => {
          |                                   ^
      142 |       return fn(params);
      143 |     });
      144 |   });

      at Object.mockImplementation (src/__tests__/performance/cachingStrategy.test.ts:141:35)

  ‚óè Redis Cache Integration with API Endpoints ‚Ä∫ should handle search parameters

    TypeError: _rediscache.withRedisCache.mockImplementation is not a function

      139 |     
      140 |     // Reset withRedisCache mock for each test
    > 141 |     (withRedisCache as jest.Mock).mockImplementation(async (fn, keyPrefix, params) => {
          |                                   ^
      142 |       return fn(params);
      143 |     });
      144 |   });

      at Object.mockImplementation (src/__tests__/performance/cachingStrategy.test.ts:141:35)

FAIL src/services/reports/__tests__/reportQualityService.test.ts
  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should handle missing competitor data

    expect(received).toMatch(expected)

    Expected pattern: /^(poor|critical)$/
    Received string:  "fair"

      234 |
      235 |       expect(assessment.qualityScore.dataCompleteness).toBeLessThan(50);
    > 236 |       expect(assessment.qualityTier).toMatch(/^(poor|critical)$/);
          |                                      ^
      237 |     });
      238 |
      239 |     it('should calculate data freshness correctly', async () => {

      at Object.toMatch (src/services/reports/__tests__/reportQualityService.test.ts:236:38)

  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should calculate data freshness correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      261 |         rec => rec.category === 'freshness'
      262 |       );
    > 263 |       expect(hasFreshnessRec).toBe(true);
          |                               ^
      264 |     });
      265 |
      266 |     it('should generate section-specific confidence indicators', async () => {

      at Object.toBe (src/services/reports/__tests__/reportQualityService.test.ts:263:31)

  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should calculate improvement potential correctly

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 91
    Received:    81

      339 |
      340 |       expect(assessment.improvement.possibleScore).toBeGreaterThanOrEqual(assessment.qualityScore.overall);
    > 341 |       expect(assessment.improvement.potentialScore).toBeGreaterThanOrEqual(assessment.improvement.possibleScore);
          |                                                     ^
      342 |       expect(assessment.improvement.potentialScore).toBeLessThanOrEqual(100);
      343 |       
      344 |       // Quick wins should be immediate, free improvements

      at Object.toBeGreaterThanOrEqual (src/services/reports/__tests__/reportQualityService.test.ts:341:53)

  ‚óè ReportQualityService ‚Ä∫ quality tier determination ‚Ä∫ should assign critical tier for very low scores

    expect(received).toBe(expected) // Object.is equality

    Expected: "critical"
    Received: "poor"

      445 |
      446 |       expect(assessment.qualityScore.overall).toBeLessThan(40);
    > 447 |       expect(assessment.qualityTier).toBe('critical');
          |                                      ^
      448 |     });
      449 |   });
      450 |

      at Object.toBe (src/services/reports/__tests__/reportQualityService.test.ts:447:38)

  ‚óè ReportQualityService ‚Ä∫ recommendation generation ‚Ä∫ should generate section-specific recommendations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      560 |         rec => rec.category === 'coverage'
      561 |       );
    > 562 |       expect(coverageRecs.length).toBeGreaterThan(0);
          |                                   ^
      563 |     });
      564 |   });
      565 |

      at Object.toBeGreaterThan (src/services/reports/__tests__/reportQualityService.test.ts:562:35)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle reports with no sections

    expect(received).toBeLessThan(expected)

    Expected: < 50
    Received:   77

      579 |       );
      580 |
    > 581 |       expect(assessment.qualityScore.overall).toBeLessThan(50);
          |                                               ^
      582 |       expect(assessment.qualityTier).toMatch(/^(poor|critical)$/);
      583 |     });
      584 |

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:581:47)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle missing product information gracefully

    expect(received).toBeLessThan(expected)

    Expected: < 80
    Received:   92

      598 |       );
      599 |
    > 600 |       expect(assessment.qualityScore.dataCompleteness).toBeLessThan(80);
          |                                                        ^
      601 |     });
      602 |
      603 |     it('should handle undefined competitor data', async () => {

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:600:56)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle very old reports correctly

    expect(received).toBeLessThan(expected)

    Expected: < 30
    Received:   63

      631 |       );
      632 |
    > 633 |       expect(assessment.qualityScore.dataFreshness).toBeLessThan(30);
          |                                                     ^
      634 |     });
      635 |   });
      636 |

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:633:53)

FAIL src/services/reports/__tests__/initialComparativeReportService.test.ts
  ‚óè InitialComparativeReportService ‚Ä∫ Method Signatures ‚Ä∫ generateInitialComparativeReport should have correct signature

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 1

      107 |       const method = service.generateInitialComparativeReport;
      108 |       expect(method).toBeDefined();
    > 109 |       expect(method.length).toBe(2); // projectId and options parameters
          |                             ^
      110 |     });
      111 |
      112 |     it('validateProjectReadiness should have correct signature', () => {

      at Object.toBe (src/services/reports/__tests__/initialComparativeReportService.test.ts:109:29)

FAIL src/__tests__/unit/analysis.test.ts
  ‚óè ContentAnalyzer ‚Ä∫ Constructor ‚Ä∫ should initialize with AWS Bedrock client

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
        "credentials": Object {
          "accessKeyId": "test-key",
          "secretAccessKey": "test-secret",
    +     "sessionToken": "IQoJb3JpZ2luX2VjELT//////////wEaCWV1LXdlc3QtMSJGMEQCIH2vc4TTzp9Hko9WHQSZQnTDLPgJ/iKw3O9JXYUxp0ejAiB4KPCSiQvy+S2vuRAZEmS04dMN0aSt3hPZQOKPIX3XkSrbAwi9//////////8BEAAaDDk1MTcxOTE3NTUwNiIMDvmACfLXDZ3248R5Kq8DYOZY2uUYfw5yJZ69LegV7pkZZDHN+dBhbuDF648P/IIivUD8bazX7dEm41gP8K4Cz22QOpsPC9aYGtpi4lHVx+wK7smp7VSHFyJUTZqrB+KnaubSkKQwAh9TWMwb/rxGbtVTD9pcKJaCadE2rtd8nqBbIJ43ej8m+kTpTzXVstrlPR4kzKi6ZpMyRFfW3SNd3VfCDMysqPpzICUqeR3IVkwtOoot3hOKwFtXFdCy1tIJuxhAZKVSj5jZYPVG77ug9sQJqdU7qtRqRgsfvp5VFQHSgBfiUNcsZKkuhrfhQBzR+rMXtcvvkOhESphttSsVj7mK25aGg1ZJq9/teDeLeRrYTZQs38FlDjCsin492oSIyFvdNjQ6j57wYVEieMsT//8rEcBR5HD0EjMXxYNIgDVRDtPjilHEvBI/hSdE43qF8Ctfkt3OdrqxCP1LjlUIfH737r77VUspwkQYb+ilOBnnzJ/oiX9hu8s2+D/7jVTjEr7jHJB3k9b22Om4guPbCz36etU6Vx3LModx3g+wTuZd8ZkPbtKgGf7F/YzPiUT90bO7pxq0w6Pf2DuwsDgwhcu+wwY6pwEUQc8ysaNDf3kEiR9NXA1YS24wxCXXMcOtMK9apymH2PUuxhX09RvCwEptfmAZoRIy2SerYC6dJoc+Ve3nga9ZxUkJOpVl3IDbYbYDwr481VG29XIf1UIou5RtDEWFMcuGKbZYlaQ6Fj0qNjpgEXaJ63iEt7dWR6Xmxwvrhia0VekQ8wolk6tjRJzxWfeTtbQXV5IiL6uarG1tagFr1MQNvAjw/DmpHQ==",
        },
        "region": "us-east-1",
      },

    Number of calls: 1

      41 |   describe('Constructor', () => {
      42 |     it('should initialize with AWS Bedrock client', () => {
    > 43 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith({
         |                                    ^
      44 |         region: 'us-east-1',
      45 |         credentials: {
      46 |           accessKeyId: 'test-key',

      at Object.toHaveBeenCalledWith (src/__tests__/unit/analysis.test.ts:43:36)

FAIL src/__tests__/e2e/workflowValidation.test.ts
  ‚óè Console

    console.log
      [DEBUG] Parsing comprehensive input: 
              test-workflow@example.com
              Weekly
              TestCorp Competitive Analysis
              https://testcorp.com
              Product: TestCorp Platform
              Industry: SaaS
              Positioning: Ente...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: test-workflow@example.com
       Weekly
       TestCorp Competitive Analysis
       https://testcorp.com
       Product: TestCorp Platform
       Industry: SaaS
       Positioning: Enterprise automation platform
       Customer Data: Fortune ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              invalid-email
              Unknown
              No Product
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: invalid-email
       Unknown
       No Product...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should extract valid project data from chat message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      35 |       const extractionResult = projectExtractor.extractProjectData(chatMessage);
      36 |       
    > 37 |       expect(extractionResult.success).toBe(true);
         |                                        ^
      38 |       expect(extractionResult.data).toBeDefined();
      39 |       expect(extractionResult.data!.userEmail).toBe('test-workflow@example.com');
      40 |       expect(extractionResult.data!.projectName).toBe('TestCorp Competitive Analysis');

      at Object.toBe (src/__tests__/e2e/workflowValidation.test.ts:37:40)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should generate comprehensive UX-enhanced report

    expect(received).toBe(expected) // Object.is equality

    Expected: "TestCorp Platform"
    Received: "Mock Product"

      319 |
      320 |       // Verify report metadata
    > 321 |       expect(reportResult.report.metadata.productName).toBe('TestCorp Platform');
          |                                                        ^
      322 |       expect(reportResult.report.metadata.competitorCount).toBe(2);
      323 |       const uxConfidenceEntry = reportResult.report.keyFindings.find(finding => 
      324 |         finding.includes('UX Analysis Confidence:')

      at Object.toBe (src/__tests__/e2e/workflowValidation.test.ts:321:56)

FAIL src/services/reports/__tests__/partialDataReportGenerator.test.ts
  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should clearly indicate data gaps and freshness in report

    expect(received).toContain(expected) // indexOf

    Expected substring: "Overall Completeness Score: 45%"
    Received string:    "# Data Completeness & Limitations¬∑
    ## Report Data Quality
    **Overall Completeness Score:** 45%¬∑¬∑
    **Data Freshness:** existing¬∑¬∑
    **Quality Tier:** enhanced¬∑
    ## Available Data Sources
    - **Product Information:** ‚úÖ Complete
    - **Competitor Data:** ‚úÖ Available
    - **Fresh Snapshots:** 0/3 captured
    - **Total Competitors:** 3¬∑
    ## Moderate Data Gaps (Medium Impact)
    - **Data Freshness:** Using existing snapshots instead of fresh captures¬∑
    ## Improving Report Quality¬∑
    To enhance the accuracy and completeness of future reports:¬∑
    - Schedule fresh competitor snapshot capture¬∑
    ## Data Collection Status
    This report was generated with the best available data at the time of creation. For the most current competitive intelligence, consider scheduling regular competitor data collection and snapshot updates.
    "

      280 |       const dataGapSection = report.sections.find(s => s.type === 'data_gaps');
      281 |       expect(dataGapSection).toBeDefined();
    > 282 |       expect(dataGapSection!.content).toContain('Overall Completeness Score: 45%');
          |                                       ^
      283 |       expect(dataGapSection!.content).toContain('Data Freshness: existing');
      284 |       expect(dataGapSection!.content).toContain('Fresh Snapshots: 0/3 captured');
      285 |       expect(dataGapSection!.content).toContain('Moderate Data Gaps (Medium Impact)');

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:282:39)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should provide actionable recommendations despite partial data

    expect(received).toContain(expected) // indexOf

    Expected value: "Capture fresh competitor website snapshots for current market intelligence"
    Received array: ["Improve feature X", "Enhance UX"]

      326 |
      327 |       expect(report.strategicRecommendations.immediate).toContain('Improve feature X');
    > 328 |       expect(report.strategicRecommendations.immediate).toContain('Capture fresh competitor website snapshots for current market intelligence');
          |                                                         ^
      329 |       expect(report.strategicRecommendations.shortTerm).toContain('Establish ongoing competitive intelligence process');
      330 |       expect(report.strategicRecommendations.longTerm).toContain('Build comprehensive competitive intelligence capability');
      331 |     });

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:328:57)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should handle mixed fresh and stale data scenarios

    expect(received).toContain(expected) // indexOf

    Expected substring: "Fresh Snapshots: 2/4 captured"
    Received string:    "# Data Completeness & Limitations¬∑
    ## Report Data Quality
    **Overall Completeness Score:** 65%¬∑¬∑
    **Data Freshness:** mixed¬∑¬∑
    **Quality Tier:** enhanced¬∑
    ## Available Data Sources
    - **Product Information:** ‚úÖ Complete
    - **Competitor Data:** ‚úÖ Available
    - **Fresh Snapshots:** 2/4 captured
    - **Total Competitors:** 4¬∑
    ## Moderate Data Gaps (Medium Impact)
    - **Mixed Data Freshness:** 2 competitors have fresh data, 2 have existing data¬∑
    ## Improving Report Quality¬∑
    To enhance the accuracy and completeness of future reports:¬∑
    - Capture fresh snapshots for all competitors¬∑
    ## Data Collection Status
    This report was generated with the best available data at the time of creation. For the most current competitive intelligence, consider scheduling regular competitor data collection and snapshot updates.
    "

      414 |       
      415 |       const dataGapSection = report.sections.find(s => s.type === 'data_gaps');
    > 416 |       expect(dataGapSection!.content).toContain('Fresh Snapshots: 2/4 captured');
          |                                       ^
      417 |       expect(dataGapSection!.content).toContain('Mixed Data Freshness');
      418 |     });
      419 |

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:416:39)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should create placeholder sections when section generation fails

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      539 |         section.content.includes('Data Completeness: 25%')
      540 |       );
    > 541 |       expect(hasPlaceholderContent).toBe(true);
          |                                     ^
      542 |     });
      543 |   });
      544 |

      at Object.toBe (src/services/reports/__tests__/partialDataReportGenerator.test.ts:541:37)

FAIL src/__tests__/unit/intelligentCachingErrorScenarios.test.ts
  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle Redis connection failures gracefully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      68 |     
      69 |     // Should log warning but not crash
    > 70 |     expect(logger.warn).toHaveBeenCalled();
         |                         ^
      71 |     
      72 |     // Try to retrieve data (should fallback to database)
      73 |     (prisma.competitor.findUnique as jest.Mock).mockResolvedValue({

      at Object.toHaveBeenCalled (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:70:25)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle database failures with graceful degradation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      100 |     // Should return null instead of crashing
      101 |     expect(result).toBeNull();
    > 102 |     expect(logger.error).toHaveBeenCalled();
          |                          ^
      103 |   });
      104 |   
      105 |   it('should handle corrupted cache data gracefully', async () => {

      at Object.toHaveBeenCalled (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:102:26)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle corrupted cache data gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "comp-1"
    Received: undefined

      133 |     // Assert - Should get data from database fallback
      134 |     expect(result).toBeDefined();
    > 135 |     expect(result?.id).toBe('comp-1');
          |                        ^
      136 |     expect(logger.warn).toHaveBeenCalledWith(
      137 |       expect.stringContaining('corrupted'),
      138 |       expect.any(Error),

      at Object.toBe (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:135:24)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle consecutive cache failures with circuit breaker

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "circuit breaker", Any<Object>

    Number of calls: 0

      172 |     
      173 |     // Assert - Should skip caching due to circuit breaker
    > 174 |     expect(logger.info).toHaveBeenCalledWith(
          |                         ^
      175 |       expect.stringContaining('circuit breaker'),
      176 |       expect.any(Object)
      177 |     );

      at Object.toHaveBeenCalledWith (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:174:25)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle cache eviction errors gracefully

    TypeError: intelligentCachingService.invalidateCompetitorCache is not a function

      192 |     
      193 |     // Act - Try to clear cache for specific competitor
    > 194 |     await intelligentCachingService.invalidateCompetitorCache('comp-1');
          |                                     ^
      195 |     
      196 |     // Assert - Should log error but not crash
      197 |     expect(logger.error).toHaveBeenCalled();

      at Object.invalidateCompetitorCache (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:194:37)

FAIL src/__tests__/unit/services/bedrock/bedrockService.test.ts
  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with default configuration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": Any<String>}
    Received: called with 0 arguments

    Number of calls: 1

      78 |       const service = new BedrockService();
      79 |
    > 80 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
         |                                    ^
      81 |         expect.objectContaining({
      82 |           region: expect.any(String)
      83 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:80:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with custom configuration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-west-2"}
    Received: called with 0 arguments

    Number of calls: 1

      94 |       const service = new BedrockService(customConfig);
      95 |
    > 96 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
         |                                    ^
      97 |         expect.objectContaining({
      98 |           region: 'us-west-2'
      99 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:96:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with credentials when provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-east-1"}
    Received: called with 0 arguments

    Number of calls: 1

      113 |       const service = new BedrockService(configWithCredentials);
      114 |
    > 115 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      116 |         expect.objectContaining({
      117 |           region: 'us-east-1'
      118 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:115:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service without credentials when not provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-east-1"}
    Received: called with 0 arguments

    Number of calls: 1

      127 |       const service = new BedrockService(configWithoutCredentials);
      128 |
    > 129 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      130 |         expect.objectContaining({
      131 |           region: 'us-east-1'
      132 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:129:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service for Mistral provider

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": Any<String>}
    Received: called with 0 arguments

    Number of calls: 1

      137 |       const service = new BedrockService({}, 'mistral');
      138 |
    > 139 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      140 |         expect.objectContaining({
      141 |           region: expect.any(String)
      142 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:139:36)

FAIL src/__tests__/integration/completeUserJourneys.test.ts
  ‚óè Complete User Journey Tests ‚Ä∫ Journey 1: Project Creation to Initial Report ‚Ä∫ should complete the full user journey from project creation to initial report generation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      211 |
      212 |       // Full journey complete - all key steps verified
    > 213 |       expect(logger.info).toHaveBeenCalled();
          |                           ^
      214 |     });
      215 |   });
      216 |   

      at Object.toHaveBeenCalled (src/__tests__/integration/completeUserJourneys.test.ts:213:27)

  ‚óè Complete User Journey Tests ‚Ä∫ Journey 2: Error Recovery During Report Generation ‚Ä∫ should handle errors and recover gracefully during report generation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      324 |       
      325 |       // Journey complete with error recovery
    > 326 |       expect(logger.warn).toHaveBeenCalled();
          |                           ^
      327 |       expect(reportResult.reportId).toBe('report-456');
      328 |     });
      329 |   });

      at Object.toHaveBeenCalled (src/__tests__/integration/completeUserJourneys.test.ts:326:27)

FAIL src/__tests__/e2e/productVsCompetitorWorkflow.test.ts
  ‚óè Console

    console.log
      [DEBUG] Parsing comprehensive input: 
              test-workflow@example.com
              Weekly
              TestCorp Competitive Analysis
              https://testcorp.com
              Product: TestCorp Platform
              Industry: SaaS
              Positioning: Ente...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: test-workflow@example.com
       Weekly
       TestCorp Competitive Analysis
       https://testcorp.com
       Product: TestCorp Platform
       Industry: SaaS
       Positioning: Enterprise automation platform
       Customer Data: Fortune ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

    console.log
      [DEBUG] Parsing comprehensive input: 
              invalid-email
              Unknown
              No Product
            ...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:425:13)

    console.log
      [DEBUG] Preprocessed message: invalid-email
       Unknown
       No Product...

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:429:13)

    console.log
      [DEBUG] Parsing strategy: mixed_format

      at ComprehensiveRequirementsCollector.log [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:438:13)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should extract valid project data from chat message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      35 |       const extractionResult = projectExtractor.extractProjectData(chatMessage);
      36 |       
    > 37 |       expect(extractionResult.success).toBe(true);
         |                                        ^
      38 |       expect(extractionResult.data).toBeDefined();
      39 |       expect(extractionResult.data!.userEmail).toBe('test-workflow@example.com');
      40 |       expect(extractionResult.data!.projectName).toBe('TestCorp Competitive Analysis');

      at Object.toBe (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:37:40)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should generate comprehensive UX-enhanced report

    expect(received).toBe(expected) // Object.is equality

    Expected: "TestCorp Platform"
    Received: "Mock Product"

      302 |
      303 |       // Verify report metadata
    > 304 |       expect(reportResult.report.metadata.productName).toBe('TestCorp Platform');
          |                                                        ^
      305 |       expect(reportResult.report.metadata.competitorCount).toBe(2);
      306 |       expect(reportResult.report.keyFindings).toContain('UX Analysis Confidence:');
      307 |

      at Object.toBe (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:304:56)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should handle error scenarios gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Invalid input"
    Received string:    "fail is not defined"

      350 |       } catch (error) {
      351 |         expect(error).toBeInstanceOf(Error);
    > 352 |         expect(error.message).toContain('Invalid input');
          |                               ^
      353 |       }
      354 |
      355 |       logger.info('Error scenario validation complete');

      at Object.toContain (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:352:31)

FAIL src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts
  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should generate UX-enhanced report successfully

    expect(received).toHaveLength(expected)

    Expected length: 3
    Received length: 6
    Received array:  [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "In-depth UX comparison and recommendations", "id": "ux-analysis", "order": 3, "title": "User Experience Analysis", "type": "ux_analysis"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 4, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "Actionable UX recommendations based on competitive analysis", "id": "strategic-ux-recommendations", "order": 5, "title": "Strategic UX Recommendations", "type": "recommendations"}, {"content": "Supporting data and methodology", "id": "appendix", "order": 6, "title": "Data Appendix", "type": "appendix"}]

      352 |
      353 |       expect(result).toBeDefined();
    > 354 |       expect(result.report.sections).toHaveLength(3); // Original + 2 UX sections
          |                                      ^
      355 |       expect(result.report.sections[1].title).toBe('User Experience Analysis');
      356 |       expect(result.report.sections[2].title).toBe('Strategic UX Recommendations');
      357 |       expect(result.report.keyFindings).toContain('UX Analysis Confidence: 85%');

      at Object.toHaveLength (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:354:38)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should handle UX analysis with low confidence

    expect(received).toContain(expected) // indexOf

    Expected value: "UX analysis confidence is below 70%"
    Received array: []

      432 |       );
      433 |
    > 434 |       expect(result.warnings).toContain('UX analysis confidence is below 70%');
          |                               ^
      435 |       expect(result.report.keyFindings).toContain('UX Analysis Confidence: 60%');
      436 |     });
      437 |

      at Object.toContain (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:434:31)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should handle UX analysis errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cost": 0.012, "errors": [], "generationTime": 1200, "report": {"description": "Mock UX report description", "executiveSummary": "Mock UX summary", "id": "mock-ux-report-id", "keyFindings": ["UX finding 1", "UX Analysis Confidence: 85%"], "keyOpportunities": ["UX opportunity 1"], "keyThreats": ["UX threat 1"], "metadata": {"competitorCount": 2, "generatedAt": "2025-07-10T11:37:52.578Z", "productName": "Mock Product", "template": "UX_ENHANCED", "uxAnalysisIncluded": true, "version": "1.0"}, "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "In-depth UX comparison and recommendations", "id": "ux-analysis", "order": 3, "title": "User Experience Analysis", "type": "ux_analysis"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 4, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "Actionable UX recommendations based on competitive analysis", "id": "strategic-ux-recommendations", "order": 5, "title": "Strategic UX Recommendations", "type": "recommendations"}, {"content": "Supporting data and methodology", "id": "appendix", "order": 6, "title": "Data Appendix", "type": "appendix"}], "title": "Mock UX Enhanced Report"}, "tokensUsed": 600, "warnings": []}

      441 |       );
      442 |
    > 443 |       await expect(
          |             ^
      444 |         service.generateUXEnhancedReport(
      445 |           mockAnalysis,
      446 |           mockProduct,

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.expect (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:443:13)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should limit competitors to maximum of 5

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, Anything, ObjectContaining {"maxCompetitors": 5}

    Number of calls: 0

      503 |
      504 |       // Verify that maxCompetitors option was set to 5
    > 505 |       expect(mockUXAnalyzer.analyzeProductVsCompetitors).toHaveBeenCalledWith(
          |                                                          ^
      506 |         expect.anything(),
      507 |         expect.anything(),
      508 |         expect.objectContaining({

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:505:58)

FAIL src/services/analysis/__tests__/userExperienceAnalyzer.test.ts
  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should generate UX analysis successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Test product shows strong UX fundamentals with room for improvement"
    Received: "Mock UX analysis summary"

      87 |
      88 |       expect(result).toBeDefined();
    > 89 |       expect(result.summary).toBe('Test product shows strong UX fundamentals with room for improvement');
         |                              ^
      90 |       expect(result.strengths).toEqual(['Clean design', 'Fast loading']);
      91 |       expect(result.weaknesses).toEqual(['Limited mobile optimization', 'Unclear navigation']);
      92 |       expect(result.opportunities).toEqual(['Mobile-first redesign', 'Enhanced accessibility']);

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:89:30)

  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should handle analysis options correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 2

      113 |
      114 |       expect(result).toBeDefined();
    > 115 |       expect(result.metadata.competitorCount).toBe(1);
          |                                               ^
      116 |     });
      117 |
      118 |     it('should limit competitors based on maxCompetitors option', async () => {

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:115:47)

  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should handle malformed AI responses gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Analysis completed but response format was invalid"
    Received: "Mock UX analysis summary"

      161 |
      162 |       expect(result).toBeDefined();
    > 163 |       expect(result.summary).toBe('Analysis completed but response format was invalid');
          |                              ^
      164 |       expect(result.confidence).toBe(0.3);
      165 |       expect(result.recommendations).toEqual(['Review analysis input data and retry']);
      166 |     });

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:163:30)

PASS src/__tests__/unit/services/productScrapingService.test.ts (7.679 s)
PASS src/__tests__/unit/services/productScrapingService.simple.test.ts (6.608 s)
PASS src/__tests__/integration/testStabilityDemo.test.ts
(node:22489) [DEP0147] DeprecationWarning: In future versions of Node.js, fs.rmdir(path, { recursive: true }) will be removed. Use fs.rm(path, { recursive: true }) instead
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/__tests__/integration/comparativeReportIntegration.test.ts
  ‚óè Console

    console.log
      üöÄ Starting end-to-end comparative report generation test with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:216:15)

    console.log
      üìä Step 1: Generating comparative analysis...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:219:15)

    console.log
      ‚úÖ Analysis completed with 87% confidence

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:228:15)

    console.log
      üìù Step 2: Generating comprehensive report...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:231:15)

    console.log
      ‚úÖ Comprehensive report generated in 1200ms

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:251:15)

    console.log
      üìä Report metrics: 2800 tokens, $0.0320 cost

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:252:15)

    console.log
      üíæ Step 3: Storing report in repository...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:255:15)

    console.log
      ‚úÖ Report stored with ID: report-1752147489004

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:261:15)

    console.log
      üîç Step 4: Retrieving stored report...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:264:15)

    console.log
      ‚úÖ Report retrieved successfully

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:271:15)

    console.log
      üìÑ Step 5: Verifying report content file...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:274:15)

    console.log
      ‚úÖ Report content file verified (808 characters)

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:283:15)

    console.log
      üéâ End-to-end comparative report generation test completed successfully with Fix 7.1c!

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:294:15)

    console.log
      üöÄ Testing executive summary report generation with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:298:15)

    console.log
      ‚úÖ Executive summary report test completed with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:326:15)

    console.log
      üöÄ Testing technical analysis report generation with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:330:15)

    console.log
      ‚úÖ Technical analysis report test completed with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:354:15)

    console.log
      üöÄ Testing repository operations with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:358:15)

    console.log
      ‚úÖ Repository operations test completed with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:408:15)

    console.log
      ‚úÖ All report sections validated successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:433:15)

    console.log
      ‚úÖ Invalid analysis error handling verified with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:447:15)

    console.log
      ‚úÖ Repository error handling verified with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeReportIntegration.test.ts:456:15)

PASS src/services/__tests__/competitorSnapshotOptimizer.test.ts
PASS src/__tests__/components/ReportsPage.test.tsx
PASS src/__tests__/integration/comparativeAnalysisIntegration.test.ts
  ‚óè Console

    console.log
      üöÄ Starting comprehensive analysis test with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:17:15)

    console.log
      ‚úÖ Comprehensive analysis completed successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:163:15)

    console.log
      üìä Analysis ID: workflow-analysis-id

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:164:15)

    console.log
      üîó Correlation ID: analysis-1752147492255

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:165:15)

    console.log
      ‚ö° Processing time: 1500ms

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:166:15)

    console.log
      üéØ Confidence score: 87%

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:167:15)

    console.log
      üöÄ Testing focused analysis with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:171:15)

    console.log
      ‚úÖ Focused analysis completed successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:242:15)

    console.log
      üìä Focused Analysis ID: workflow-analysis-id

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:243:15)

    console.log
      üîó Correlation ID: analysis-1752147492360

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:244:15)

    console.log
      üöÄ Testing input validation and error handling with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:248:15)

    console.log
      ‚úÖ Input validation and error handling verified with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:278:15)

    console.log
      üöÄ Testing analysis configuration variations with Fix 7.1c...

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:282:15)

    console.log
      ‚úÖ Analysis configuration variations tested successfully with Fix 7.1c

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:363:15)

    console.log
      üìä Basic Analysis ID: workflow-analysis-id

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:364:15)

    console.log
      üìä Comprehensive Analysis ID: workflow-analysis-id

      at Object.log (src/__tests__/integration/comparativeAnalysisIntegration.test.ts:365:15)

PASS src/__tests__/components/Navigation.test.tsx
PASS src/__tests__/performance/concurrentProjectCreation.test.ts
PASS src/__tests__/components/ReportViewerPage.test.tsx
  ‚óè Console

    console.error
      [Error: Not implemented: navigation (except hash changes)] {
        type: 'not implemented'
      }

      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:78:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at Timeout._onTimeout (node_modules/jsdom/lib/jsdom/living/nodes/HTMLHyperlinkElementUtils-impl.js:80:7)

PASS src/__tests__/components/ReportViewer.test.tsx
PASS src/__tests__/integration/productScrapingIntegration.test.ts
  ‚óè Console

    console.log
      üöÄ Testing network timeout handling with Fix 7.1c...

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:196:15)

    console.log
      ‚úÖ Network timeout handling verified with Fix 7.1c

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:209:15)

    console.log
      üöÄ Testing input validation with Fix 7.1c...

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:213:15)

    console.log
      ‚úÖ Input validation verified with Fix 7.1c

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:230:15)

    console.log
      üöÄ Testing network timeout handling with Phase 4.1 stability fix...

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:292:15)

    console.log
      ‚úÖ Network timeout handling verified with Phase 4.1 stability fix

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:316:15)

    console.log
      üöÄ Testing input validation with Phase 4.1 stability fix...

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:320:15)

    console.log
      ‚úÖ Input validation verified with Phase 4.1 stability fix

      at Object.log (src/__tests__/integration/productScrapingIntegration.test.ts:337:15)

PASS src/__tests__/regression/critical-paths.test.ts
PASS src/__tests__/components/BasicComponent.test.tsx
PASS src/__tests__/unit/services/comparativeReportService.simple.test.ts
PASS src/__tests__/unit/scraper.test.ts
PASS src/__tests__/unit/services/comparativeAnalysisService.test.ts
  ‚óè Console

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 5969,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 387,
        resultPreview: '{"summary":{"overallPosition":"competitive","keyStrengths":["Strong positioning","Clear messaging"],...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 5969,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 288,
        resultPreview: '\n' +
          '        Based on the analysis, Test Product shows competitive positioning.\n' +
          '        Strengths: Stron...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: '',
        productName: '',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.error
      ComparativeAnalysisService: Product information is incomplete

      196 |
      197 |     if (!input.product?.id || !input.product?.name) {
    > 198 |       console.error('ComparativeAnalysisService: Product information is incomplete');
          |               ^
      199 |       throw new InsufficientDataError('Product information is incomplete', {
      200 |         missing: ['product.id', 'product.name']
      201 |       });

      at ComparativeAnalysisService.error [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:198:15)
      at ComparativeAnalysisService.validateAnalysisInput [as analyzeProductVsCompetitors] (src/services/analysis/comparativeAnalysisService.ts:87:12)
      at Object.analyzeProductVsCompetitors (src/__tests__/unit/services/comparativeAnalysisService.test.ts:167:28)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: false,
        productSnapshotContent: false,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.error
      ComparativeAnalysisService: Product snapshot content is missing

      203 |
      204 |     if (!input.productSnapshot?.content) {
    > 205 |       console.error('ComparativeAnalysisService: Product snapshot content is missing');
          |               ^
      206 |       throw new InsufficientDataError('Product snapshot content is missing');
      207 |     }
      208 |

      at ComparativeAnalysisService.error [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:205:15)
      at ComparativeAnalysisService.validateAnalysisInput [as analyzeProductVsCompetitors] (src/services/analysis/comparativeAnalysisService.ts:87:12)
      at Object.analyzeProductVsCompetitors (src/__tests__/unit/services/comparativeAnalysisService.test.ts:178:28)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 0,
        competitors: []
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.error
      ComparativeAnalysisService: No competitors provided

      208 |
      209 |     if (!input.competitors || input.competitors.length === 0) {
    > 210 |       console.error('ComparativeAnalysisService: No competitors provided');
          |               ^
      211 |       throw new InsufficientDataError('At least one competitor is required for analysis');
      212 |     }
      213 |

      at ComparativeAnalysisService.error [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:210:15)
      at ComparativeAnalysisService.validateAnalysisInput [as analyzeProductVsCompetitors] (src/services/analysis/comparativeAnalysisService.ts:87:12)
      at Object.analyzeProductVsCompetitors (src/__tests__/unit/services/comparativeAnalysisService.test.ts:189:28)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: '', name: '', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.error
      ComparativeAnalysisService: No valid competitors found

      218 |
      219 |     if (validCompetitors.length === 0) {
    > 220 |       console.error('ComparativeAnalysisService: No valid competitors found');
          |               ^
      221 |       throw new InsufficientDataError('No valid competitor data found');
      222 |     }
      223 |

      at ComparativeAnalysisService.error [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:220:15)
      at ComparativeAnalysisService.validateAnalysisInput [as analyzeProductVsCompetitors] (src/services/analysis/comparativeAnalysisService.ts:87:12)
      at Object.analyzeProductVsCompetitors (src/__tests__/unit/services/comparativeAnalysisService.test.ts:209:28)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 9

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.error
      ComparativeAnalysisService: Product content is too short

      227 |     
      228 |     if (productContentLength < 10) { // Reduced from 100 to 10
    > 229 |       console.error('ComparativeAnalysisService: Product content is too short');
          |               ^
      230 |       throw new InsufficientDataError('Product content is too short for meaningful analysis');
      231 |     }
      232 |

      at ComparativeAnalysisService.error [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:229:15)
      at ComparativeAnalysisService.validateAnalysisInput [as analyzeProductVsCompetitors] (src/services/analysis/comparativeAnalysisService.ts:87:12)
      at Object.analyzeProductVsCompetitors (src/__tests__/unit/services/comparativeAnalysisService.test.ts:227:28)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 5969,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.error
      ComparativeAnalysisService: AI service execution failed {
        error: Error: Bedrock error
            at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:233:64)
            at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
            at new Promise (<anonymous>)
            at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
            at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
            at processTicksAndRejections (node:internal/process/task_queues:105:5)
            at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
            at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
            at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
            at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
            at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
            at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
            at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12),
        errorMessage: 'Bedrock error',
        errorStack: 'Error: Bedrock error\n' +
          '    at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:233:64)\n' +
          '    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)\n' +
          '    at new Promise (<anonymous>)\n' +
          '    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)\n' +
          '    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)\n' +
          '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
          '    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)\n' +
          '    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)\n' +
          '    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
          '    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
          '    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)\n' +
          '    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)\n' +
          '    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)'
      }

      314 |       return result;
      315 |     } catch (error) {
    > 316 |       console.error('ComparativeAnalysisService: AI service execution failed', {
          |               ^
      317 |         error: error,
      318 |         errorMessage: (error as Error).message,
      319 |         errorStack: (error as Error).stack

      at ComparativeAnalysisService.error [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:316:15)
      at ComparativeAnalysisService.analyzeProductVsCompetitors (src/services/analysis/comparativeAnalysisService.ts:103:33)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeAnalysisService.test.ts:235:7)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 5969,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful { resultLength: 5, resultPreview: 'short...' }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.error
      ComparativeAnalysisService: Insufficient response from AI service { resultLength: 5, result: 'short' }

      302 |       
      303 |       if (!result || result.length < 50) {
    > 304 |         console.error('ComparativeAnalysisService: Insufficient response from AI service', {
          |                 ^
      305 |           resultLength: result?.length || 0,
      306 |           result: result
      307 |         });

      at ComparativeAnalysisService.error [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:304:17)
      at ComparativeAnalysisService.analyzeProductVsCompetitors (src/services/analysis/comparativeAnalysisService.ts:103:33)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeAnalysisService.test.ts:243:7)

    console.error
      ComparativeAnalysisService: AI service execution failed {
        error: AIServiceError: AI service returned insufficient response
            at ComparativeAnalysisService.executeAnalysis (/Users/nikita.gorshkov/competitor-research-agent/src/services/analysis/comparativeAnalysisService.ts:308:15)
            at processTicksAndRejections (node:internal/process/task_queues:105:5)
            at ComparativeAnalysisService.analyzeProductVsCompetitors (/Users/nikita.gorshkov/competitor-research-agent/src/services/analysis/comparativeAnalysisService.ts:103:33)
            at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:243:7) {
          code: 'AI_SERVICE_ERROR',
          details: { resultLength: 5, minLength: 50 }
        },
        errorMessage: 'AI service returned insufficient response',
        errorStack: 'AIServiceError: AI service returned insufficient response\n' +
          '    at ComparativeAnalysisService.executeAnalysis (/Users/nikita.gorshkov/competitor-research-agent/src/services/analysis/comparativeAnalysisService.ts:308:15)\n' +
          '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
          '    at ComparativeAnalysisService.analyzeProductVsCompetitors (/Users/nikita.gorshkov/competitor-research-agent/src/services/analysis/comparativeAnalysisService.ts:103:33)\n' +
          '    at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:243:7)'
      }

      314 |       return result;
      315 |     } catch (error) {
    > 316 |       console.error('ComparativeAnalysisService: AI service execution failed', {
          |               ^
      317 |         error: error,
      318 |         errorMessage: (error as Error).message,
      319 |         errorStack: (error as Error).stack

      at ComparativeAnalysisService.error [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:316:15)
      at ComparativeAnalysisService.analyzeProductVsCompetitors (src/services/analysis/comparativeAnalysisService.ts:103:33)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeAnalysisService.test.ts:243:7)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 2,
        competitors: [
          { id: 'comp-1', name: 'Competitor A', hasSnapshot: true },
          { id: 'comp-2', name: 'Competitor B', hasSnapshot: true }
        ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 2 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 6165,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 165,
        resultPreview: '{"summary":{"overallPosition":"competitive","keyStrengths":["Strong positioning"],"keyWeaknesses":["...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 2179

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 2179, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 5969,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 165,
        resultPreview: '{"summary":{"overallPosition":"competitive","keyStrengths":["Strong positioning"],"keyWeaknesses":["...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 598,
        promptPreview: 'Generate a comprehensive business report based on the following comparative analysis data:\n' +
          '\n' +
          '**Analysis Summary:**\n' +
          '- Overall Position: competitive\n' +
          '- Opportunity Score: 75/100\n' +
          '- Threat Level: medium\n' +
          '\n' +
          '**...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 417,
        resultPreview: '\n' +
          '        # Competitive Analysis Report\n' +
          '        \n' +
          '        ## Executive Summary\n' +
          '        The product sho...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 598,
        promptPreview: 'Generate a comprehensive business report based on the following comparative analysis data:\n' +
          '\n' +
          '**Analysis Summary:**\n' +
          '- Overall Position: competitive\n' +
          '- Opportunity Score: 75/100\n' +
          '- Threat Level: medium\n' +
          '\n' +
          '**...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.error
      ComparativeAnalysisService: AI service execution failed {
        error: Error: Generation failed
            at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:405:64)
            at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
            at new Promise (<anonymous>)
            at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
            at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
            at processTicksAndRejections (node:internal/process/task_queues:105:5)
            at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
            at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
            at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
            at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
            at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
            at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
            at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
            at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12),
        errorMessage: 'Generation failed',
        errorStack: 'Error: Generation failed\n' +
          '    at Object.<anonymous> (/Users/nikita.gorshkov/competitor-research-agent/src/__tests__/unit/services/comparativeAnalysisService.test.ts:405:64)\n' +
          '    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)\n' +
          '    at new Promise (<anonymous>)\n' +
          '    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)\n' +
          '    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)\n' +
          '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
          '    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)\n' +
          '    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)\n' +
          '    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)\n' +
          '    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
          '    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
          '    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)\n' +
          '    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)\n' +
          '    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)'
      }

      314 |       return result;
      315 |     } catch (error) {
    > 316 |       console.error('ComparativeAnalysisService: AI service execution failed', {
          |               ^
      317 |         error: error,
      318 |         errorMessage: (error as Error).message,
      319 |         errorStack: (error as Error).stack

      at ComparativeAnalysisService.error [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:316:15)
      at ComparativeAnalysisService.generateAnalysisReport (src/services/analysis/comparativeAnalysisService.ts:157:29)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeAnalysisService.test.ts:407:7)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 3000

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 3000, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 7051,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 127,
        resultPreview: '{"summary":{"overallPosition":"competitive","keyStrengths":[],"keyWeaknesses":[],"opportunityScore":...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

    console.log
      ComparativeAnalysisService: Validating analysis input {
        hasProduct: true,
        productId: 'product-1',
        productName: 'Test Product',
        hasProductSnapshot: true,
        productSnapshotContent: true,
        competitorCount: 1,
        competitors: [ { id: 'comp-1', name: 'Competitor A', hasSnapshot: true } ]
      }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:183:13)

    console.log
      ComparativeAnalysisService: Product content length: 200

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:226:13)

    console.log
      ComparativeAnalysisService: Validation passed { productContentLength: 200, validCompetitorCount: 1 }

      at ComparativeAnalysisService.log [as validateAnalysisInput] (src/services/analysis/comparativeAnalysisService.ts:233:13)

    console.log
      ComparativeAnalysisService: Starting analysis execution {
        promptLength: 2330,
        promptPreview: '\n' +
          '**COMPREHENSIVE COMPARATIVE ANALYSIS**\n' +
          '\n' +
          'Provide a complete competitive analysis comparing the PRODUCT against all COMPETITORS.\n' +
          '\n' +
          '**PRODUCT:**\n' +
          '- Name: Test Product\n' +
          '- Website: https://testproduct.com\n' +
          '- ...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:282:15)

    console.log
      ComparativeAnalysisService: Calling Bedrock service...

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:294:15)

    console.log
      ComparativeAnalysisService: Bedrock call successful {
        resultLength: 127,
        resultPreview: '{"summary":{"overallPosition":"competitive","keyStrengths":[],"keyWeaknesses":[],"opportunityScore":...'
      }

      at ComparativeAnalysisService.log [as executeAnalysis] (src/services/analysis/comparativeAnalysisService.ts:298:15)

PASS src/__tests__/unit/observability.test.ts
PASS src/app/api/projects/[id]/initial-report-status/__tests__/route.test.ts
PASS src/__tests__/unit/ReportGenerator.test.ts
PASS src/__tests__/unit/services/analysis/userExperienceAnalyzer.test.ts
PASS src/__tests__/unit/repositories/productRepository.basic.test.ts
PASS src/__tests__/regression/data-integrity.test.ts
PASS src/__tests__/unit/chat/productChatProcessor.test.ts
PASS src/__tests__/integration/comparativeReportSchedulerIntegration.test.ts
PASS src/__tests__/unit/services/comparativeReportScheduler.test.ts
PASS src/services/__tests__/typeValidationService.test.ts
PASS src/__tests__/unit/services/comparativeReportSchedulerSimple.test.ts
PASS src/__tests__/unit/services/aws/credentialProvider.test.ts
PASS src/__tests__/unit/services/bedrock/bedrockConfig.test.ts
PASS src/__tests__/unit/repositories/productSnapshotRepository.test.ts
PASS src/__tests__/unit/diff.test.ts
PASS src/__tests__/integration/productVsCompetitorIntegration.test.ts
PASS src/__tests__/unit/services/productService.test.ts
PASS src/services/__tests__/intelligentCachingService.test.ts
PASS src/__tests__/e2e/productVsCompetitorE2E.test.ts
PASS src/__tests__/unit/types.test.ts
PASS src/__tests__/unit/services/productScrapingService.comprehensive.test.ts
PASS src/__tests__/unit/logger.test.ts
/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:3625
    _realTimeStatusService.realTimeStatusService.sendProcessingUpdate(projectId, 'validation', 5, 'Starting async report generation...');
                                                 ^

TypeError: _realTimeStatusService.realTimeStatusService.sendProcessingUpdate is not a function
    at AsyncReportProcessingService.sendProcessingUpdate (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:121:27)
    at Object.processInitialReport (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/__tests__/asyncReportProcessingService.test.ts:180:19)
    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

Node.js v22.16.0
/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:3625
    _realTimeStatusService.realTimeStatusService.sendProcessingUpdate(projectId, 'validation', 5, 'Starting async report generation...');
                                                 ^

TypeError: _realTimeStatusService.realTimeStatusService.sendProcessingUpdate is not a function
    at AsyncReportProcessingService.sendProcessingUpdate (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:121:27)
    at Object.processInitialReport (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/__tests__/asyncReportProcessingService.test.ts:180:19)
    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

Node.js v22.16.0
/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:3625
    _realTimeStatusService.realTimeStatusService.sendProcessingUpdate(projectId, 'validation', 5, 'Starting async report generation...');
                                                 ^

TypeError: _realTimeStatusService.realTimeStatusService.sendProcessingUpdate is not a function
    at AsyncReportProcessingService.sendProcessingUpdate (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:121:27)
    at Object.processInitialReport (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/__tests__/asyncReportProcessingService.test.ts:180:19)
    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

Node.js v22.16.0
/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:3625
    _realTimeStatusService.realTimeStatusService.sendProcessingUpdate(projectId, 'validation', 5, 'Starting async report generation...');
                                                 ^

TypeError: _realTimeStatusService.realTimeStatusService.sendProcessingUpdate is not a function
    at AsyncReportProcessingService.sendProcessingUpdate (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/asyncReportProcessingService.ts:121:27)
    at Object.processInitialReport (/Users/nikita.gorshkov/competitor-research-agent/src/services/reports/__tests__/asyncReportProcessingService.test.ts:180:19)
    at Promise.then.completed (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/utils.js:231:10)
    at _callCircusTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:252:3)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:126:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at _runTestsForDescribeBlock (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:121:9)
    at run (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/run.js:71:3)
    at runAndTransformResultsToJestFormat (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
    at jestAdapter (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
    at runTestInternal (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:367:16)
    at runTest (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/runTest.js:444:34)
    at Object.worker (/Users/nikita.gorshkov/competitor-research-agent/node_modules/jest-runner/build/testWorker.js:106:12)

Node.js v22.16.0
FAIL src/services/reports/__tests__/asyncReportProcessingService.test.ts
  ‚óè Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL src/__tests__/integration/reports.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../pages/api/reports' from 'src/__tests__/integration/reports.test.ts'

      49 | jest.mock('next-auth');
      50 |
    > 51 | describe('/api/reports', () => {
         |                                 ^
      52 |   let mockPrisma: any;
      53 |   let mockPrismaDefault: any;
      54 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/integration/reports.test.ts:51:57)

PASS src/__tests__/performance/loadTesting.test.ts (48.694 s)
--------------------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                                    | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                       
--------------------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                                               |   25.98 |    21.99 |   29.47 |   26.12 |                                                                                                                                                                                                                         
 src                                                    |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                         
  middleware.ts                                         |       0 |      100 |       0 |       0 | 1-22                                                                                                                                                                                                                    
 src/app                                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  layout.tsx                                            |       0 |      100 |       0 |       0 | 2-23                                                                                                                                                                                                                    
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-109                                                                                                                                                                                                                   
  providers.tsx                                         |       0 |      100 |       0 |       0 | 6                                                                                                                                                                                                                       
 src/app/api/admin/initial-reports/config               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 6-185                                                                                                                                                                                                                   
 src/app/api/admin/initial-reports/config/rollback      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 6-96                                                                                                                                                                                                                    
 src/app/api/advanced-scheduling                        |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 9-188                                                                                                                                                                                                                   
 src/app/api/analysis                                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-33                                                                                                                                                                                                                    
 src/app/api/auth/[...nextauth]                         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-35                                                                                                                                                                                                                    
 src/app/api/aws/credentials                            |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-116                                                                                                                                                                                                                   
 src/app/api/aws/credentials/status                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-65                                                                                                                                                                                                                    
 src/app/api/aws/credentials/validate                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-113                                                                                                                                                                                                                   
 src/app/api/chat                                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-76                                                                                                                                                                                                                    
 src/app/api/competitors                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-458                                                                                                                                                                                                                   
 src/app/api/competitors/[id]                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-537                                                                                                                                                                                                                   
 src/app/api/competitors/[id]/analyze                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-27                                                                                                                                                                                                                    
 src/app/api/competitors/[id]/snapshot                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-62                                                                                                                                                                                                                    
 src/app/api/debug/comparative-reports                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-323                                                                                                                                                                                                                   
 src/app/api/deployment/advance-phase                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-80                                                                                                                                                                                                                    
 src/app/api/deployment/rollback                        |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-123                                                                                                                                                                                                                   
 src/app/api/deployment/rollout-status                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-86                                                                                                                                                                                                                    
 src/app/api/health                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-216                                                                                                                                                                                                                   
 src/app/api/health/aws                                 |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-80                                                                                                                                                                                                                    
 src/app/api/intelligent-cache/status                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 6-221                                                                                                                                                                                                                   
 src/app/api/monitoring/initial-reports                 |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 11-161                                                                                                                                                                                                                  
 src/app/api/monitoring/initial-reports/metrics         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 8-262                                                                                                                                                                                                                   
 src/app/api/monitoring/memory-usage                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 9-198                                                                                                                                                                                                                   
 src/app/api/performance-dashboard                      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 9-155                                                                                                                                                                                                                   
 src/app/api/performance-monitoring/api-response-times  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 8-299                                                                                                                                                                                                                   
 src/app/api/products                                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-168                                                                                                                                                                                                                   
 src/app/api/projects                                   |   56.41 |       50 |   66.66 |   56.41 |                                                                                                                                                                                                                         
  route.ts                                              |   56.41 |       50 |   66.66 |   56.41 | 15,26-50,66,87-93                                                                                                                                                                                                       
 src/app/api/projects/[id]                              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-451                                                                                                                                                                                                                   
 src/app/api/projects/[id]/analysis                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-244                                                                                                                                                                                                                   
 src/app/api/projects/[id]/automated-analysis           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 8-81                                                                                                                                                                                                                    
 src/app/api/projects/[id]/initial-report-status        |   97.26 |     90.9 |     100 |   97.22 |                                                                                                                                                                                                                         
  route.ts                                              |   97.26 |     90.9 |     100 |   97.22 | 292-294                                                                                                                                                                                                                 
 src/app/api/projects/[id]/initial-report-status/stream |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 2-141                                                                                                                                                                                                                   
 src/app/api/projects/[id]/intelligent-reporting        |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 13-408                                                                                                                                                                                                                  
 src/app/api/projects/[id]/smart-ai-analysis            |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 11-176                                                                                                                                                                                                                  
 src/app/api/projects/[id]/smart-scheduling             |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 10-148                                                                                                                                                                                                                  
 src/app/api/projects/intelligent-recommendations       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 11-236                                                                                                                                                                                                                  
 src/app/api/projects/scraping                          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-114                                                                                                                                                                                                                   
 src/app/api/rate-limiting/status                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 12-389                                                                                                                                                                                                                  
 src/app/api/reports                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-149                                                                                                                                                                                                                   
 src/app/api/reports/[id]                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-205                                                                                                                                                                                                                   
 src/app/api/reports/[id]/quality                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-239                                                                                                                                                                                                                   
 src/app/api/reports/async-processing                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 6-219                                                                                                                                                                                                                   
 src/app/api/reports/auto-generate                      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-302                                                                                                                                                                                                                   
 src/app/api/reports/comparative                        |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-401                                                                                                                                                                                                                   
 src/app/api/reports/database/[id]                      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-114                                                                                                                                                                                                                   
 src/app/api/reports/download                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-52                                                                                                                                                                                                                    
 src/app/api/reports/generate                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-218                                                                                                                                                                                                                   
 src/app/api/reports/generate-for-project               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-330                                                                                                                                                                                                                   
 src/app/api/reports/generation-status/[projectId]      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-293                                                                                                                                                                                                                   
 src/app/api/reports/list                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 8-371                                                                                                                                                                                                                   
 src/app/api/reports/schedule                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-331                                                                                                                                                                                                                   
 src/app/api/reports/schedules                          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-55                                                                                                                                                                                                                    
 src/app/api/reports/schedules/[id]                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-80                                                                                                                                                                                                                    
 src/app/api/reports/schedules/comparative              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-86                                                                                                                                                                                                                    
 src/app/api/reports/schedules/comparative/[id]         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-114                                                                                                                                                                                                                   
 src/app/api/reports/versions                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-49                                                                                                                                                                                                                    
 src/app/api/reports/versions/[id]                      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-47                                                                                                                                                                                                                    
 src/app/api/scheduled-jobs                             |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 8-97                                                                                                                                                                                                                    
 src/app/api/snapshot-optimizer/status                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-87                                                                                                                                                                                                                    
 src/app/api/snapshots/compare                          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-60                                                                                                                                                                                                                    
 src/app/api/system-health                              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 9-196                                                                                                                                                                                                                   
 src/app/api/test-bedrock                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-27                                                                                                                                                                                                                    
 src/app/api/test-claude                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-99                                                                                                                                                                                                                    
 src/app/api/trends                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  route.ts                                              |       0 |        0 |       0 |       0 | 1-30                                                                                                                                                                                                                    
 src/app/auth/error                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  loading.tsx                                           |       0 |      100 |       0 |       0 | 1                                                                                                                                                                                                                       
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-29                                                                                                                                                                                                                    
 src/app/auth/signin                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-63                                                                                                                                                                                                                    
 src/app/chat                                           |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-8                                                                                                                                                                                                                     
 src/app/competitors                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-228                                                                                                                                                                                                                   
 src/app/competitors/[id]                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 1-182                                                                                                                                                                                                                   
 src/app/competitors/add                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-26                                                                                                                                                                                                                    
 src/app/dashboard                                      |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |      100 |       0 |       0 | 3-142                                                                                                                                                                                                                   
 src/app/help/immediate-reports                         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-36                                                                                                                                                                                                                    
 src/app/projects                                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-112                                                                                                                                                                                                                   
 src/app/projects/new                                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 3-120                                                                                                                                                                                                                   
 src/app/providers                                      |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                         
  AuthProvider.tsx                                      |       0 |      100 |       0 |       0 | 3-10                                                                                                                                                                                                                    
 src/app/reports                                        |   76.78 |    41.79 |   60.86 |   77.35 |                                                                                                                                                                                                                         
  page.tsx                                              |   76.78 |    41.79 |   60.86 |   77.35 | 55,162,195,236-448,470                                                                                                                                                                                                  
 src/app/reports/[id]                                   |   90.56 |     74.5 |    90.9 |   90.47 |                                                                                                                                                                                                                         
  page.tsx                                              |   90.56 |     74.5 |    90.9 |   90.47 | 56-61,155,157,159,161,319                                                                                                                                                                                               
 src/app/snapshots/[id]                                 |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  page.tsx                                              |       0 |        0 |       0 |       0 | 1-66                                                                                                                                                                                                                    
 src/components                                         |   35.89 |        0 |      40 |   33.33 |                                                                                                                                                                                                                         
  ErrorBoundary.tsx                                     |      25 |        0 |      25 |   23.33 | 37-112,118-191                                                                                                                                                                                                          
  Navigation.tsx                                        |   85.71 |      100 |     100 |   83.33 | 14                                                                                                                                                                                                                      
 src/components/analysis                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  ContentAnalysis.tsx                                   |       0 |        0 |       0 |       0 | 3-108                                                                                                                                                                                                                   
  TokenUsageDisplay.tsx                                 |       0 |      100 |       0 |       0 | 7                                                                                                                                                                                                                       
  TrendAnalysis.tsx                                     |       0 |        0 |       0 |       0 | 2-109                                                                                                                                                                                                                   
 src/components/auth                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  SignInForm.tsx                                        |       0 |        0 |       0 |       0 | 3-185                                                                                                                                                                                                                   
  SignOutButton.tsx                                     |       0 |      100 |       0 |       0 | 3-14                                                                                                                                                                                                                    
 src/components/aws                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  AWSCredentialsModal.tsx                               |       0 |        0 |       0 |       0 | 3-339                                                                                                                                                                                                                   
 src/components/chat                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  ChatInterface.tsx                                     |       0 |        0 |       0 |       0 | 3-129                                                                                                                                                                                                                   
  ChatMessage.tsx                                       |       0 |        0 |       0 |       0 | 1-16                                                                                                                                                                                                                    
  ChatTypingIndicator.tsx                               |       0 |      100 |       0 |       0 | 1-4                                                                                                                                                                                                                     
 src/components/competitors                             |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  CompetitorForm.tsx                                    |       0 |        0 |       0 |       0 | 3-43                                                                                                                                                                                                                    
  SnapshotList.tsx                                      |       0 |        0 |       0 |       0 | 3-85                                                                                                                                                                                                                    
  SnapshotSection.tsx                                   |       0 |        0 |       0 |       0 | 16-65                                                                                                                                                                                                                   
 src/components/help                                    |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  InteractiveHelpSystem.tsx                             |       0 |        0 |       0 |       0 | 3-63                                                                                                                                                                                                                    
 src/components/monitoring                              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  InitialReportsMonitoringDashboard.tsx                 |       0 |        0 |       0 |       0 | 15-460                                                                                                                                                                                                                  
 src/components/projects                                |    1.34 |        0 |       0 |    1.42 |                                                                                                                                                                                                                         
  ErrorHandling.tsx                                     |    7.04 |        0 |       0 |    8.06 | 76-147,178-299,366-442                                                                                                                                                                                                  
  InitialReportProgressIndicator.tsx                    |       0 |        0 |       0 |       0 | 3-244                                                                                                                                                                                                                   
  InitialReportStatusCard.tsx                           |       0 |        0 |       0 |       0 | 3-210                                                                                                                                                                                                                   
  ProjectCreationWizard.tsx                             |       0 |        0 |       0 |       0 | 3-792                                                                                                                                                                                                                   
  ProjectForm.tsx                                       |       0 |        0 |       0 |       0 | 1-232                                                                                                                                                                                                                   
  SupportContact.tsx                                    |       0 |        0 |       0 |       0 | 3-121                                                                                                                                                                                                                   
 src/components/reports                                 |   18.46 |       30 |   11.66 |   18.46 |                                                                                                                                                                                                                         
  ReportGenerator.tsx                                   |       0 |        0 |       0 |       0 | 1-268                                                                                                                                                                                                                   
  ReportQualityIndicators.tsx                           |       0 |        0 |       0 |       0 | 3-445                                                                                                                                                                                                                   
  ReportViewer.tsx                                      |   97.95 |      100 |    87.5 |   97.95 | 84                                                                                                                                                                                                                      
  ScheduleManager.tsx                                   |       0 |        0 |       0 |       0 | 3-290                                                                                                                                                                                                                   
 src/components/snapshots                               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  SnapshotComparison.tsx                                |       0 |        0 |       0 |       0 | 3-90                                                                                                                                                                                                                    
 src/components/status                                  |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  AWSStatusIndicator.tsx                                |       0 |        0 |       0 |       0 | 3-362                                                                                                                                                                                                                   
 src/components/ui                                      |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  OnboardingTooltip.tsx                                 |       0 |        0 |       0 |       0 | 3-431                                                                                                                                                                                                                   
 src/constants                                          |   17.14 |        0 |       0 |   20.68 |                                                                                                                                                                                                                         
  errorMessages.ts                                      |   17.14 |        0 |       0 |   20.68 | 179-224                                                                                                                                                                                                                 
 src/hooks                                              |   15.95 |        0 |    23.8 |   16.26 |                                                                                                                                                                                                                         
  useAWSStatus.ts                                       |       0 |        0 |       0 |       0 | 1-221                                                                                                                                                                                                                   
  useChat.ts                                            |       0 |        0 |       0 |       0 | 1-98                                                                                                                                                                                                                    
  useInitialReportStatus.ts                             |       0 |        0 |       0 |       0 | 1-229                                                                                                                                                                                                                   
  useObservability.ts                                   |   97.61 |        0 |    90.9 |   97.56 | 170                                                                                                                                                                                                                     
 src/lib                                                |   51.65 |       39 |   52.92 |   52.18 |                                                                                                                                                                                                                         
  analysis.ts                                           |   77.67 |    62.12 |   95.12 |   77.29 | 69-70,172-177,214-218,253-257,285,297-302,306-311,315-320,324-329,333-338,342-347,351-356,363,424-436,468,471,487,490,559                                                                                               
  auth.ts                                               |       0 |        0 |       0 |       0 | 2-22                                                                                                                                                                                                                    
  cache.ts                                              |    27.9 |    36.36 |   23.07 |    28.2 | 30-39,51-52,67-98,111-142                                                                                                                                                                                               
  concurrency.ts                                        |   78.87 |    67.44 |   81.81 |   79.41 | 80-90,103,121,131-140,159,217-236                                                                                                                                                                                       
  correlation.ts                                        |       0 |      100 |     100 |       0 | 2                                                                                                                                                                                                                       
  diff.ts                                               |     100 |    91.66 |     100 |     100 | 89                                                                                                                                                                                                                      
  env.ts                                                |      28 |       20 |       0 |   28.57 | 118-154                                                                                                                                                                                                                 
  featureFlags.ts                                       |   84.61 |     62.5 |    92.3 |   83.05 | 45,223,229-239,286                                                                                                                                                                                                      
  logger.ts                                             |   67.93 |    68.29 |   55.55 |   74.33 | 133-169,257,349,353,362,370,382,386,407-434,456-469,491-509,534-554,570-575,585                                                                                                                                         
  observability.ts                                      |     100 |    77.77 |     100 |     100 | 46,235-290                                                                                                                                                                                                              
  polyfills.ts                                          |       0 |        0 |       0 |       0 | 7-92                                                                                                                                                                                                                    
  prisma.ts                                             |       0 |        0 |     100 |       0 | 1-13                                                                                                                                                                                                                    
  profiling.ts                                          |       0 |        0 |       0 |       0 | 8-286                                                                                                                                                                                                                   
  redis-cache.ts                                        |   48.19 |    63.88 |      50 |   48.78 | 41,54-72,84-93,99-140,170,176,182,189,198,208-210                                                                                                                                                                       
  redis.ts                                              |       0 |        0 |       0 |       0 | 6-256                                                                                                                                                                                                                   
  reports.ts                                            |      60 |     39.7 |   58.73 |      60 | 104-105,285-290,358-367,413-426,456-468,483-490,542-942,974-979,983-988,992-997,1001-1006,1045-1061,1132-1133,1221-1224,1246-1247,1269,1320-1325,1339-1344,1358-1421,1466-1472                                          
  scheduler.ts                                          |       0 |        0 |       0 |       0 | 1-218                                                                                                                                                                                                                   
  scraper.ts                                            |   94.64 |      100 |   85.71 |   96.36 | 35-36                                                                                                                                                                                                                   
  trends.ts                                             |     5.6 |     4.83 |    5.26 |    5.83 | 44-421                                                                                                                                                                                                                  
 src/lib/chat                                           |   51.26 |    44.64 |   62.56 |   51.44 |                                                                                                                                                                                                                         
  comprehensiveRequirementsCollector.ts                 |   48.38 |    43.49 |   55.71 |   50.42 | 247-387,449-450,454,467-468,470,480-485,500,616-622,638-644,653,662,687-699,744-748,795-913,925-929,963-992,1094-1095,1155,1174-1372                                                                                    
  conversation.ts                                       |   57.91 |    52.65 |   71.95 |   57.53 | 135-144,174-430,609,684,737,776,820,1033,1062,1148-1233,1315,1396-1440,1496-1557,1579,1584,1612,1647-1648,1653-1654,1668,1703-1722,1739,1789,1823,1844-1850,1913,1919,1923,1947-1949,2029,2063-2074,2146-2215,2257-2536 
  enhancedProjectExtractor.ts                           |   19.02 |     7.48 |   30.43 |   18.71 | 52-67,92-546,554,571,573,608                                                                                                                                                                                            
  productChatProcessor.ts                               |   91.95 |    89.65 |     100 |   91.02 | 21,42,225,246,251,263,268                                                                                                                                                                                               
 src/lib/dataProcessing                                 |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  streamProcessor.ts                                    |       0 |        0 |       0 |       0 | 8-349                                                                                                                                                                                                                   
 src/lib/deployment                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  productionRollout.ts                                  |       0 |        0 |       0 |       0 | 1-383                                                                                                                                                                                                                   
 src/lib/middleware                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  validation.ts                                         |       0 |        0 |       0 |       0 | 2-57                                                                                                                                                                                                                    
 src/lib/monitoring                                     |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  comparativeReportMonitoring.ts                        |       0 |        0 |       0 |       0 | 1-321                                                                                                                                                                                                                   
  memoryMonitoring.ts                                   |       0 |        0 |       0 |       0 | 2-103                                                                                                                                                                                                                   
 src/lib/reports                                        |    3.57 |        0 |       0 |    4.28 |                                                                                                                                                                                                                         
  markdown-generator.ts                                 |    3.57 |        0 |       0 |    4.28 | 60-427                                                                                                                                                                                                                  
 src/lib/repositories                                   |   17.32 |    15.45 |   19.23 |   17.45 |                                                                                                                                                                                                                         
  comparativeReportRepository.ts                        |    5.05 |     3.44 |    3.33 |    4.73 | 39-562                                                                                                                                                                                                                  
  index.ts                                              |   33.33 |      100 |     100 |     100 |                                                                                                                                                                                                                         
  productRepository.ts                                  |    6.86 |     3.44 |    7.14 |    5.94 | 23-273                                                                                                                                                                                                                  
  productSnapshotRepository.ts                          |    91.3 |    60.86 |     100 |   93.33 | 66,80,111                                                                                                                                                                                                               
 src/lib/security                                       |   11.11 |        0 |       0 |   11.11 |                                                                                                                                                                                                                         
  encryption.ts                                         |   11.11 |        0 |       0 |   11.11 | 9,19-147                                                                                                                                                                                                                
 src/lib/utils                                          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  errorHandler.ts                                       |       0 |        0 |       0 |       0 | 1-235                                                                                                                                                                                                                   
 src/middleware                                         |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  security.ts                                           |       0 |        0 |       0 |       0 | 1-290                                                                                                                                                                                                                   
 src/pages/api/scrape                                   |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  competitors.ts                                        |       0 |        0 |       0 |       0 | 2-81                                                                                                                                                                                                                    
 src/services                                           |   25.67 |    23.23 |   27.62 |   26.14 |                                                                                                                                                                                                                         
  advancedSchedulingService.ts                          |       0 |        0 |       0 |       0 | 13-748                                                                                                                                                                                                                  
  autoReportGenerationService.ts                        |    9.62 |     7.76 |    12.5 |    9.65 | 163-450,459-585,595-807,819,828,838-862,870,879,889-1214,1224-1228                                                                                                                                                      
  automatedAnalysisService.ts                           |       0 |        0 |       0 |       0 | 12-477                                                                                                                                                                                                                  
  comparativeReportScheduler.ts                         |   89.24 |    73.68 |   88.46 |   89.17 | 126,223-256,312,358,446                                                                                                                                                                                                 
  comparativeReportSchedulerSimple.ts                   |   26.85 |    26.08 |   28.57 |   27.35 | 49-255,299-322,331-333,344-346,362-393,404-405                                                                                                                                                                          
  comparativeReportStorageService.ts                    |       0 |        0 |       0 |       0 | 9-618                                                                                                                                                                                                                   
  competitorAnalysis.ts                                 |       0 |        0 |       0 |       0 | 1-148                                                                                                                                                                                                                   
  competitorSnapshotOptimizer.ts                        |   92.55 |    86.53 |    92.3 |   92.97 | 235,271,380,449,512,568,623,682,688-692,757                                                                                                                                                                             
  configurationManagementService.ts                     |   68.96 |    56.41 |   70.96 |   69.17 | 227-377,482,503,508                                                                                                                                                                                                     
  featureFlagService.ts                                 |   51.61 |    46.87 |   66.66 |   51.29 | 33-65,72-121,127,146-162,169,175-181,192-231,250,264-266,314-316,386                                                                                                                                                    
  intelligentCachingService.ts                          |   37.34 |    32.72 |   45.45 |   37.24 | 169-172,207-219,265-459,477,485-486,504-505,523-526,536,543-545,557-559,571,578-632,642-693,707-738,768,782-783,794-800                                                                                                 
  intelligentProjectService.ts                          |       0 |        0 |       0 |       0 | 12-541                                                                                                                                                                                                                  
  intelligentReportingService.ts                        |       0 |        0 |       0 |       0 | 12-882                                                                                                                                                                                                                  
  performanceMonitoringService.ts                       |       0 |        0 |       0 |       0 | 13-717                                                                                                                                                                                                                  
  productScrapingService.ts                             |   76.92 |    46.34 |   91.66 |    76.8 | 61,69,160,217,380-381,400-459                                                                                                                                                                                           
  productService.ts                                     |   15.38 |        0 |       0 |    12.5 | 18-105                                                                                                                                                                                                                  
  projectScrapingService.ts                             |    8.33 |        0 |   11.11 |    7.52 | 19-292                                                                                                                                                                                                                  
  projectService.ts                                     |   15.85 |    34.04 |    12.5 |      16 | 38,71,90,105-320                                                                                                                                                                                                        
  rateLimitingService.ts                                |   63.92 |    48.19 |   71.42 |   64.23 | 305-306,319-320,326-327,348-354,359,441,523-524,529-530,556,568,576,606,619,694-700,737,754,765,803-806,862,867,872,877,889-1037                                                                                        
  realTimeStatusService.ts                              |   40.38 |    65.21 |   56.25 |   39.21 | 43-70,88-112,243-264                                                                                                                                                                                                    
  reportSchedulingService.ts                            |       0 |        0 |       0 |       0 | 13-414                                                                                                                                                                                                                  
  scheduledJobService.ts                                |       0 |        0 |       0 |       0 | 12-364                                                                                                                                                                                                                  
  scraperScheduler.ts                                   |    9.82 |        0 |       0 |     9.9 | 38-298,306-321,329-331,335-337                                                                                                                                                                                          
  smartAIService.ts                                     |       0 |        0 |       0 |       0 | 12-493                                                                                                                                                                                                                  
  smartSchedulingService.ts                             |       0 |        0 |       0 |       0 | 13-508                                                                                                                                                                                                                  
  systemHealthService.ts                                |       0 |        0 |       0 |       0 | 13-1017                                                                                                                                                                                                                 
  typeValidationService.ts                              |   47.65 |    53.57 |   62.06 |   51.75 | 161-234,365,378-384,407-424,454-495                                                                                                                                                                                     
  webScraper.ts                                         |    5.14 |        0 |       0 |     5.3 | 35,53-369,377-390                                                                                                                                                                                                       
  webScraperService.ts                                  |       0 |        0 |       0 |       0 | 1-123                                                                                                                                                                                                                   
 src/services/ai/claude                                 |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  claude.config.ts                                      |       0 |      100 |       0 |       0 | 3-13                                                                                                                                                                                                                    
  claude.service.ts                                     |       0 |        0 |       0 |       0 | 1-95                                                                                                                                                                                                                    
  index.ts                                              |       0 |      100 |     100 |       0 | 1-3                                                                                                                                                                                                                     
 src/services/analysis                                  |   54.21 |    41.55 |      55 |   56.42 |                                                                                                                                                                                                                         
  analysisDataService.ts                                |       0 |        0 |       0 |       0 | 7-372                                                                                                                                                                                                                   
  analysisPrompts.ts                                    |   59.09 |       60 |     100 |   92.85 | 391                                                                                                                                                                                                                     
  comparativeAnalysisService.ts                         |   75.72 |    42.98 |   70.83 |    76.5 | 143,327-328,336-337,345-346,354-355,363-364,406,424,438,475-611,773-842                                                                                                                                                 
  userExperienceAnalyzer.ts                             |   72.54 |       54 |      75 |   73.46 | 124-125,268,289-352                                                                                                                                                                                                     
 src/services/aws                                       |   49.44 |    49.39 |   62.06 |   49.16 |                                                                                                                                                                                                                         
  awsCredentialService.ts                               |   31.74 |       55 |      50 |   30.64 | 98-128,142,161-228,252-291                                                                                                                                                                                              
  awsCredentialsService.ts                              |       0 |        0 |       0 |       0 | 1-173                                                                                                                                                                                                                   
  credentialProvider.ts                                 |   93.24 |     90.9 |     100 |   93.24 | 57-58,79,85,151                                                                                                                                                                                                         
 src/services/bedrock                                   |   15.17 |    23.28 |    9.09 |   14.49 |                                                                                                                                                                                                                         
  bedrock.config.ts                                     |     100 |    65.38 |     100 |     100 | 8,55-81                                                                                                                                                                                                                 
  bedrock.service.ts                                    |    5.76 |        0 |       0 |       6 | 11-151                                                                                                                                                                                                                  
  bedrockService.ts                                     |       0 |      100 |     100 |       0 | 3-4                                                                                                                                                                                                                     
  bedrockServiceFactory.ts                              |       0 |        0 |       0 |       0 | 6-220                                                                                                                                                                                                                   
  index.ts                                              |       0 |      100 |     100 |       0 | 1-3                                                                                                                                                                                                                     
 src/services/mocks                                     |       0 |      100 |       0 |       0 |                                                                                                                                                                                                                         
  serviceMockFactory.ts                                 |       0 |      100 |       0 |       0 | 6-273                                                                                                                                                                                                                   
 src/services/monitoring                                |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  initialReportMonitoringService.ts                     |       0 |        0 |       0 |       0 | 13-675                                                                                                                                                                                                                  
 src/services/reports                                   |   50.04 |     36.3 |   53.95 |   50.18 |                                                                                                                                                                                                                         
  asyncReportProcessingService.ts                       |       0 |        0 |       0 |       0 | 6-680                                                                                                                                                                                                                   
  comparativeReportService.ts                           |       0 |        0 |       0 |       0 | 1-727                                                                                                                                                                                                                   
  comparativeReportTemplates.ts                         |      40 |        0 |       0 |      60 | 423-429                                                                                                                                                                                                                 
  initialComparativeReportService.ts                    |   53.42 |    22.85 |   64.28 |   52.77 | 99-104,179-213,275-284,326-344,429-436,524,531-532,540,574-734,765,769,776,785-830,974-1041                                                                                                                             
  partialDataReportGenerator.ts                         |   93.29 |     75.8 |   95.38 |   93.64 | 351-356,455-456,576-577,581,828-848,874                                                                                                                                                                                 
  reportQualityService.ts                               |   88.88 |    67.07 |   96.77 |   92.15 | 231-232,272,352,362,387,412-413,507-516,552                                                                                                                                                                             
  smartDataCollectionService.ts                         |   69.67 |    48.33 |   88.23 |   70.58 | 210-211,255,315,353,401-533,557-561,590-591,598-601,629,636-641,674,679,684                                                                                                                                             
  webScraper.ts                                         |       0 |        0 |       0 |       0 | 6-310                                                                                                                                                                                                                   
 src/types                                              |   40.14 |     5.79 |    42.5 |   37.71 |                                                                                                                                                                                                                         
  analysis.ts                                           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                         
  aws.ts                                                |       0 |        0 |       0 |       0 | 66-171                                                                                                                                                                                                                  
  comparativeReport.ts                                  |   31.25 |      100 |       0 |   21.42 | 138-145,151-166                                                                                                                                                                                                         
  enhancedReportTypes.ts                                |   75.75 |      100 |   63.63 |     100 |                                                                                                                                                                                                                         
  initialReportConfig.ts                                |    87.5 |      100 |     100 |     100 |                                                                                                                                                                                                                         
  product.ts                                            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                         
  reportTasks.ts                                        |       0 |        0 |       0 |       0 | 156-320                                                                                                                                                                                                                 
 src/utils                                              |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  frequencyParser.ts                                    |       0 |        0 |       0 |       0 | 12-95                                                                                                                                                                                                                   
 src/workers                                            |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                         
  reportScheduler.ts                                    |       0 |        0 |       0 |       0 | 1-21                                                                                                                                                                                                                    
--------------------------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL src/__tests__/integration/crossServiceValidation.test.ts
  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should integrate analysis service with report service

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      173 |         expect(reportResult).toBeDefined();
      174 |         expect(reportResult.report).toBeDefined();
    > 175 |         expect(reportResult.report.sections.length).toBeGreaterThan(0);
          |                                                     ^
      176 |         expect(reportResult.generationTime).toBeDefined();
      177 |
      178 |         logger.info('Analysis-Report integration test completed', {

      at toBeGreaterThan (src/__tests__/integration/crossServiceValidation.test.ts:175:53)
      at Object.<anonymous> (src/__tests__/integration/crossServiceValidation.test.ts:189:7)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should validate UX analyzer integration with report service

    expect(received).toBeDefined()

    Received: undefined

      259 |         // Step 2: Verify UX analysis can be used in report generation
      260 |         // This validates that the UX analyzer output format is compatible with report service
    > 261 |         expect(uxAnalysis.metadata).toBeDefined();
          |                                     ^
      262 |         expect(uxAnalysis.metadata.correlationId).toBeDefined();
      263 |         expect(uxAnalysis.metadata.analyzedAt).toBeDefined();
      264 |

      at toBeDefined (src/__tests__/integration/crossServiceValidation.test.ts:261:37)
      at Object.<anonymous> (src/__tests__/integration/crossServiceValidation.test.ts:275:7)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: Integration Testing ‚Ä∫ should validate data consistency across services

    expect(received).toBe(expected) // Object.is equality

    Expected: "Consistency Test Product"
    Received: undefined

      514 |
      515 |       // Verify report data consistency
    > 516 |       expect(reportResult.report.metadata.productName).toBe('Consistency Test Product');
          |                                                        ^
      517 |       expect(reportResult.report.metadata.competitorCount).toBe(1);
      518 |       expect(reportResult.report.metadata.analysisId).toBe(analysis.id);
      519 |

      at Object.toBe (src/__tests__/integration/crossServiceValidation.test.ts:516:56)

  ‚óè Cross-Service Integration Tests ‚Ä∫ Phase 4.1: API Integration Testing ‚Ä∫ should validate service configuration and initialization

    expect(received).toBe(expected) // Object.is equality

    Expected: "ComparativeAnalysisService"
    Received: "Object"

      548 |     it('should validate service configuration and initialization', async () => {
      549 |       // Verify services are properly initialized (check constructor names since Jest mocks may interfere)
    > 550 |       expect(analysisService.constructor.name).toBe('ComparativeAnalysisService');
          |                                                ^
      551 |       expect(reportService.constructor.name).toBe('ComparativeReportService');
      552 |       expect(uxAnalyzer.constructor.name).toBe('UserExperienceAnalyzer');
      553 |       expect(autoReportService.constructor.name).toBe('AutoReportGenerationService');

      at Object.toBe (src/__tests__/integration/crossServiceValidation.test.ts:550:48)

FAIL src/__tests__/unit/conversation.test.ts
  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Feature Flag Support ‚Ä∫ should use legacy flow when comprehensive flow is disabled

    expect(received).toBe(expected) // Object.is equality

    Expected: "text"
    Received: "comprehensive_form"

      25 |       const response = await conversationManager.processUserMessage('');
      26 |       
    > 27 |       expect(response.expectedInputType).toBe('text');
         |                                          ^
      28 |       expect(response.message).toContain('Please tell me:');
      29 |       expect(response.message).toContain('Your email address');
      30 |     });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:27:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Feature Flag Support ‚Ä∫ should respect environment variable for feature flag

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      47 |       conversationManager = new ConversationManager();
      48 |       
    > 49 |       expect(conversationManager['useComprehensiveFlow']).toBe(true);
         |                                                           ^
      50 |       
      51 |       // Cleanup
      52 |       delete process.env.ENABLE_COMPREHENSIVE_FLOW;

      at Object.toBe (src/__tests__/unit/conversation.test.ts:49:59)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle complete comprehensive submission

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: undefined

      103 |       const response = await conversationManager.processUserMessage(completeInput);
      104 |
    > 105 |       expect(response.projectCreated).toBe(true);
          |                                       ^
      106 |       expect(response.nextStep).toBe(1.5);
      107 |       expect(response.message).toContain('Project Created Successfully');
      108 |       expect(response.message).toContain('Test Product');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:105:39)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle partial comprehensive submission

    expect(received).toBe(expected) // Object.is equality

    Expected: "comprehensive_form"
    Received: "text"

      138 |
      139 |       expect(response.nextStep).toBe(0);
    > 140 |       expect(response.expectedInputType).toBe('comprehensive_form');
          |                                          ^
      141 |       expect(response.stepDescription).toBe('Complete Project Setup');
      142 |     });
      143 |

      at Object.toBe (src/__tests__/unit/conversation.test.ts:140:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Comprehensive Input Handling ‚Ä∫ should handle invalid input with validation errors

    expect(received).toBe(expected) // Object.is equality

    Expected: "comprehensive_form"
    Received: "text"

      170 |
      171 |       expect(response.nextStep).toBe(0);
    > 172 |       expect(response.expectedInputType).toBe('comprehensive_form');
          |                                          ^
      173 |     });
      174 |   });
      175 |

      at Object.toBe (src/__tests__/unit/conversation.test.ts:172:42)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Error Handling ‚Ä∫ should handle project creation failure gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Error Creating Project"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      252 |
      253 |       expect(response.error).toBeDefined();
    > 254 |       expect(response.message).toContain('Error Creating Project');
          |                                ^
      255 |       expect(response.message).toContain('retry');
      256 |     });
      257 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:254:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Error Handling ‚Ä∫ should handle parsing errors gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "error processing your request"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      266 |
      267 |       expect(response.error).toBeDefined();
    > 268 |       expect(response.message).toContain('error processing your request');
          |                                ^
      269 |     });
      270 |   });
      271 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:268:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should handle parsing errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Failed to parse input format"
    Received: "Unable to parse input: Format could not be recognized"

      486 |         const response = await conversationManager.processUserMessage(malformedInput);
      487 |
    > 488 |         expect(response.error).toBe('Failed to parse input format');
          |                                ^
      489 |         expect(response.message).toContain('Oops! I had trouble parsing');
      490 |         expect(response.message).toContain('What happened: Failed to parse input format');
      491 |         expect(response.message).toContain('Use numbered list');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:488:32)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should provide specific guidance for long inputs

    expect(received).toContain(expected) // indexOf

    Expected substring: "Try shorter format"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      504 |         const response = await conversationManager.processUserMessage(longInput);
      505 |
    > 506 |         expect(response.message).toContain('Try shorter format');
          |                                  ^
      507 |         expect(response.message).toContain('breaking it into key points');
      508 |       });
      509 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:506:34)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should provide specific guidance for special characters

    expect(received).toContain(expected) // indexOf

    Expected substring: "Simplify formatting"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      517 |         const response = await conversationManager.processUserMessage(specialCharInput);
      518 |
    > 519 |         expect(response.message).toContain('Simplify formatting');
          |                                  ^
      520 |         expect(response.message).toContain('basic punctuation');
      521 |       });
      522 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:519:34)

  ‚óè ConversationManager - Phase 3.1 Integration ‚Ä∫ Phase 3.2 Enhanced Error Handling ‚Ä∫ Parsing Error Recovery ‚Ä∫ should maintain conversational tone during error recovery

    expect(received).toContain(expected) // indexOf

    Expected substring: "I'm here to help!"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      528 |         const response = await conversationManager.processUserMessage('Error input');
      529 |
    > 530 |         expect(response.message).toContain("I'm here to help!");
          |                                  ^
      531 |         expect(response.message).toContain('ÔøΩÔøΩ');
      532 |         expect(response.message).toContain('comfortable for you');
      533 |       });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:530:34)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should create comprehensive confirmation display with all sections

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1056:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should display all contact and project information correctly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1072:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should display all product information correctly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1080:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should format multiline business context properly

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1088:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include optional enhancements when provided

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1106:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include validation warnings when provided

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1127:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include data quality assessment

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1137:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Comprehensive Confirmation Display ‚Ä∫ should include clear next step instructions

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1146:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Confirmation Response Handling ‚Ä∫ should handle edit requests

    expect(received).toContain(expected) // indexOf

    Expected substring: "Edit Your Information"
    Received string:    "ÔøΩÔøΩ **I didn't quite understand your response.**¬∑
    Please choose one of the following:¬∑
    ‚Ä¢ **\"yes\"** - Create the project and start analysis
    ‚Ä¢ **\"edit\"** - Modify the information
    ‚Ä¢ **\"cancel\"** - Start over¬∑
    What would you like to do?"

      1267 |         const result = await conversationManager['handleConfirmationResponse'](response);
      1268 |         
    > 1269 |         expect(result.message).toContain('Edit Your Information');
           |                                ^
      1270 |         expect(result.nextStep).toBe(0);
      1271 |         expect(result.stepDescription).toBe('Edit Project Information');
      1272 |         expect(result.expectedInputType).toBe('comprehensive_form');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1269:32)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Confirmation Response Handling ‚Ä∫ should handle cancellation requests

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      1281 |         
      1282 |         // Should return to project initialization
    > 1283 |         expect(result.message).toContain('comprehensive form');
           |                                ^
      1284 |         expect(result.expectedInputType).toBe('comprehensive_form');
      1285 |       }
      1286 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1283:32)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Integration with Validation ‚Ä∫ should integrate validation results into confirmation display

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1359:76)

  ‚óè Phase 4.2: Enhanced Confirmation Display ‚Ä∫ Integration with Validation ‚Ä∫ should limit warnings and suggestions display

    TypeError: Cannot read properties of undefined (reading 'collectedData')

      1144 |     
      1145 |     // *** FIX: Store the requirements in chat state BEFORE showing confirmation ***
    > 1146 |     this.chatState.collectedData = this.comprehensiveCollector.toChatState(collectedData as ComprehensiveProjectRequirements).collectedData;
           |                                                                            ^
      1147 |     
      1148 |     let message = `ÔøΩÔøΩ **Ready to Create Your Competitive Analysis Project!**\n\n`;
      1149 |     

      at ConversationManager.createComprehensiveConfirmation (src/lib/chat/conversation.ts:1146:76)
      at Object.<anonymous> (src/__tests__/unit/conversation.test.ts:1378:76)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Routing ‚Ä∫ should route to legacy step handlers when legacy session detected

    expect(received).toContain(expected) // indexOf

    Expected substring: "URL"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      1485 |       
      1486 |       // Should handle legacy step 1 (product data collection)
    > 1487 |       expect(response.message).toContain('URL');
           |                                ^
      1488 |       expect(response.stepDescription).toContain('Product');
      1489 |     });
      1490 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1487:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "migrate now" response

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the Enhanced Experience"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1578 |       const response = await manager.processUserMessage('migrate now');
      1579 |       
    > 1580 |       expect(response.message).toContain('Welcome to the Enhanced Experience');
           |                                ^
      1581 |       expect(response.message).toContain('comprehensive form');
      1582 |       expect(response.nextStep).toBe(0);
      1583 |       expect(response.stepDescription).toContain('Migrated');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1580:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "finish legacy" response

    expect(received).toContain(expected) // indexOf

    Expected substring: "Continuing Legacy Session"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1604 |       const response = await manager.processUserMessage('finish legacy');
      1605 |       
    > 1606 |       expect(response.message).toContain('Continuing Legacy Session');
           |                                ^
      1607 |       expect(response.message).toContain('step-by-step process');
      1608 |       expect(response.message).toContain('Next Time');
      1609 |       expect(response.expectedInputType).toBe('text');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1606:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Migration to New Flow ‚Ä∫ should handle "tell me more" response with feature details

    expect(received).toContain(expected) // indexOf

    Expected substring: "Enhanced Flow Features"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1629 |       const response = await manager.processUserMessage('tell me more');
      1630 |       
    > 1631 |       expect(response.message).toContain('Enhanced Flow Features');
           |                                ^
      1632 |       expect(response.message).toContain('Speed Improvements');
      1633 |       expect(response.message).toContain('Smart Intelligence');
      1634 |       expect(response.message).toContain('Professional Experience');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1631:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Recovery ‚Ä∫ should handle unknown legacy step with migration prompt

    expect(received).toContain(expected) // indexOf

    Expected substring: "Session State Recovery"
    Received string:    "ÔøΩÔøΩ **Ready to upgrade your experience?**¬∑
    I can help you get started with our new comprehensive form that's much faster and easier!¬∑
    **Here's what you can do:**¬∑
    ÔøΩÔøΩ **Switch to comprehensive form** - Type \"upgrade\" and I'll show you how to provide all your project information at once¬∑
    ÔøΩÔøΩ **Continue with current flow** - Type \"continue\" to keep using the step-by-step process¬∑
    ‚≠ê **Start fresh** - Type \"restart\" to begin a new project¬∑
    What would you prefer?"

      1654 |       const response = await manager.processUserMessage('continue');
      1655 |       
    > 1656 |       expect(response.message).toContain('Session State Recovery');
           |                                ^
      1657 |       expect(response.message).toContain('comprehensive form');
      1658 |       expect(response.message).toContain('50% faster');
      1659 |       expect(response.stepDescription).toBe('Session Recovery');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1656:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Session Recovery ‚Ä∫ should preserve data during migration

    expect(received).toContain(expected) // indexOf

    Expected substring: "Migration Tip"
    Received string:    "ÔøΩÔøΩ **Upgrade to Enhanced Experience!**¬∑
    I notice you're using our legacy step-by-step flow. Great news - we've launched a **much faster comprehensive form** that collects all requirements at once!¬∑
    **ÔøΩÔøΩ New Flow Benefits:**
    ‚Ä¢ **‚ö° 50% Faster** - Single form vs. 7+ sequential steps
    ‚Ä¢ **ÔøΩÔøΩ Clear Overview** - See all requirements upfront
    ‚Ä¢ **ÔøΩÔøΩ Smart Validation** - Intelligent error checking and suggestions
    ‚Ä¢ **ÔøΩÔøΩ Professional Confirmation** - Beautiful project summary before creation
    ‚Ä¢ **‚ú® Same Great Results** - Identical high-quality competitive analysis¬∑
    **ÔøΩÔøΩ Migration Options:**
    1. **\"migrate now\"** - Switch to the new flow immediately (recommended)
    2. **\"finish legacy\"** - Complete current session, try new flow next time
    3. **\"tell me more\"** - Learn more about the new features¬∑
    **Your Progress:** Don't worry - all your current data is preserved regardless of your choice!¬∑
    What would you like to do?"

      1678 |       const response = await manager.processUserMessage('migrate now');
      1679 |       
    > 1680 |       expect(response.message).toContain('Migration Tip');
           |                                ^
      1681 |       expect(response.message).toContain('merge everything together');
      1682 |       
      1683 |       // Check that data is preserved in chat state

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1680:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Error Handling ‚Ä∫ should offer migration when legacy step encounters error

    expect(received).toContain(expected) // indexOf

    Expected substring: "Upgrade to Enhanced Experience"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      1717 |       const response = await manager.processUserMessage('Test Product');
      1718 |       
    > 1719 |       expect(response.message).toContain('Upgrade to Enhanced Experience');
           |                                ^
      1720 |       expect(response.message).toContain('Error in legacy flow');
      1721 |     });
      1722 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1719:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Legacy Flow Completion ‚Ä∫ should handle legacy step 6 final completion

    expect(received).toContain(expected) // indexOf

    Expected substring: "consolidated competitive report"
    Received string:    "Perfect! I'll send the consolidated comparative report to test@company.com now.¬∑
    ÔøΩÔøΩ **Email Summary:**
    ‚Ä¢ **To:** test@company.com
    ‚Ä¢ **Subject:** Consolidated Competitive Analysis - Test Project
    ‚Ä¢ **Content:** Executive summary + link to full comparative report
    ‚Ä¢ **Delivery:** Within the next few minutes¬∑
    ÔøΩÔøΩ **Future Projects:** Try our new single-form flow - it's 50% faster with the same great results!¬∑
    ÔøΩÔøΩ **Legacy Session Complete!**¬∑
    Your consolidated competitor research project \"Test Project\" is now active with:
    ‚Ä¢ **‚úÖ Project Created:** test-project-id
    ‚Ä¢ **‚úÖ Consolidated Reporting:** Single comparative report per analysis cycle
    ‚Ä¢ **‚úÖ AI-Powered Analysis:** Claude-driven competitive intelligence
    ‚Ä¢ **‚úÖ Strategic Insights:** Market-wide competitive analysis¬∑
    **Next Steps:**
    ‚Ä¢ Check the **Reports section** for your comparative analysis
    ‚Ä¢ Visit the **Projects section** to manage your project
    ‚Ä¢ **Try our new flow** for your next project - type \"start new project\"¬∑
    ÔøΩÔøΩ **Ready for the Enhanced Experience?** Our new single-form flow provides the same excellent results in 50% less time!¬∑
    Thank you for using the Competitor Research Agent!"

      1792 |       
      1793 |       expect(response.message).toContain('Legacy Session Complete');
    > 1794 |       expect(response.message).toContain('consolidated competitive report');
           |                                ^
      1795 |       expect(response.message).toContain('test@company.com');
      1796 |       expect(response.message).toContain('Thank you for using');
      1797 |       expect(response.isComplete).toBe(true);

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1794:32)

  ‚óè Phase 5.1: Legacy Session Support ‚Ä∫ Backward Compatibility ‚Ä∫ should detect comprehensive flow for new sessions

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the HelloFresh"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1866 |       
      1867 |       // Should start with comprehensive flow for new sessions
    > 1868 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1869 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1870 |       expect(response.stepDescription).toBe('Complete Project Setup');
      1871 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1868:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should default to comprehensive flow for new sessions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      1883 |       
      1884 |       // Phase 5.2: Should default to comprehensive flow
    > 1885 |       expect(chatState.useComprehensiveFlow).toBe(true);
           |                                              ^
      1886 |     });
      1887 |
      1888 |     test('should start with comprehensive form for project initialization', async () => {

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1885:46)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should start with comprehensive form for project initialization

    expect(received).toContain(expected) // indexOf

    Expected substring: "Welcome to the HelloFresh"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1891 |       const response = await manager.processUserMessage('start new project');
      1892 |       
    > 1893 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1894 |       expect(response.message).toContain('comprehensive');
      1895 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1896 |       expect(response.stepDescription).toBe('Complete Project Setup');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1893:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Default Comprehensive Flow ‚Ä∫ should use comprehensive prompt by default

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      1903 |       const response = (manager as any).handleProjectInitialization();
      1904 |       
    > 1905 |       expect(response.message).toContain('Welcome to the HelloFresh');
           |                                ^
      1906 |       expect(response.expectedInputType).toBe('comprehensive_form');
      1907 |       expect(response.stepDescription).toBe('Complete Project Setup');
      1908 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1905:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Comprehensive Flow Processing ‚Ä∫ should process complete comprehensive input successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      1932 |       
      1933 |       // Should move to confirmation step
    > 1934 |       expect(response.nextStep).toBe(1.5);
           |                                 ^
      1935 |       expect(response.stepDescription).toContain('Confirmation');
      1936 |       expect(response.message).toContain('Please review');
      1937 |     });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1934:33)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Comprehensive Flow Processing ‚Ä∫ should handle partial comprehensive input with guidance

    expect(received).toBe(expected) // Object.is equality

    Expected: "Complete Project Setup"
    Received: "Error Recovery"

      1954 |       // Should stay in step 0 with guidance
      1955 |       expect(response.nextStep).toBe(0);
    > 1956 |       expect(response.stepDescription).toBe('Complete Project Setup');
           |                                        ^
      1957 |       expect(response.message).toContain('Still need');
      1958 |     });
      1959 |   });

      at Object.toBe (src/__tests__/unit/conversation.test.ts:1956:40)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should fallback to legacy flow when comprehensive parsing fails

    expect(received).toContain(expected) // indexOf

    Expected substring: "Legacy Fallback"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      1983 |       
      1984 |       // Should fallback gracefully
    > 1985 |       expect(response.message).toContain('Legacy Fallback');
           |                                ^
      1986 |       expect(response.stepDescription).toContain('Legacy Fallback');
      1987 |     });
      1988 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:1985:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should provide guidance when both parsing methods fail

    expect(received).toContain(expected) // indexOf

    Expected substring: "help you get started"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2020 |       
      2021 |       // Should provide helpful guidance
    > 2022 |       expect(response.message).toContain('help you get started');
           |                                ^
      2023 |       expect(response.message).toContain('comprehensive form');
      2024 |       expect(response.expectedInputType).toBe('comprehensive_form');
      2025 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2022:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Fallback Mechanisms ‚Ä∫ should handle complete parsing failure with step-by-step guidance

    expect(received).toContain(expected) // indexOf

    Expected substring: "start fresh"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2047 |       
      2048 |       // Should provide basic step-by-step guidance
    > 2049 |       expect(response.message).toContain('start fresh');
           |                                ^
      2050 |       expect(response.message).toContain('step-by-step');
      2051 |       expect(response.stepDescription).toContain('Guided');
      2052 |     });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2049:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should provide helpful examples when parsing fails

    expect(received).toContain(expected) // indexOf

    Expected substring: "Example format"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2110 |       
      2111 |       // Should provide examples and guidance
    > 2112 |       expect(response.message).toContain('Example format');
           |                                ^
      2113 |       expect(response.message).toContain('john.doe@company.com');
      2114 |       expect(response.message).toContain('numbered lists');
      2115 |       expect(response.expectedInputType).toBe('comprehensive_form');

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2112:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should maintain user data during error recovery

    expect(received).toContain(expected) // indexOf

    Expected substring: "Still need"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2126 |       
      2127 |       // Should preserve data and ask for missing fields
    > 2128 |       expect(response.message).toContain('Still need');
           |                                ^
      2129 |       expect(response.nextStep).toBe(0);
      2130 |       
      2131 |       // Check that partial data is preserved

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2128:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Error Recovery and User Guidance ‚Ä∫ should provide progressive completion encouragement

    expect(received).toContain(expected) // indexOf

    Expected substring: "Good"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2151 |       
      2152 |       // Should provide encouraging message about progress
    > 2153 |       expect(response.message).toContain('progress') || expect(response.message).toContain('Good');
           |                                                                                  ^
      2154 |       expect(response.nextStep).toBe(0);
      2155 |     });
      2156 |   });

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2153:82)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Performance and Reliability ‚Ä∫ should handle concurrent comprehensive form submissions

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      2183 |       // All should succeed
      2184 |       responses.forEach(response => {
    > 2185 |         expect(response.nextStep).toBe(1.5);
           |                                   ^
      2186 |         expect(response.stepDescription).toContain('Confirmation');
      2187 |       });
      2188 |     });

      at toBe (src/__tests__/unit/conversation.test.ts:2185:35)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/conversation.test.ts:2184:17)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Integration with Existing Features ‚Ä∫ should maintain compatibility with validation features

    expect(received).toContain(expected) // indexOf

    Expected substring: "email"
    Received string:    "ÔøΩÔøΩ **Oops! I had trouble parsing your input.**¬∑
    Don't worry - this happens sometimes. Let me help you get back on track!¬∑
    ÔøΩÔøΩ **What happened:** System error occurred: Unexpected processing issue¬∑
    ÔøΩÔøΩ **How to proceed:**
    ‚Ä¢ **Try again** - You can resubmit your information
    ‚Ä¢ **Step-by-step** - Type \"help\" for guided setup
    ‚Ä¢ **Start fresh** - Type \"restart\" to begin a new project¬∑
    I've preserved any valid information you provided, so you won't lose your progress! ÔøΩÔøΩ"

      2234 |       
      2235 |       // Should provide validation feedback
    > 2236 |       expect(response.message).toContain('email') || expect(response.message).toContain('URL');
           |                                ^
      2237 |       expect(response.nextStep).toBe(0);
      2238 |     });
      2239 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2236:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Integration with Existing Features ‚Ä∫ should integrate with confirmation flow

    expect(received).toBe(expected) // Object.is equality

    Expected: 1.5
    Received: 0

      2258 |       
      2259 |       // Should reach confirmation step
    > 2260 |       expect(confirmationResponse.nextStep).toBe(1.5);
           |                                             ^
      2261 |       
      2262 |       // Confirm project creation
      2263 |       const finalResponse = await manager.processUserMessage('yes, create project');

      at Object.toBe (src/__tests__/unit/conversation.test.ts:2260:45)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should not use feature flags or environment variables

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      2277 |       
      2278 |       // Should default to comprehensive flow regardless of environment
    > 2279 |       expect(chatState.useComprehensiveFlow).toBe(true);
           |                                              ^
      2280 |       
      2281 |       // Should not depend on environment variables
      2282 |       delete process.env.ENABLE_COMPREHENSIVE_FLOW;

      at Object.toBe (src/__tests__/unit/conversation.test.ts:2279:46)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should provide clear migration path for legacy users

    expect(received).toContain(expected) // indexOf

    Expected substring: "Enhanced Experience"
    Received string:    "I apologize, but I encountered an error processing your request. Please try again."

      2302 |       const response = await manager.processUserMessage('I want to try the new flow');
      2303 |       
    > 2304 |       expect(response.message).toContain('Enhanced Experience') || 
           |                                ^
      2305 |              expect(response.message).toContain('comprehensive');
      2306 |     });
      2307 |

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2304:32)

  ‚óè Phase 5.2: Direct Migration to New Flow ‚Ä∫ Migration Strategy Validation ‚Ä∫ should maintain zero breaking changes for existing users

    expect(received).toContain(expected) // indexOf

    Expected substring: "analysis"
    Received string:    "‚ö†Ô∏è **Report Generation Issue**¬∑
    I encountered an error while generating your consolidated comparative report: Failed to parse URL from /api/reports/comparative?projectId=existing-project-123¬∑
    **What happened:** The new consolidated reporting system had an issue, but don't worry - your project and data are saved.¬∑
    **Next steps:**
    1. **Retry** - Try again in a few minutes
    2. **Migrate** - Switch to our improved single-form flow for better reliability
    3. **Support** - Get help with this issue¬∑
    **Project Details:**
    - **Project:** undefined
    - **Project ID:** existing-project-123
    - **Product:** Existing Product¬∑
    Please respond with \"retry\", \"migrate\", or \"support\"."

      2325 |       expect(response.nextStep).toBe(5);
      2326 |       expect(response.message).toContain('Report') || 
    > 2327 |              expect(response.message).toContain('analysis');
           |                                       ^
      2328 |       
      2329 |       // State should be preserved
      2330 |       const chatState = manager.getChatState();

      at Object.toContain (src/__tests__/unit/conversation.test.ts:2327:39)

FAIL src/__tests__/integration/systemIntegration.test.ts
  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should generate report with real-time status updates

    TypeError: realTimeStatusService.subscribeToProjectStatus is not a function

      157 |
      158 |         // Subscribe to real-time updates
    > 159 |         realTimeStatusService.subscribeToProjectStatus(projectId, statusCallback);
          |                               ^
      160 |
      161 |         try {
      162 |           // Generate initial report

      at Object.subscribeToProjectStatus (src/__tests__/integration/systemIntegration.test.ts:159:31)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should handle smart data collection integration

    Project jwe70kmra10k1jpjc6ima6ls not found

      248 |
      249 |       if (!project) {
    > 250 |         throw new Error(`Project ${projectId} not found`);
          |               ^
      251 |       }
      252 |
      253 |       const totalCompetitors = project.competitors.length;

      at SmartDataCollectionService.collectCompetitorDataWithPriorities (src/services/reports/smartDataCollectionService.ts:250:15)
      at SmartDataCollectionService.collectProjectData (src/services/reports/smartDataCollectionService.ts:108:36)
      at Object.<anonymous> (src/__tests__/integration/systemIntegration.test.ts:196:38)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ InitialComparativeReportService Integration ‚Ä∫ should enforce rate limiting during concurrent operations

    expect(received).toBeGreaterThan(expected)

    Expected: > 10000
    Received:   1

      239 |
      240 |         expect(successfulReports.length).toBeLessThanOrEqual(5); // Max concurrent snapshots per project
    > 241 |         expect(endTime - startTime).toBeGreaterThan(10000); // Should take time due to rate limiting
          |                                     ^
      242 |
      243 |         // Add successful report IDs to cleanup
      244 |         successfulReports.forEach(result => {

      at Object.toBeGreaterThan (src/__tests__/integration/systemIntegration.test.ts:241:37)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Backend Services Integration ‚Ä∫ Configuration Management Integration ‚Ä∫ should update configuration and propagate changes

    TypeError: Cannot convert undefined or null to object
        at Function.keys (<anonymous>)

      220 |       logger.error('Configuration update failed', error as Error, {
      221 |         updatedBy,
    > 222 |         updateFields: Object.keys(updates),
          |                              ^
      223 |         rollbackToken
      224 |       });
      225 |

      at ConfigurationManagementService.keys [as updateConfiguration] (src/services/configurationManagementService.ts:222:30)
      at Object.updateConfiguration (src/__tests__/integration/systemIntegration.test.ts:259:50)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ API Endpoints Integration ‚Ä∫ Project Creation API Integration ‚Ä∫ should create project with immediate report generation

    TypeError: Cannot read properties of undefined (reading 'id')

      352 |         // For integration testing, we're testing the service integration
      353 |         const project = await createTestProjectWithData(projectData);
    > 354 |         testProjectIds.push(project.id);
          |                                     ^
      355 |
      356 |         expect(project).toBeDefined();
      357 |         expect(project.id).toBeDefined();

      at Object.id (src/__tests__/integration/systemIntegration.test.ts:354:37)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ Infrastructure Integration ‚Ä∫ Database Schema Integration ‚Ä∫ should handle initial reports schema correctly

    TypeError: Cannot read properties of undefined (reading 'id')

      462 |         });
      463 |
    > 464 |         testReportIds.push(report.id);
          |                                   ^
      465 |
      466 |         expect(report).toBeDefined();
      467 |         expect(report.isInitialReport).toBe(true);

      at Object.id (src/__tests__/integration/systemIntegration.test.ts:464:35)

  ‚óè Phase 5.4: System Integration Tests ‚Ä∫ End-to-End Integration ‚Ä∫ should complete full user journey with all systems

    Project v1whq1pe0d1tvf4jp7bcfxwl not found

      511 |
      512 |       if (!project) {
    > 513 |         throw new Error(`Project ${projectId} not found`);
          |               ^
      514 |       }
      515 |
      516 |       const missingData: string[] = [];

      at InitialComparativeReportService.validateProjectReadiness (src/services/reports/initialComparativeReportService.ts:513:15)
      at Object.<anonymous> (src/__tests__/integration/systemIntegration.test.ts:580:31)

FAIL src/__tests__/unit/comprehensiveRequirementsCollector.test.ts
  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should generate a comprehensive prompt with all required sections

    expect(received).toContain(expected) // indexOf

    Expected substring: "OPTIONAL ENHANCEMENTS"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      16 |       expect(prompt).toContain('PRODUCT INFORMATION');
      17 |       expect(prompt).toContain('BUSINESS CONTEXT');
    > 18 |       expect(prompt).toContain('OPTIONAL ENHANCEMENTS');
         |                      ^
      19 |       expect(prompt).toContain('HOW TO RESPOND');
      20 |       expect(prompt).toContain('Ready when you are');
      21 |     });

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:18:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should support different tones

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "ÔøΩÔøΩ"
    Received string:        "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**

    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!

    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?

    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?

    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics  
    9. **User problems** - Core problems your product solves

    **ÔøΩÔøΩ HOW TO RESPOND:**

    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly  
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"

    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order

    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      28 |       expect(professionalPrompt).toContain('Competitor Research Agent');
      29 |       expect(professionalPrompt).toContain('competitive analysis');
    > 30 |       expect(professionalPrompt).not.toContain('ÔøΩÔøΩ');
         |                                      ^
      31 |
      32 |       expect(friendlyPrompt).toContain('ÔøΩÔøΩ');
      33 |       expect(friendlyPrompt).toContain('Ready when you are! ÔøΩÔøΩ');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:30:38)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should include industry-specific examples when requested

    expect(received).toContain(expected) // indexOf

    Expected substring: "SaaS"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      48 |       });
      49 |
    > 50 |       expect(saasPrompt).toContain('SaaS');
         |                          ^
      51 |       expect(saasPrompt).toContain('B2B productivity platform');
      52 |       
      53 |       expect(foodPrompt).toContain('meal delivery');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:50:26)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should hide optional fields when requested

    expect(received).toContain(expected) // indexOf

    Expected substring: "OPTIONAL ENHANCEMENTS"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      59 |       const withoutOptional = collector.generateComprehensivePrompt({ showOptionalFields: false });
      60 |
    > 61 |       expect(withOptional).toContain('OPTIONAL ENHANCEMENTS');
         |                            ^
      62 |       expect(withoutOptional).not.toContain('OPTIONAL ENHANCEMENTS');
      63 |     });
      64 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:61:28)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should customize contextual help

    expect(received).toContain(expected) // indexOf

    Expected substring: "intelligently parse"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      67 |       const withoutHelp = collector.generateComprehensivePrompt({ includeContextualHelp: false });
      68 |
    > 69 |       expect(withHelp).toContain('intelligently parse');
         |                        ^
      70 |       expect(withoutHelp).not.toContain('intelligently parse');
      71 |     });
      72 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:69:24)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateComprehensivePrompt ‚Ä∫ should emphasize speed when requested

    expect(received).not.toContain(expected) // indexOf

    Expected substring: not "faster"
    Received string:        "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**

    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!

    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?

    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?

    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics  
    9. **User problems** - Core problems your product solves

    **ÔøΩÔøΩ HOW TO RESPOND:**

    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly  
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```

    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"

    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order

    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      76 |
      77 |       expect(withSpeed).toContain('faster');
    > 78 |       expect(withoutSpeed).not.toContain('faster');
         |                                ^
      79 |     });
      80 |   });
      81 |

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:78:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateIndustrySpecificPrompt ‚Ä∫ should generate industry-specific prompts

    expect(received).toContain(expected) // indexOf

    Expected substring: "SaaS"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

      85 |       const fintech = collector.generateIndustrySpecificPrompt('fintech');
      86 |
    > 87 |       expect(saasPrompt).toContain('SaaS');
         |                          ^
      88 |       expect(saasPrompt).toContain('B2B productivity platform');
      89 |       
      90 |       expect(fintech).toContain('fintech');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:87:26)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generateConcisePrompt ‚Ä∫ should generate a concise prompt

    expect(received).toContain(expected) // indexOf

    Expected substring: "Competitor Analysis Setup"
    Received string:    "ÔøΩÔøΩ **Welcome to the Competitor Research Agent!**¬∑
    To create your comprehensive competitive analysis, I need all the following information at once. This replaces our multi-step process and gets you started faster!¬∑
    **ÔøΩÔøΩ CONTACT & SCHEDULING (Required):**
    1. **Email address** - Where should I send reports?
    2. **Report frequency** - Weekly, Monthly, or Quarterly?
    3. **Project name** - What should we call this analysis?¬∑
    **ÔøΩÔøΩ PRODUCT INFORMATION (Required):**
    4. **Product name** - What's your product called?
    5. **Product website URL** - Full URL for analysis (https://...)
    6. **Industry/Market** - What sector are you in?¬∑
    **ÔøΩÔøΩ BUSINESS CONTEXT (Required):**
    7. **Product positioning** - Value props, target market, competitive advantage
    8. **Customer data** - Demographics, segments, size, characteristics¬∑¬∑
    9. **User problems** - Core problems your product solves¬∑
    **ÔøΩÔøΩ HOW TO RESPOND:**¬∑
    **‚úÖ SIMPLE NUMBERED LIST (Recommended)**
    ```
    1. john.doe@company.com
    2. Weekly¬∑¬∑
    3. Good Chop Analysis
    4. Good Chop
    5. https://goodchop.com
    6. Food delivery
    7. Premium meat delivery for health-conscious consumers
    8. 10,000+ urban customers aged 25-40
    9. Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NUMBERED LIST WITH LABELS (Also Works)**
    ```
    1. Email: john.doe@company.com
    2. Frequency: Weekly
    3. Project: Good Chop Analysis
    4. Product: Good Chop
    5. Website: https://goodchop.com
    6. Industry: Food delivery
    7. Positioning: Premium meat delivery for health-conscious consumers
    8. Customers: 10,000+ urban customers aged 25-40
    9. Problem: Finding high-quality, ethically sourced meat locally
    ```¬∑
    **‚úÖ NATURAL LANGUAGE (Works Too)**
    \"My email is john.doe@company.com and I want weekly reports for my Good Chop Analysis project. We're analyzing Good Chop at https://goodchop.com in the food delivery industry...\"¬∑
    **ÔøΩÔøΩ IMPORTANT TIPS:**
    ‚Ä¢ **Both formats work perfectly** - Use whichever feels more natural to you
    ‚Ä¢ **Be specific but concise** - \"Finding good meat locally\" is perfect
    ‚Ä¢ **URLs must start with https://** - This helps me validate and scrape correctly
    ‚Ä¢ **Don't worry about perfect formatting** - I'll understand most reasonable formats
    ‚Ä¢ **All 9 fields are required** - But you can provide them in any order¬∑
    Ready to start? Just provide your information in any format above! ÔøΩÔøΩ"

       97 |       const prompt = collector.generateConcisePrompt();
       98 |       
    >  99 |       expect(prompt).toContain('Competitor Analysis Setup');
          |                      ^
      100 |       expect(prompt).not.toContain('OPTIONAL ENHANCEMENTS');
      101 |       expect(prompt).not.toContain('ÔøΩÔøΩ');
      102 |       expect(prompt).toContain('Ready for your input');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:99:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ generatePartialPrompt ‚Ä∫ should generate helpful partial prompts

    expect(received).toContain(expected) // indexOf

    Expected substring: "Product Website"
    Received string:    "ÔøΩÔøΩ **Almost Complete!** You've provided 7/9 required fields.¬∑
    **Still need:**
    ‚Ä¢ **Product URL**: Your product's website (e.g., https://myproduct.com)
    ‚Ä¢ **Industry**: Your market sector (e.g., SaaS)¬∑
    **Already have:**
    ÔøΩÔøΩ Email: test@company.com
    ÔøΩÔøΩ Frequency: Weekly
    ÔøΩÔøΩ Project: Test Project¬∑
    Please provide the missing information in any format you prefer. I'll combine it with what you've already given me! ÔøΩÔøΩ"

      117 |       expect(prompt).toContain('Almost Complete');
      118 |       expect(prompt).toContain('7/9 required fields');
    > 119 |       expect(prompt).toContain('Product Website');
          |                      ^
      120 |       expect(prompt).toContain('Industry/Market');
      121 |       expect(prompt).toContain('Already have');
      122 |       expect(prompt).toContain('test@company.com');

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:119:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Email extraction ‚Ä∫ should extract email from various formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:150:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:149:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Email extraction ‚Ä∫ should handle invalid email formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:166:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:165:23)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Frequency extraction ‚Ä∫ should extract frequency keywords

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:183:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:182:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ URL extraction ‚Ä∫ should extract URLs with cleanup

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:199:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:198:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Field Extraction ‚Ä∫ Project name extraction ‚Ä∫ should extract project names from various formats

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:215:36)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:214:19)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle complete single submission

    expect(received).toBe(expected) // Object.is equality

    Expected: "https://goodchop.com"
    Received: "https://goodchop.com/"

      244 |       expect(result.extractedData.projectName).toBe('Good Chop Analysis');
      245 |       expect(result.extractedData.productName).toBe('Good Chop');
    > 246 |       expect(result.extractedData.productUrl).toBe('https://goodchop.com');
          |                                               ^
      247 |       expect(result.extractedData.industry).toBe('Food delivery');
      248 |     });
      249 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:246:47)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle natural language format

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:258:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Comprehensive parsing ‚Ä∫ should handle partial submission gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:276:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Error handling and suggestions ‚Ä∫ should provide specific guidance for invalid email

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:320:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Error handling and suggestions ‚Ä∫ should handle missing URL gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:332:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ createMissingFieldsPrompt ‚Ä∫ should create helpful prompt for missing fields

    expect(received).toContain(expected) // indexOf

    Expected substring: "Product Website"
    Received string:    "ÔøΩÔøΩ **Progress: 50% Complete**¬∑
    ÔøΩÔøΩ **Still need the following required information:**
    ‚Ä¢ **Product URL**: Your product's website
      ÔøΩÔøΩ Example: https://myproduct.com
    ‚Ä¢ **Industry**: Your market sector
      ÔøΩÔøΩ Example: SaaS¬∑
    ÔøΩÔøΩ **Helpful tips:**
    ‚Ä¢ Include your product website URL¬∑
    Please provide the missing information, and I'll create your competitive analysis project! ÔøΩÔøΩ"

      353 |       expect(prompt).toContain('Progress: 50% Complete');
      354 |       expect(prompt).toContain('Still need the following');
    > 355 |       expect(prompt).toContain('Product Website');
          |                      ^
      356 |       expect(prompt).toContain('Industry/Market');
      357 |       expect(prompt).toContain('Helpful tips');
      358 |     });

      at Object.toContain (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:355:22)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle special characters in project names

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:399:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle multiple URLs in text

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:410:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle empty input gracefully

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:415:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Edge cases ‚Ä∫ should handle very long input

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:424:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Performance ‚Ä∫ should parse typical input within reasonable time

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:446:32)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Parsing Strategy Detection ‚Ä∫ should detect natural language format

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:485:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Parsing Strategy Detection ‚Ä∫ should handle mixed format intelligently

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:498:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Contextual Intelligence ‚Ä∫ should detect industry context from content

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:536:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Contextual Intelligence ‚Ä∫ should use contextual clues for better extraction

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:548:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Smart Completeness Calculation ‚Ä∫ should handle partial credit for uncertain extractions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:572:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should provide format-specific suggestions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:585:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should suggest optimal format for mixed inputs

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:594:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Intelligent Suggestion Generation ‚Ä∫ should provide context-aware field suggestions

    TypeError: this.extractFromLineByLineFormat is not a function

      632 |     // Try line-by-line structured extraction (test format)
      633 |     if (!extractedData.userEmail || !extractedData.reportFrequency || !extractedData.projectName) {
    > 634 |       this.extractFromLineByLineFormat(message, extractedData, confidence);
          |            ^
      635 |     }
      636 |     
      637 |     // Fill gaps with pattern matching

      at ComprehensiveRequirementsCollector.extractFromLineByLineFormat [as parseMixedFormat] (src/lib/chat/comprehensiveRequirementsCollector.ts:634:12)
      at ComprehensiveRequirementsCollector.parseMixedFormat [as parseComprehensiveInput] (src/lib/chat/comprehensiveRequirementsCollector.ts:453:14)
      at Object.parseComprehensiveInput (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:602:34)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Enhanced Field Validation ‚Ä∫ should validate email formats contextually

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      616 |         const result = collector.parseComprehensiveInput(input);
      617 |         
    > 618 |         expect(result.invalidFields.some(f => f.field === 'userEmail')).toBe(true);
          |                                                                         ^
      619 |         expect(result.invalidFields.some(f => f.reason.includes('Invalid email format'))).toBe(true);
      620 |       });
      621 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:618:73)

  ‚óè ComprehensiveRequirementsCollector ‚Ä∫ Phase 2.2 Advanced Parsing Features ‚Ä∫ Enhanced Field Validation ‚Ä∫ should validate URL formats with suggestions

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      629 |         const result = collector.parseComprehensiveInput(input);
      630 |         
    > 631 |         expect(result.invalidFields.some(f => f.field === 'productUrl')).toBe(true);
          |                                                                          ^
      632 |         expect(result.invalidFields.some(f => f.suggestion.includes('https://'))).toBe(true);
      633 |       });
      634 |

      at Object.toBe (src/__tests__/unit/comprehensiveRequirementsCollector.test.ts:631:74)

FAIL src/__tests__/integration/productVsCompetitorApiIntegration.test.ts
  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Comparative Report API Endpoints - Fix 7.1c Applied ‚Ä∫ should get comparative report status with realistic tracking

    TypeError: mockWorkflow.apiService.getComparativeStatus is not a function

      322 |       console.log('ÔøΩÔøΩ Testing comparative report status API with Fix 7.1c...');
      323 |
    > 324 |       const mockApiResponse = await mockWorkflow.apiService.getComparativeStatus({ productId: testProductId });
          |                                                             ^
      325 |
      326 |       expect(mockApiResponse.status).toBe(200);
      327 |       expect(mockApiResponse.data.success).toBe(true);

      at Object.getComparativeStatus (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:324:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Report Scheduling API Endpoints - Fix 7.1c Applied ‚Ä∫ should create report schedule with realistic workflow patterns

    TypeError: mockWorkflow.apiService.createSchedule is not a function

      354 |       };
      355 |
    > 356 |       const mockApiResponse = await mockWorkflow.apiService.createSchedule(scheduleData);
          |                                                             ^
      357 |
      358 |       expect(mockApiResponse.status).toBe(200);
      359 |       expect(mockApiResponse.data.success).toBe(true);

      at Object.createSchedule (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:356:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ Report Scheduling API Endpoints - Fix 7.1c Applied ‚Ä∫ should get schedules with realistic pagination and filtering

    TypeError: mockWorkflow.apiService.getSchedules is not a function

      377 |       console.log('ÔøΩÔøΩ Testing schedule retrieval API with Fix 7.1c...');
      378 |
    > 379 |       const mockApiResponse = await mockWorkflow.apiService.getSchedules({ 
          |                                                             ^
      380 |         productId: testProductId,
      381 |         page: 1,
      382 |         limit: 10 

      at Object.getSchedules (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:379:61)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ End-to-End API Workflow - Fix 7.1c Applied ‚Ä∫ should execute complete product vs competitor workflow with realistic data flow

    TypeError: mockWorkflow.apiService.generateAnalysis is not a function

      432 |       };
      433 |
    > 434 |       const analysisResponse = await mockWorkflow.apiService.generateAnalysis(analysisData);
          |                                                              ^
      435 |       expect(analysisResponse.status).toBe(200);
      436 |       const analysisId = analysisResponse.data.data.analysisId;
      437 |

      at Object.generateAnalysis (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:434:62)

  ‚óè PRODUCT vs COMPETITOR API Integration Tests - Fix 7.1c Applied ‚Ä∫ End-to-End API Workflow - Fix 7.1c Applied ‚Ä∫ should handle error scenarios in E2E workflow with realistic error recovery

    TypeError: mockWorkflow.apiService.generateAnalysis is not a function

      506 |       };
      507 |
    > 508 |       const analysisErrorResponse = await mockWorkflow.apiService.generateAnalysis(invalidAnalysisData);
          |                                                                   ^
      509 |       expect(analysisErrorResponse.status).toBe(404);
      510 |       expect(analysisErrorResponse.data.success).toBe(false);
      511 |       expect(analysisErrorResponse.data.error.type).toBe('resource_not_found');

      at Object.generateAnalysis (src/__tests__/integration/productVsCompetitorApiIntegration.test.ts:508:67)

FAIL src/app/api/projects/__tests__/route.immediateReports.test.ts
  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Basic Request Handling ‚Ä∫ should handle simple request parsing

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      171 |       const response = await POST(request);
      172 |       
    > 173 |       expect(response.status).toBe(201);
          |                               ^
      174 |     }, 10000);  // 10 second timeout
      175 |   });
      176 |

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:173:31)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should generate initial report immediately when requested

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"enableGracefulDegradation": true, "fallbackToQueue": true, "maxConcurrentProcessing": 5, "notifyOnCompletion": false, "priority": "high", "retryAttempts": 2, "timeout": 45000}

    Number of calls: 0

      197 |
      198 |       // Verify asyncReportProcessingService was called (this is what the API route actually uses)
    > 199 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith(
          |                                                                 ^
      200 |         'project-1',
      201 |         expect.objectContaining({
      202 |           timeout: 45000,

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:199:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should respect generateInitialReport=false flag

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      242 |       expect(asyncReportProcessingService.processInitialReport).not.toHaveBeenCalled();
      243 |       
    > 244 |       expect(response.status).toBe(201);
          |                               ^
      245 |     }, 10000);
      246 |
      247 |     it('should fallback to queue when immediate generation fails', async () => {

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:244:31)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should fallback to queue when immediate generation fails

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", Any<Object>

    Number of calls: 0

      275 |
      276 |       // Verify processing service was called
    > 277 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith('project-1', expect.any(Object));
          |                                                                 ^
      278 |       
      279 |       expect(responseData.reportGeneration).toEqual(
      280 |         expect.objectContaining({

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:277:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Immediate Report Generation ‚Ä∫ should handle requireFreshSnapshots option

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"fallbackToQueue": true, "priority": "high", "timeout": 45000}

    Number of calls: 0

      304 |
      305 |       // The API route uses asyncReportProcessingService and the requireFreshSnapshots logic is handled internally
    > 306 |       expect(asyncReportProcessingService.processInitialReport).toHaveBeenCalledWith(
          |                                                                 ^
      307 |         'project-1',
      308 |         expect.objectContaining({
      309 |           timeout: 45000,

      at Object.toHaveBeenCalledWith (src/app/api/projects/__tests__/route.immediateReports.test.ts:306:65)

  ‚óè POST /api/projects - Phase 1.2 Enhanced Flow ‚Ä∫ Project Creation Resilience ‚Ä∫ should create project successfully even when report generation fails completely

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      345 |
      346 |       // Project should still be created successfully
    > 347 |       expect(response.status).toBe(201);
          |                               ^
      348 |       expect(responseData.id).toBe('project-1');
      349 |       
      350 |       // Report generation should indicate failure

      at Object.toBe (src/app/api/projects/__tests__/route.immediateReports.test.ts:347:31)

FAIL src/services/__tests__/rateLimitingService.test.ts
  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should enforce daily cost limits

    expect(received).toContain(expected) // indexOf

    Expected substring: "Daily cost limit would be exceeded"
    Received string:    "Hourly cost limit would be exceeded ($12.00 > $2)"

      147 |       
      148 |       expect(decision.allowed).toBe(false);
    > 149 |       expect(decision.reason).toContain('Daily cost limit would be exceeded');
          |                               ^
      150 |       expect(decision.fallbackSuggested).toContain('tomorrow');
      151 |     });
      152 |

      at Object.toContain (src/services/__tests__/rateLimitingService.test.ts:149:31)

  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should enforce domain throttling

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      158 |       // Immediate second request to same domain should be throttled
      159 |       const decision2 = await rateLimitingService.checkRateLimit(mockContext);
    > 160 |       expect(decision2.allowed).toBe(false);
          |                                 ^
      161 |       expect(decision2.reason).toContain('throttled');
      162 |       expect(decision2.waitTimeMs).toBeGreaterThan(0);
      163 |     });

      at Object.toBe (src/services/__tests__/rateLimitingService.test.ts:160:33)

  ‚óè RateLimitingService ‚Ä∫ Rate Limiting Decisions ‚Ä∫ should provide meaningful fallback suggestions

    expect(received).toBeDefined()

    Received: undefined

      181 |       const decision = await rateLimitingService.checkRateLimit(throttledContext);
      182 |       
    > 183 |       expect(decision.fallbackSuggested).toBeDefined();
          |                                          ^
      184 |       expect(decision.fallbackSuggested).toContain('cached');
      185 |     });
      186 |   });

      at Object.toBeDefined (src/services/__tests__/rateLimitingService.test.ts:183:42)

  ‚óè RateLimitingService ‚Ä∫ Rate Limit Execution ‚Ä∫ should track concurrent requests correctly

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      249 |       // Check metrics during execution
      250 |       const metrics = rateLimitingService.getRateLimitingMetrics();
    > 251 |       expect(metrics.currentConcurrentRequests).toBeGreaterThan(0);
          |                                                 ^
      252 |       
      253 |       await Promise.all([promise1, promise2]);
      254 |       

      at Object.toBeGreaterThan (src/services/__tests__/rateLimitingService.test.ts:251:49)

  ‚óè RateLimitingService ‚Ä∫ Performance and Load Testing ‚Ä∫ should enforce global concurrency limits under load

    TypeError: Cannot use 'in' operator to search for 'error' in success

      473 |       
      474 |       // Some should succeed, some should be rate limited
    > 475 |       const successes = results.filter(r => !('error' in r)).length;
          |                                               ^
      476 |       const rateLimited = results.filter(r => 
      477 |         'error' in r && r.error.includes('Rate limit exceeded')
      478 |       ).length;

      at src/services/__tests__/rateLimitingService.test.ts:475:47
          at Array.filter (<anonymous>)
      at Object.filter (src/services/__tests__/rateLimitingService.test.ts:475:33)

  ‚óè RateLimitingService ‚Ä∫ Background Tasks and Maintenance ‚Ä∫ should initialize without errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Rate limiting service initialized", Any<Object>

    Number of calls: 0

      522 |     it('should initialize without errors', () => {
      523 |       expect(rateLimitingService).toBeDefined();
    > 524 |       expect(logger.info).toHaveBeenCalledWith(
          |                           ^
      525 |         'Rate limiting service initialized',
      526 |         expect.any(Object)
      527 |       );

      at Object.toHaveBeenCalledWith (src/services/__tests__/rateLimitingService.test.ts:524:27)

  ‚óè RateLimitingService ‚Ä∫ Background Tasks and Maintenance ‚Ä∫ should provide meaningful recommended actions when issues detected

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      533 |       
      534 |       const metrics = rateLimitingService.getRateLimitingMetrics();
    > 535 |       expect(metrics.recommendedActions.length).toBeGreaterThan(0);
          |                                                 ^
      536 |       expect(metrics.recommendedActions[0]).toContain('Circuit breaker');
      537 |     });
      538 |   });

      at Object.toBeGreaterThan (src/services/__tests__/rateLimitingService.test.ts:535:49)

FAIL src/__tests__/unit/smartDataCollectionEdgeCases.test.ts
  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle empty competitor list gracefully

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      51 |     smartDataCollectionService = new SmartDataCollectionService();
      52 |     
    > 53 |     const result = await smartDataCollectionService.collectCompetitorData([], { projectId: 'project-123' });
         |                                                     ^
      54 |     
      55 |     expect(result).toBeDefined();
      56 |     expect(result.success).toBe(true);

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:53:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle web scraper initialization failure

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      75 |     
      76 |     // Should still complete with fallback data
    > 77 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
         |                                                     ^
      78 |       projectId: 'project-123',
      79 |       requireFreshSnapshots: true
      80 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:77:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle invalid competitor websites

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      104 |     
      105 |     // Should handle invalid URL
    > 106 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      107 |       projectId: 'project-123',
      108 |       requireFreshSnapshots: true
      109 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:106:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle timeouts during data collection

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      137 |     
      138 |     // Should timeout and fall back to existing data
    > 139 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      140 |       projectId: 'project-123',
      141 |       requireFreshSnapshots: true,
      142 |       maxCaptureTime: 500 // Very short timeout (500ms)

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:139:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle corrupted existing snapshot data

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      179 |     
      180 |     // Should handle corrupted data gracefully
    > 181 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      182 |       projectId: 'project-123',
      183 |       requireFreshSnapshots: false // Fall back to existing data
      184 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:181:53)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle database failures during collection

    TypeError: Cannot read properties of undefined (reading 'create')

      210 |     
      211 |     // Database failure
    > 212 |     (prisma.competitorSnapshot.create as jest.Mock).mockRejectedValue(
          |                                ^
      213 |       new Error('Database error')
      214 |     );
      215 |     

      at Object.create (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:212:32)

  ‚óè SmartDataCollectionService Edge Cases ‚Ä∫ should handle priority fallbacks properly

    TypeError: smartDataCollectionService.collectCompetitorData is not a function

      256 |     
      257 |     // Should fall back to existing snapshots (Priority 4)
    > 258 |     const result = await smartDataCollectionService.collectCompetitorData(competitors, { 
          |                                                     ^
      259 |       projectId: 'project-123',
      260 |       requireFreshSnapshots: true // Try fresh first, but allow fallback
      261 |     });

      at Object.collectCompetitorData (src/__tests__/unit/smartDataCollectionEdgeCases.test.ts:258:53)

FAIL src/__tests__/unit/initialComparativeReportEdgeCases.test.ts
  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle missing project data gracefully

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      56 |     
      57 |     // Act
    > 58 |     const result = await initialComparativeReportService.generateInitialReport('non-existent-id');
         |                                                          ^
      59 |     
      60 |     // Assert
      61 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:58:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle project with no competitors

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      81 |     
      82 |     // Act
    > 83 |     const result = await initialComparativeReportService.generateInitialReport('project-123');
         |                                                          ^
      84 |     
      85 |     // Assert
      86 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:83:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle project with missing product data

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      104 |     
      105 |     // Act
    > 106 |     const result = await initialComparativeReportService.generateInitialReport('project-123');
          |                                                          ^
      107 |     
      108 |     // Assert
      109 |     expect(result).toBeDefined();

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:106:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle competitors with no snapshots

    TypeError: Cannot read properties of undefined (reading 'findMany')

      126 |     });
      127 |     
    > 128 |     (prisma.competitorSnapshot.findMany as jest.Mock).mockResolvedValue([]);
          |                                ^
      129 |     
      130 |     const { InitialComparativeReportService } = await import('@/services/reports/initialComparativeReportService');
      131 |     initialComparativeReportService = new InitialComparativeReportService();

      at Object.findMany (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:128:32)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle database connection failures during competitor snapshot capture

    TypeError: Cannot read properties of undefined (reading 'create')

      157 |     
      158 |     // Mock database connection failure
    > 159 |     (prisma.competitorSnapshot.create as jest.Mock).mockRejectedValue(
          |                                ^
      160 |       new Error('Database connection error')
      161 |     );
      162 |     

      at Object.create (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:159:32)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle malformed data from competitors

    TypeError: initialComparativeReportService.generateInitialReport is not a function

      202 |     
      203 |     // Act - Force partial data handling
    > 204 |     const result = await initialComparativeReportService.generateInitialReport('project-123', {
          |                                                          ^
      205 |       fallbackToPartialData: true
      206 |     });
      207 |     

      at Object.generateInitialReport (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:204:58)

  ‚óè InitialComparativeReportService Edge Cases ‚Ä∫ should handle timeouts during report generation

    TypeError: Cannot read properties of undefined (reading 'findFirst')

      237 |     });
      238 |     
    > 239 |     (prisma.productSnapshot.findFirst as jest.Mock).mockResolvedValue({
          |                             ^
      240 |       id: 'prod-snap-1',
      241 |       productId: 'product-123',
      242 |       metadata: { data: 'test' },

      at Object.findFirst (src/__tests__/unit/initialComparativeReportEdgeCases.test.ts:239:29)

FAIL src/__tests__/unit/featureFlagService.test.ts
  ‚óè FeatureFlagService ‚Ä∫ Caching Behavior ‚Ä∫ should cache feature flag results

    expect(received).toBeLessThan(expected)

    Expected: < 0
    Received:   0

      324 |       
      325 |       expect(result1).toBe(result2);
    > 326 |       expect(duration2).toBeLessThan(duration1); // Cached should be faster
          |                         ^
      327 |       
      328 |       await service.cleanup();
      329 |     });

      at Object.toBeLessThan (src/__tests__/unit/featureFlagService.test.ts:326:25)

FAIL src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts
  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should use partial data generator when data completeness < 70%

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: null, ObjectContaining {"name": "Test Product"}, ObjectContaining {"id": "snapshot-1"}, ObjectContaining {"acknowledgeDataLimitations": true, "includeDataGapSection": true, "includeRecommendations": true, "partialDataInfo": ObjectContaining {"dataCompletenessScore": 55, "dataFreshness": "existing", "qualityTier": "enhanced"}, "template": "comprehensive"}

    Number of calls: 0

      184 |
      185 |       // Verify partial data generator was used
    > 186 |       expect(mockPartialDataGenerator.generatePartialDataReport).toHaveBeenCalledWith(
          |                                                                  ^
      187 |         null, // Analysis should be null due to failed analysis
      188 |         expect.objectContaining({ name: 'Test Product' }),
      189 |         expect.objectContaining({ id: 'snapshot-1' }),

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:186:66)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should handle analysis failure gracefully in partial data mode

    Insufficient competitor data for analysis

      361 |       // Mock analysis failure
      362 |       mockComparativeAnalysisService.analyzeProductVsCompetitors.mockRejectedValue(
    > 363 |         new Error('Insufficient competitor data for analysis')
          |         ^
      364 |       );
      365 |       
      366 |       mockPartialDataGenerator.generatePartialDataReport.mockResolvedValue(mockPartialReport);

      at Object.<anonymous> (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:363:9)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ generateInitialComparativeReport with low data completeness ‚Ä∫ should build correct partial data info from smart collection result

    expect(received).toEqual(expected) // deep equality

    - Expected  - 7
    + Received  + 4

    @@ -6,20 +6,17 @@
          "hasProductData": true,
          "hasSnapshots": true,
        },
        "dataCompletenessScore": 65,
        "dataFreshness": "mixed",
    -   "dataGaps": ArrayContaining [
    -     ObjectContaining {
    -       "area": "Competitor Website Snapshots",
    -       "canBeImproved": true,
    -       "impact": "high",
    -     },
    -     ObjectContaining {
    +   "dataGaps": Array [
    +     Object {
            "area": "Competitor Data Coverage",
            "canBeImproved": true,
    +       "description": "Only 3/4 competitors have sufficient data for analysis.",
            "impact": "medium",
    +       "recommendation": "Collect additional competitor information to improve analysis completeness",
          },
        ],
        "missingData": Array [
          "2 fresh competitor snapshots",
        ],

      405 |       const partialDataInfo = (service as any).buildPartialDataInfo(mockSmartCollectionResult);
      406 |
    > 407 |       expect(partialDataInfo).toEqual({
          |                               ^
      408 |         dataCompletenessScore: 65,
      409 |         dataFreshness: 'mixed',
      410 |         availableData: {

      at Object.toEqual (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:407:31)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ buildPartialDataInfo ‚Ä∫ should build correct partial data info from smart collection result

    expect(received).toEqual(expected) // deep equality

    - Expected  - 7
    + Received  + 4

    @@ -6,20 +6,17 @@
          "hasProductData": true,
          "hasSnapshots": true,
        },
        "dataCompletenessScore": 65,
        "dataFreshness": "mixed",
    -   "dataGaps": ArrayContaining [
    -     ObjectContaining {
    -       "area": "Competitor Website Snapshots",
    -       "canBeImproved": true,
    -       "impact": "high",
    -     },
    -     ObjectContaining {
    +   "dataGaps": Array [
    +     Object {
            "area": "Competitor Data Coverage",
            "canBeImproved": true,
    +       "description": "Only 3/4 competitors have sufficient data for analysis.",
            "impact": "medium",
    +       "recommendation": "Collect additional competitor information to improve analysis completeness",
          },
        ],
        "missingData": Array [
          "2 fresh competitor snapshots",
        ],

      547 |       const partialDataInfo = (service as any).buildPartialDataInfo(mockSmartCollectionResult);
      548 |
    > 549 |       expect(partialDataInfo).toEqual({
          |                               ^
      550 |         dataCompletenessScore: 65,
      551 |         dataFreshness: 'mixed',
      552 |         availableData: {

      at Object.toEqual (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:549:31)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify no fresh snapshots gap

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:743:48)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify partial competitor coverage gap

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:764:48)

  ‚óè InitialComparativeReportService - Partial Data Integration ‚Ä∫ data gap identification scenarios ‚Ä∫ should identify overall data quality gap for very low scores

    TypeError: Cannot read properties of undefined (reading 'available')

      915 |       dataFreshness: smartCollectionResult.dataFreshness,
      916 |       availableData: {
    > 917 |         hasProductData: smartCollectionResult.productData.available,
          |                                                           ^
      918 |         hasCompetitorData: smartCollectionResult.competitorData.availableCompetitors > 0,
      919 |         hasSnapshots: smartCollectionResult.competitorData.freshSnapshots > 0,
      920 |         competitorCount: smartCollectionResult.competitorData.totalCompetitors,

      at InitialComparativeReportService.available [as buildPartialDataInfo] (src/services/reports/initialComparativeReportService.ts:917:59)
      at Object.buildPartialDataInfo (src/services/reports/__tests__/initialComparativeReportService.partialData.test.ts:785:48)

FAIL src/__tests__/integration/observabilityIntegration.test.ts
  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should emit structured logs for immediate report generation

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should include correlation IDs across service calls

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Logging Standardization ‚Ä∫ should log security events appropriately

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should emit comprehensive metrics for report generation lifecycle

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should track snapshot capture metrics accurately

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Metrics Collection ‚Ä∫ should monitor queue and resource utilization

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Error Tracking Integration ‚Ä∫ should capture and contextualize report generation errors

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Error Tracking Integration ‚Ä∫ should track error patterns and recovery

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Performance Monitoring Integration ‚Ä∫ should track operation latencies and throughput

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Performance Monitoring Integration ‚Ä∫ should monitor resource utilization patterns

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Business Event Tracking ‚Ä∫ should track business metrics and user interactions

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Business Event Tracking ‚Ä∫ should track configuration and feature flag changes

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Alerting Integration ‚Ä∫ should trigger alerts for critical failures

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Alerting Integration ‚Ä∫ should track SLA violations and performance degradation

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ Dashboard Integration Validation ‚Ä∫ should provide all necessary metrics for dashboards

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

  ‚óè Phase 5.4: Observability Integration Tests ‚Ä∫ End-to-End Observability Validation ‚Ä∫ should validate complete observability stack integration

    RangeError: Maximum call stack size exceeded
        at [Symbol.hasInstance] (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:277:22
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)


  ‚óè Test suite failed to run

    RangeError: Maximum call stack size exceeded
        at Array.at (<anonymous>)

      712 |     jest.spyOn(logger, 'info').mockImplementation((message: string, metadata?: any) => {
      713 |       capturedLogs.push({ level: 'info', message, metadata });
    > 714 |       return originalLogger.call(logger, message, metadata);
          |                             ^
      715 |     });
      716 |
      717 |     const originalLoggerWarn = logger.warn;

      at ModuleMocker._ensureMockState (node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:208:36)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)
      at Object.call (src/__tests__/integration/observabilityIntegration.test.ts:714:29)

FAIL src/__tests__/unit/services/comparativeReportService.test.ts
  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should generate comprehensive report with all sections

    expect(received).toContain(expected) // indexOf

    Expected substring: "Comprehensive"
    Received string:    "Test Product - Competitive Analysis"

      246 |       expect(result.report.id).toBeDefined();
      247 |       expect(result.report.title).toContain('Test Product');
    > 248 |       expect(result.report.title).toContain('Comprehensive');
          |                                   ^
      249 |       expect(result.report.projectId).toBe(sampleProduct.projectId);
      250 |       expect(result.report.productId).toBe(sampleProduct.id);
      251 |       expect(result.report.analysisId).toBe(sampleAnalysis.id);

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:248:35)

  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should use default template when none specified

    expect(received).toBe(expected) // Object.is equality

    Expected: "markdown"
    Received: undefined

      353 |
      354 |       expect(result.report.sections).toHaveLength(6); // Default comprehensive template
    > 355 |       expect(result.report.format).toBe('markdown'); // Default format
          |                                    ^
      356 |     });
      357 |
      358 |     it('should throw error for invalid template', async () => {

      at Object.toBe (src/__tests__/unit/services/comparativeReportService.test.ts:355:36)

  ‚óè ComparativeReportService ‚Ä∫ generateComparativeReport ‚Ä∫ should handle section generation errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cost": 0.0015, "errors": [], "generationTime": 1000, "report": {"analysisId": "mock-analysis-id", "competitiveIntelligence": {"competitiveAdvantages": ["AI-first approach"], "marketPosition": "competitive", "opportunities": ["Enterprise market"]}, "description": "Mock report description", "executiveSummary": "Mock executive summary", "format": undefined, "id": "mock-report-id", "keyFindings": ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"], "keyOpportunities": ["Mock opportunity 1"], "keyThreats": ["Mock threat 1"], "metadata": {"analysisMethod": "ai_powered", "competitorCount": 1, "confidenceScore": 92, "dataQuality": "high", "generatedAt": "2025-07-10T11:37:51.134Z", "productName": "Test Product", "template": "comprehensive", "version": "1.0"}, "productId": "mock-product-id", "projectId": "mock-project-id", "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 3, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "User experience comparison analysis", "id": "ux-comparison", "order": 4, "title": "User Experience", "type": "ux_comparison"}, {"content": "Customer targeting analysis", "id": "customer-targeting", "order": 5, "title": "Customer Targeting", "type": "customer_targeting"}, {"content": "Actionable recommendations based on analysis", "id": "recommendations", "order": 6, "title": "Strategic Recommendations", "type": "recommendations"}], "status": "completed", "strategicRecommendations": {"immediate": ["Improve mobile"], "longTerm": ["Expand to new markets"], "priorityScore": 88, "shortTerm": ["Add enterprise features"]}, "title": "Test Product - Competitive Analysis"}, "tokensUsed": 500, "warnings": []}

      376 |       } as unknown as ComparativeAnalysis;
      377 |
    > 378 |       await expect(service.generateComparativeReport(
          |                   ^
      379 |         incompleteAnalysis,
      380 |         sampleProduct,
      381 |         sampleProductSnapshot

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/__tests__/unit/services/comparativeReportService.test.ts:378:19)

  ‚óè ComparativeReportService ‚Ä∫ generateEnhancedReportContent ‚Ä∫ should generate enhanced content using AI

    TypeError: service.generateEnhancedReportContent is not a function

      403 |       mockBedrockService.generateCompletion.mockResolvedValue(mockEnhancedContent);
      404 |
    > 405 |       const result = await service.generateEnhancedReportContent(
          |                                    ^
      406 |         'test-analysis-id',
      407 |         REPORT_TEMPLATES.COMPREHENSIVE,
      408 |         {

      at Object.generateEnhancedReportContent (src/__tests__/unit/services/comparativeReportService.test.ts:405:36)

  ‚óè ComparativeReportService ‚Ä∫ generateEnhancedReportContent ‚Ä∫ should handle AI service errors

    TypeError: service.generateEnhancedReportContent is not a function

      431 |       mockBedrockService.generateCompletion.mockRejectedValue(new Error('AI service unavailable'));
      432 |
    > 433 |       await expect(service.generateEnhancedReportContent(
          |                            ^
      434 |         'test-analysis-id',
      435 |         REPORT_TEMPLATES.COMPREHENSIVE
      436 |       )).rejects.toThrow(ReportGenerationError);

      at Object.generateEnhancedReportContent (src/__tests__/unit/services/comparativeReportService.test.ts:433:28)

  ‚óè ComparativeReportService ‚Ä∫ getAvailableTemplates ‚Ä∫ should return all available templates

    expect(received).toBe(expected) // Object.is equality

    Expected: "Comprehensive Comparative Analysis"
    Received: "Comprehensive Analysis"

      453 |       const comprehensiveTemplate = templates.find(t => t.id === REPORT_TEMPLATES.COMPREHENSIVE);
      454 |       expect(comprehensiveTemplate).toBeDefined();
    > 455 |       expect(comprehensiveTemplate!.name).toBe('Comprehensive Comparative Analysis');
          |                                           ^
      456 |       expect(comprehensiveTemplate!.sectionTemplates).toHaveLength(6);
      457 |       expect(comprehensiveTemplate!.focusAreas).toEqual(['features', 'positioning', 'user_experience', 'customer_targeting']);
      458 |     });

      at Object.toBe (src/__tests__/unit/services/comparativeReportService.test.ts:455:43)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing detailed analysis

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: detailed"

    Received function did not throw

      481 |
      482 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 483 |         .toThrow('Analysis missing required field for reporting: detailed');
          |          ^
      484 |     });
      485 |
      486 |     it('should throw error for missing recommendations', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:483:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing recommendations

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: recommendations"

    Received function did not throw

      491 |
      492 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 493 |         .toThrow('Analysis missing required field for reporting: recommendations');
          |          ^
      494 |     });
      495 |
      496 |     it('should throw error for missing metadata', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:493:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should throw error for missing metadata

    expect(received).toThrow(expected)

    Expected substring: "Analysis missing required field for reporting: metadata"

    Received function did not throw

      501 |
      502 |       expect(() => service.validateAnalysisForReporting(incompleteAnalysis))
    > 503 |         .toThrow('Analysis missing required field for reporting: metadata');
          |          ^
      504 |     });
      505 |
      506 |     it('should warn for low confidence analysis but not throw', () => {

      at Object.toThrow (src/__tests__/unit/services/comparativeReportService.test.ts:503:10)

  ‚óè ComparativeReportService ‚Ä∫ validateAnalysisForReporting ‚Ä∫ should warn for low confidence analysis but not throw

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Analysis confidence score is low for reporting", ObjectContaining {"analysisId": "test_analysis_123", "confidenceScore": 40}

    Number of calls: 0

      516 |
      517 |       expect(() => service.validateAnalysisForReporting(lowConfidenceAnalysis)).not.toThrow();
    > 518 |       expect(loggerSpy).toHaveBeenCalledWith(
          |                         ^
      519 |         'Analysis confidence score is low for reporting',
      520 |         expect.objectContaining({
      521 |           analysisId: sampleAnalysis.id,

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/comparativeReportService.test.ts:518:25)

  ‚óè ComparativeReportService ‚Ä∫ template content generation ‚Ä∫ should populate template variables correctly

    expect(received).toContain(expected) // indexOf

    Expected substring: "Test Product"
    Received string:    "Comprehensive executive summary of competitive analysis"

      538 |
      539 |       const executiveSummary = result.report.sections.find(s => s.type === 'executive_summary');
    > 540 |       expect(executiveSummary?.content).toContain('Test Product');
          |                                         ^
      541 |       expect(executiveSummary?.content).toContain('competitive');
      542 |       expect(executiveSummary?.content).toContain('85');
      543 |       expect(executiveSummary?.content).toContain('low');

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:540:41)

  ‚óè ComparativeReportService ‚Ä∫ report content structure ‚Ä∫ should include executive summary in keyFindings

    expect(received).toContain(expected) // indexOf

    Expected value: "Strength: Strong AI capabilities"
    Received array: ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"]

      585 |       );
      586 |
    > 587 |       expect(result.report.keyFindings).toContain('Strength: Strong AI capabilities');
          |                                         ^
      588 |       expect(result.report.keyFindings).toContain('Weakness: Limited market presence');
      589 |       expect(result.report.keyFindings).toContain('Market Position: competitive');
      590 |       expect(result.report.keyFindings).toContain('Opportunity Score: 85/100');

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:587:41)

  ‚óè ComparativeReportService ‚Ä∫ report content structure ‚Ä∫ should extract key threats correctly

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      598 |       );
      599 |
    > 600 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Overall threat level: low');
          |                                                                ^
      601 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Advanced API features');
      602 |       expect(result.report.competitiveIntelligence.keyThreats).toContain('Mobile optimization');
      603 |     });

      at Object.toContain (src/__tests__/unit/services/comparativeReportService.test.ts:600:64)

FAIL src/__tests__/integration/awsCredentialIntegration.test.ts
  ‚óè AWS Credential Integration ‚Ä∫ Bedrock Service Integration ‚Ä∫ should create Bedrock service with environment fallback

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 1

      247 |       // Ensure no stored credentials
      248 |       const profiles = await awsCredentialService.listCredentialProfiles();
    > 249 |       expect(profiles.length).toBe(0);
          |                               ^
      250 |
      251 |       // Set environment variables
      252 |       process.env.AWS_ACCESS_KEY_ID = 'env-access-key';

      at Object.toBe (src/__tests__/integration/awsCredentialIntegration.test.ts:249:31)

  ‚óè AWS Credential Integration ‚Ä∫ Bedrock Service Integration ‚Ä∫ should create Bedrock service factory method with stored credentials

    TypeError: _bedrockservice.BedrockService.createWithStoredCredentials is not a function

      271 |
      272 |       // This should work without throwing
    > 273 |       const service = await BedrockService.createWithStoredCredentials('anthropic');
          |                                            ^
      274 |       expect(service).toBeInstanceOf(BedrockService);
      275 |     });
      276 |   });

      at Object.createWithStoredCredentials (src/__tests__/integration/awsCredentialIntegration.test.ts:273:44)

  ‚óè AWS Credential Integration ‚Ä∫ Analysis Service Integration ‚Ä∫ should initialize ComparativeAnalysisService with stored credentials

    expect(received).toBeInstanceOf(expected)

    Expected constructor: mockConstructor
    Received constructor: Object

      285 |       
      286 |       // This tests that the service can be created without throwing
    > 287 |       expect(analysisService).toBeInstanceOf(ComparativeAnalysisService);
          |                               ^
      288 |
      289 |       // Test configuration update (should trigger credential refresh)
      290 |       analysisService.updateAnalysisConfiguration({

      at Object.toBeInstanceOf (src/__tests__/integration/awsCredentialIntegration.test.ts:287:31)

  ‚óè AWS Credential Integration ‚Ä∫ Multiple Profile Support ‚Ä∫ should handle multiple credential profiles

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 1

      314 |       // List profiles
      315 |       const profiles = await awsCredentialService.listCredentialProfiles();
    > 316 |       expect(profiles.length).toBe(2);
          |                               ^
      317 |
      318 |       // Get credentials with preferred profile
      319 |       const credentials1 = await credentialProvider.getCredentials({

      at Object.toBe (src/__tests__/integration/awsCredentialIntegration.test.ts:316:31)

  ‚óè AWS Credential Integration ‚Ä∫ Multiple Profile Support ‚Ä∫ should use first valid profile when no preference specified

    expect(received).toMatchObject(expected)

    - Expected  - 2
    + Received  + 2

      Object {
    -   "accessKeyId": "AKIAZJC8IBPZHRQ",
    -   "secretAccessKey": "test-secret-2-uzob5drd56",
    +   "accessKeyId": "AKIAZLND9EFAF1",
    +   "secretAccessKey": "test-secret-8y3l642pi2f",
      }

      364 |       // Should use the valid profile
      365 |       const credentials = await credentialProvider.getCredentials();
    > 366 |       expect(credentials).toMatchObject({
          |                           ^
      367 |         accessKeyId: secondTestCredentials.accessKeyId,
      368 |         secretAccessKey: secondTestCredentials.secretAccessKey
      369 |       });

      at Object.toMatchObject (src/__tests__/integration/awsCredentialIntegration.test.ts:366:27)

FAIL src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts
  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should extract basic project information from structured input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      15 |       const result = enhancedProjectExtractor.extractProjectData(message);
      16 |
    > 17 |       expect(result.success).toBe(true);
         |                              ^
      18 |       expect(result.data).toEqual({
      19 |         userEmail: 'user@company.com',
      20 |         frequency: 'Weekly',

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:17:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should handle missing product website gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      39 |       const result = enhancedProjectExtractor.extractProjectData(message);
      40 |
    > 41 |       expect(result.success).toBe(true);
         |                              ^
      42 |       expect(result.data?.productWebsite).toBeUndefined();
      43 |       expect(result.suggestions).toContain('Consider including your product website URL for better analysis');
      44 |     });

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:41:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should fail with insufficient information

    expect(received).toContain(expected) // indexOf

    Expected value: "Project name too short or missing in third line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      53 |
      54 |       expect(result.success).toBe(false);
    > 55 |       expect(result.errors).toContain('Project name too short or missing in third line');
         |                             ^
      56 |     });
      57 |
      58 |     it('should validate email format', () => {

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:55:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should validate email format

    expect(received).toContain(expected) // indexOf

    Expected value: "Invalid email address format in first line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      66 |
      67 |       expect(result.success).toBe(false);
    > 68 |       expect(result.errors).toContain('Invalid email address format in first line');
         |                             ^
      69 |     });
      70 |
      71 |     it('should validate frequency format', () => {

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:68:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Structured Input (Backward Compatible) ‚Ä∫ should validate frequency format

    expect(received).toContain(expected) // indexOf

    Expected value: "Invalid frequency in second line"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      79 |
      80 |       expect(result.success).toBe(false);
    > 81 |       expect(result.errors).toContain('Invalid frequency in second line');
         |                             ^
      82 |     });
      83 |   });
      84 |

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:81:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should extract information from natural language input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

       96 |       const result = enhancedProjectExtractor.extractProjectData(message);
       97 |
    >  98 |       expect(result.success).toBe(true);
          |                              ^
       99 |       expect(result.data?.userEmail).toBe('john@startup.com');
      100 |       expect(result.data?.frequency).toBe('weekly');
      101 |       expect(result.data?.projectName).toBe('Startup Competitive Analysis');

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:98:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should handle mixed format input

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      115 |       const result = enhancedProjectExtractor.extractProjectData(message);
      116 |
    > 117 |       expect(result.success).toBe(true);
          |                              ^
      118 |       expect(result.data?.userEmail).toBe('sarah@foodtech.com');
      119 |       expect(result.data?.frequency).toBe('monthly');
      120 |       expect(result.data?.projectName).toBe('Food Delivery Analysis');

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:117:30)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Unstructured Input (Intelligent Parsing) ‚Ä∫ should fail gracefully with missing required information

    expect(received).toContain(expected) // indexOf

    Expected value: "Email address not found in message"
    Received array: ["Failed to parse project information: this.extractFromLineByLineFormat is not a function"]

      131 |
      132 |       expect(result.success).toBe(false);
    > 133 |       expect(result.errors).toContain('Email address not found in message');
          |                             ^
      134 |       expect(result.errors).toContain('Report frequency not specified');
      135 |       expect(result.errors).toContain('Project name not identified');
      136 |     });

      at Object.toContain (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:133:29)

  ‚óè EnhancedProjectExtractor ‚Ä∫ URL Validation ‚Ä∫ should validate and clean URLs correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      157 |
      158 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 159 |         expect(result.success).toBe(true);
          |                                ^
      160 |         expect(result.data?.productWebsite).toBe(expected);
      161 |       });
      162 |     });

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:159:32)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:150:17)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Error Messages ‚Ä∫ should return empty string for successful extractions

    expect(received).toBe(expected) // Object.is equality

    Expected: ""
    Received: "‚ö†Ô∏è **Missing Required Information**¬∑
    **Issues Found:**
    1. Failed to parse project information: this.extractFromLineByLineFormat is not a function¬∑
    **Please provide:**
    ‚Ä¢ Please provide your information in this format:
    ‚Ä¢ 1. Email address
    ‚Ä¢ 2. Report frequency (Weekly/Monthly)
    ‚Ä¢ 3. Project name
    ‚Ä¢ 4. Product website URL
    ‚Ä¢ 5. Product name (optional)
    ‚Ä¢ 6. Industry (optional)¬∑
    **ÔøΩÔøΩ Tip:** You can provide information in any order or format. I'll extract what I need!"

      213 |       const errorMessage = enhancedProjectExtractor.createActionableErrorMessage(result);
      214 |
    > 215 |       expect(errorMessage).toBe('');
          |                            ^
      216 |     });
      217 |   });
      218 |

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:215:28)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Product Name Extraction ‚Ä∫ should extract product name from project name patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: "Good Chop"
    Received: undefined

      272 |
      273 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 274 |         expect(result.data?.productName).toBe(expected);
          |                                          ^
      275 |       });
      276 |     });
      277 |

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:274:42)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:266:17)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Product Name Extraction ‚Ä∫ should prioritize explicit product declarations

    expect(received).toBe(expected) // Object.is equality

    Expected: "Specific Product Name"
    Received: undefined

      285 |
      286 |       const result = enhancedProjectExtractor.extractProjectData(message);
    > 287 |       expect(result.data?.productName).toBe('Specific Product Name');
          |                                        ^
      288 |     });
      289 |   });
      290 |

      at Object.toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:287:40)

  ‚óè EnhancedProjectExtractor ‚Ä∫ Industry Detection ‚Ä∫ should detect industry from various patterns

    expect(received).toBe(expected) // Object.is equality

    Expected: "Food Technology"
    Received: undefined

      306 |
      307 |         const result = enhancedProjectExtractor.extractProjectData(message);
    > 308 |         expect(result.data?.industry).toBe(expected);
          |                                       ^
      309 |       });
      310 |     });
      311 |   });

      at toBe (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:308:39)
          at Array.forEach (<anonymous>)
      at Object.forEach (src/__tests__/unit/lib/chat/enhancedProjectExtractor.test.ts:299:17)

FAIL src/services/reports/__tests__/smartDataCollectionIntegration.test.ts
  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should use SmartDataCollectionService instead of basic capture methods

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      165 |         // Expected since we haven't mocked all the dependencies fully
      166 |         // The important thing is that smart data collection was called
    > 167 |         expect(collectProjectDataSpy).toHaveBeenCalled();
          |                                       ^
      168 |       }
      169 |     });
      170 |

      at Object.toHaveBeenCalled (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:167:39)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should handle smart data collection with priority fallbacks

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      228 |       } catch (error) {
      229 |         // Expected due to incomplete mocking
    > 230 |         expect(collectProjectDataSpy).toHaveBeenCalled();
          |                                       ^
      231 |       }
      232 |     });
      233 |

      at Object.toHaveBeenCalled (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:230:39)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Smart Data Collection Priority System ‚Ä∫ should fail gracefully when smart data collection fails

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"analysisId": "mock-analysis-id", "competitiveIntelligence": {"competitiveAdvantages": ["AI-first approach"], "marketPosition": "competitive", "opportunities": ["Enterprise market"]}, "description": "Mock report description - Generated immediately upon project creation with 76% data completeness.", "executiveSummary": "Mock executive summary", "format": "markdown", "id": "mock-report-id", "keyFindings": ["Strength: Strong AI", "Weakness: High price", "Market Position: competitive", "Opportunity Score: 85/100"], "keyOpportunities": ["Mock opportunity 1"], "keyThreats": ["Mock threat 1"], "metadata": {"analysisMethod": "ai_powered", "competitorCount": 1, "confidenceScore": 92, "dataQuality": "high", "generatedAt": "2025-07-10T11:37:51.462Z", "productName": "Test Product", "reportVersion": "1.0-initial", "template": "comprehensive", "version": "1.0"}, "productId": "mock-product-id", "projectId": "mock-project-id", "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 3, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "User experience comparison analysis", "id": "ux-comparison", "order": 4, "title": "User Experience", "type": "ux_comparison"}, {"content": "Customer targeting analysis", "id": "customer-targeting", "order": 5, "title": "Customer Targeting", "type": "customer_targeting"}, {"content": "Actionable recommendations based on analysis", "id": "recommendations", "order": 6, "title": "Strategic Recommendations", "type": "recommendations"}], "status": "completed", "strategicRecommendations": {"immediate": ["Improve mobile"], "longTerm": ["Expand to new markets"], "priorityScore": 88, "shortTerm": ["Add enterprise features"]}, "title": "Test Product - Competitive Analysis (Initial Report)"}

      272 |         .mockResolvedValue(mockFailedResult as any);
      273 |
    > 274 |       await expect(
          |             ^
      275 |         initialReportService.generateInitialComparativeReport('project-1')
      276 |       ).rejects.toThrow('Smart data collection failed');
      277 |

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.expect (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:274:13)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Data Source Priority Verification ‚Ä∫ should prioritize fresh snapshots over existing data

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"requireFreshSnapshots": true}

    Number of calls: 0

      292 |       }
      293 |
    > 294 |       expect(spy).toHaveBeenCalledWith('project-1', 
          |                   ^
      295 |         expect.objectContaining({
      296 |           requireFreshSnapshots: true
      297 |         })

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:294:19)

  ‚óè Smart Data Collection Integration - Phase 2.1 ‚Ä∫ Data Source Priority Verification ‚Ä∫ should respect timeout allocation for data collection vs analysis

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "project-1", ObjectContaining {"maxCaptureTime": 75000}

    Number of calls: 0

      310 |       }
      311 |
    > 312 |       expect(spy).toHaveBeenCalledWith('project-1',
          |                   ^
      313 |         expect.objectContaining({
      314 |           maxCaptureTime: 75000 // 90000 - 15000 reserved for analysis
      315 |         })

      at Object.toHaveBeenCalledWith (src/services/reports/__tests__/smartDataCollectionIntegration.test.ts:312:19)

FAIL src/services/__tests__/configurationManagementService.test.ts
  ‚óè ConfigurationManagementService ‚Ä∫ Configuration Updates ‚Ä∫ should successfully update valid configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      113 |       });
      114 |
    > 115 |       expect(result.success).toBe(true);
          |                              ^
      116 |       expect(result.updatedFields).toEqual(['SNAPSHOT_CAPTURE_TIMEOUT', 'MAX_CONCURRENT_SNAPSHOTS_PER_PROJECT']);
      117 |       expect(result.rollbackInfo).toBeDefined();
      118 |       expect(result.updatedBy).toBe('test-user');

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:115:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Configuration Updates ‚Ä∫ should create audit log entries for updates

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      170 |
      171 |       const auditLog = configService.getAuditLog(10);
    > 172 |       expect(auditLog.length).toBeGreaterThan(0);
          |                               ^
      173 |
      174 |       const latestEntry = auditLog[0];
      175 |       expect(latestEntry.action).toBe('update');

      at Object.toBeGreaterThan (src/services/__tests__/configurationManagementService.test.ts:172:31)

  ‚óè ConfigurationManagementService ‚Ä∫ Audit Log ‚Ä∫ should maintain audit log of all changes

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

      291 |
      292 |       const auditLog = configService.getAuditLog(10);
    > 293 |       expect(auditLog.length).toBe(2);
          |                               ^
      294 |
      295 |       // Should be sorted by timestamp (newest first)
      296 |       expect(auditLog[0].updatedBy).toBe('user2');

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:293:31)

  ‚óè ConfigurationManagementService ‚Ä∫ Audit Log ‚Ä∫ should respect audit log limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 3
    Received: 0

      309 |
      310 |       const limitedLog = configService.getAuditLog(3);
    > 311 |       expect(limitedLog.length).toBe(3);
          |                                 ^
      312 |     });
      313 |   });
      314 |

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:311:33)

  ‚óè ConfigurationManagementService ‚Ä∫ Rollback Functionality ‚Ä∫ should provide rollback tokens for updates

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      325 |       });
      326 |
    > 327 |       expect(result.success).toBe(true);
          |                              ^
      328 |       expect(result.rollbackInfo).toBeDefined();
      329 |       expect(result.rollbackInfo!.rollbackToken).toBeDefined();
      330 |       expect(result.rollbackInfo!.previousValues).toEqual({

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:327:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Error Handling ‚Ä∫ should handle missing configuration fields gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      384 |       });
      385 |
    > 386 |       expect(result.success).toBe(true);
          |                              ^
      387 |       expect(result.updatedFields).toEqual([]); // No valid fields updated
      388 |     });
      389 |

      at Object.toBe (src/services/__tests__/configurationManagementService.test.ts:386:30)

  ‚óè ConfigurationManagementService ‚Ä∫ Error Handling ‚Ä∫ should handle internal errors gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Internal error"
    Received string:    "HOURLY_SNAPSHOT_LIMIT: Hourly limit should not exceed daily limit when extrapolated"

      399 |       expect(result.success).toBe(false);
      400 |       expect(result.validationErrors).toBeDefined();
    > 401 |       expect(result.validationErrors![0]).toContain('Internal error');
          |                                           ^
      402 |     });
      403 |   });
      404 | }); 

      at Object.toContain (src/services/__tests__/configurationManagementService.test.ts:401:43)

FAIL src/__tests__/performance/cachingStrategy.test.ts
  ‚óè Redis Cache Implementation ‚Ä∫ should initialize Redis client successfully

    expect(received).toHaveBeenCalled()

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function initializeRedisClient]

      104 |   test('should initialize Redis client successfully', async () => {
      105 |     await initializeRedisClient();
    > 106 |     expect(initializeRedisClient).toHaveBeenCalled();
          |                                   ^
      107 |   });
      108 |
      109 |   test('should use withRedisCache correctly', async () => {

      at Object.toHaveBeenCalled (src/__tests__/performance/cachingStrategy.test.ts:106:35)

  ‚óè Redis Cache Integration with API Endpoints ‚Ä∫ should cache competitor list results

    TypeError: _rediscache.withRedisCache.mockImplementation is not a function

      139 |     
      140 |     // Reset withRedisCache mock for each test
    > 141 |     (withRedisCache as jest.Mock).mockImplementation(async (fn, keyPrefix, params) => {
          |                                   ^
      142 |       return fn(params);
      143 |     });
      144 |   });

      at Object.mockImplementation (src/__tests__/performance/cachingStrategy.test.ts:141:35)

  ‚óè Redis Cache Integration with API Endpoints ‚Ä∫ should handle search parameters

    TypeError: _rediscache.withRedisCache.mockImplementation is not a function

      139 |     
      140 |     // Reset withRedisCache mock for each test
    > 141 |     (withRedisCache as jest.Mock).mockImplementation(async (fn, keyPrefix, params) => {
          |                                   ^
      142 |       return fn(params);
      143 |     });
      144 |   });

      at Object.mockImplementation (src/__tests__/performance/cachingStrategy.test.ts:141:35)

FAIL src/services/reports/__tests__/reportQualityService.test.ts
  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should handle missing competitor data

    expect(received).toMatch(expected)

    Expected pattern: /^(poor|critical)$/
    Received string:  "fair"

      234 |
      235 |       expect(assessment.qualityScore.dataCompleteness).toBeLessThan(50);
    > 236 |       expect(assessment.qualityTier).toMatch(/^(poor|critical)$/);
          |                                      ^
      237 |     });
      238 |
      239 |     it('should calculate data freshness correctly', async () => {

      at Object.toMatch (src/services/reports/__tests__/reportQualityService.test.ts:236:38)

  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should calculate data freshness correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      261 |         rec => rec.category === 'freshness'
      262 |       );
    > 263 |       expect(hasFreshnessRec).toBe(true);
          |                               ^
      264 |     });
      265 |
      266 |     it('should generate section-specific confidence indicators', async () => {

      at Object.toBe (src/services/reports/__tests__/reportQualityService.test.ts:263:31)

  ‚óè ReportQualityService ‚Ä∫ assessReportQuality ‚Ä∫ should calculate improvement potential correctly

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 91
    Received:    81

      339 |
      340 |       expect(assessment.improvement.possibleScore).toBeGreaterThanOrEqual(assessment.qualityScore.overall);
    > 341 |       expect(assessment.improvement.potentialScore).toBeGreaterThanOrEqual(assessment.improvement.possibleScore);
          |                                                     ^
      342 |       expect(assessment.improvement.potentialScore).toBeLessThanOrEqual(100);
      343 |       
      344 |       // Quick wins should be immediate, free improvements

      at Object.toBeGreaterThanOrEqual (src/services/reports/__tests__/reportQualityService.test.ts:341:53)

  ‚óè ReportQualityService ‚Ä∫ quality tier determination ‚Ä∫ should assign critical tier for very low scores

    expect(received).toBe(expected) // Object.is equality

    Expected: "critical"
    Received: "poor"

      445 |
      446 |       expect(assessment.qualityScore.overall).toBeLessThan(40);
    > 447 |       expect(assessment.qualityTier).toBe('critical');
          |                                      ^
      448 |     });
      449 |   });
      450 |

      at Object.toBe (src/services/reports/__tests__/reportQualityService.test.ts:447:38)

  ‚óè ReportQualityService ‚Ä∫ recommendation generation ‚Ä∫ should generate section-specific recommendations

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

      560 |         rec => rec.category === 'coverage'
      561 |       );
    > 562 |       expect(coverageRecs.length).toBeGreaterThan(0);
          |                                   ^
      563 |     });
      564 |   });
      565 |

      at Object.toBeGreaterThan (src/services/reports/__tests__/reportQualityService.test.ts:562:35)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle reports with no sections

    expect(received).toBeLessThan(expected)

    Expected: < 50
    Received:   77

      579 |       );
      580 |
    > 581 |       expect(assessment.qualityScore.overall).toBeLessThan(50);
          |                                               ^
      582 |       expect(assessment.qualityTier).toMatch(/^(poor|critical)$/);
      583 |     });
      584 |

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:581:47)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle missing product information gracefully

    expect(received).toBeLessThan(expected)

    Expected: < 80
    Received:   92

      598 |       );
      599 |
    > 600 |       expect(assessment.qualityScore.dataCompleteness).toBeLessThan(80);
          |                                                        ^
      601 |     });
      602 |
      603 |     it('should handle undefined competitor data', async () => {

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:600:56)

  ‚óè ReportQualityService ‚Ä∫ edge cases and error handling ‚Ä∫ should handle very old reports correctly

    expect(received).toBeLessThan(expected)

    Expected: < 30
    Received:   63

      631 |       );
      632 |
    > 633 |       expect(assessment.qualityScore.dataFreshness).toBeLessThan(30);
          |                                                     ^
      634 |     });
      635 |   });
      636 |

      at Object.toBeLessThan (src/services/reports/__tests__/reportQualityService.test.ts:633:53)

FAIL src/services/reports/__tests__/initialComparativeReportService.test.ts
  ‚óè InitialComparativeReportService ‚Ä∫ Method Signatures ‚Ä∫ generateInitialComparativeReport should have correct signature

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 1

      107 |       const method = service.generateInitialComparativeReport;
      108 |       expect(method).toBeDefined();
    > 109 |       expect(method.length).toBe(2); // projectId and options parameters
          |                             ^
      110 |     });
      111 |
      112 |     it('validateProjectReadiness should have correct signature', () => {

      at Object.toBe (src/services/reports/__tests__/initialComparativeReportService.test.ts:109:29)

FAIL src/__tests__/unit/analysis.test.ts
  ‚óè ContentAnalyzer ‚Ä∫ Constructor ‚Ä∫ should initialize with AWS Bedrock client

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
        "credentials": Object {
          "accessKeyId": "test-key",
          "secretAccessKey": "test-secret",
    +     "sessionToken": "IQoJb3JpZ2luX2VjELT//////////wEaCWV1LXdlc3QtMSJGMEQCIH2vc4TTzp9Hko9WHQSZQnTDLPgJ/iKw3O9JXYUxp0ejAiB4KPCSiQvy+S2vuRAZEmS04dMN0aSt3hPZQOKPIX3XkSrbAwi9//////////8BEAAaDDk1MTcxOTE3NTUwNiIMDvmACfLXDZ3248R5Kq8DYOZY2uUYfw5yJZ69LegV7pkZZDHN+dBhbuDF648P/IIivUD8bazX7dEm41gP8K4Cz22QOpsPC9aYGtpi4lHVx+wK7smp7VSHFyJUTZqrB+KnaubSkKQwAh9TWMwb/rxGbtVTD9pcKJaCadE2rtd8nqBbIJ43ej8m+kTpTzXVstrlPR4kzKi6ZpMyRFfW3SNd3VfCDMysqPpzICUqeR3IVkwtOoot3hOKwFtXFdCy1tIJuxhAZKVSj5jZYPVG77ug9sQJqdU7qtRqRgsfvp5VFQHSgBfiUNcsZKkuhrfhQBzR+rMXtcvvkOhESphttSsVj7mK25aGg1ZJq9/teDeLeRrYTZQs38FlDjCsin492oSIyFvdNjQ6j57wYVEieMsT//8rEcBR5HD0EjMXxYNIgDVRDtPjilHEvBI/hSdE43qF8Ctfkt3OdrqxCP1LjlUIfH737r77VUspwkQYb+ilOBnnzJ/oiX9hu8s2+D/7jVTjEr7jHJB3k9b22Om4guPbCz36etU6Vx3LModx3g+wTuZd8ZkPbtKgGf7F/YzPiUT90bO7pxq0w6Pf2DuwsDgwhcu+wwY6pwEUQc8ysaNDf3kEiR9NXA1YS24wxCXXMcOtMK9apymH2PUuxhX09RvCwEptfmAZoRIy2SerYC6dJoc+Ve3nga9ZxUkJOpVl3IDbYbYDwr481VG29XIf1UIou5RtDEWFMcuGKbZYlaQ6Fj0qNjpgEXaJ63iEt7dWR6Xmxwvrhia0VekQ8wolk6tjRJzxWfeTtbQXV5IiL6uarG1tagFr1MQNvAjw/DmpHQ==",
        },
        "region": "us-east-1",
      },

    Number of calls: 1

      41 |   describe('Constructor', () => {
      42 |     it('should initialize with AWS Bedrock client', () => {
    > 43 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith({
         |                                    ^
      44 |         region: 'us-east-1',
      45 |         credentials: {
      46 |           accessKeyId: 'test-key',

      at Object.toHaveBeenCalledWith (src/__tests__/unit/analysis.test.ts:43:36)

FAIL src/__tests__/e2e/workflowValidation.test.ts
  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should extract valid project data from chat message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      35 |       const extractionResult = projectExtractor.extractProjectData(chatMessage);
      36 |       
    > 37 |       expect(extractionResult.success).toBe(true);
         |                                        ^
      38 |       expect(extractionResult.data).toBeDefined();
      39 |       expect(extractionResult.data!.userEmail).toBe('test-workflow@example.com');
      40 |       expect(extractionResult.data!.projectName).toBe('TestCorp Competitive Analysis');

      at Object.toBe (src/__tests__/e2e/workflowValidation.test.ts:37:40)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should generate comprehensive UX-enhanced report

    expect(received).toBe(expected) // Object.is equality

    Expected: "TestCorp Platform"
    Received: "Mock Product"

      319 |
      320 |       // Verify report metadata
    > 321 |       expect(reportResult.report.metadata.productName).toBe('TestCorp Platform');
          |                                                        ^
      322 |       expect(reportResult.report.metadata.competitorCount).toBe(2);
      323 |       const uxConfidenceEntry = reportResult.report.keyFindings.find(finding => 
      324 |         finding.includes('UX Analysis Confidence:')

      at Object.toBe (src/__tests__/e2e/workflowValidation.test.ts:321:56)

FAIL src/services/reports/__tests__/partialDataReportGenerator.test.ts
  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should clearly indicate data gaps and freshness in report

    expect(received).toContain(expected) // indexOf

    Expected substring: "Overall Completeness Score: 45%"
    Received string:    "# Data Completeness & Limitations¬∑
    ## Report Data Quality
    **Overall Completeness Score:** 45%¬∑¬∑
    **Data Freshness:** existing¬∑¬∑
    **Quality Tier:** enhanced¬∑
    ## Available Data Sources
    - **Product Information:** ‚úÖ Complete
    - **Competitor Data:** ‚úÖ Available
    - **Fresh Snapshots:** 0/3 captured
    - **Total Competitors:** 3¬∑
    ## Moderate Data Gaps (Medium Impact)
    - **Data Freshness:** Using existing snapshots instead of fresh captures¬∑
    ## Improving Report Quality¬∑
    To enhance the accuracy and completeness of future reports:¬∑
    - Schedule fresh competitor snapshot capture¬∑
    ## Data Collection Status
    This report was generated with the best available data at the time of creation. For the most current competitive intelligence, consider scheduling regular competitor data collection and snapshot updates.
    "

      280 |       const dataGapSection = report.sections.find(s => s.type === 'data_gaps');
      281 |       expect(dataGapSection).toBeDefined();
    > 282 |       expect(dataGapSection!.content).toContain('Overall Completeness Score: 45%');
          |                                       ^
      283 |       expect(dataGapSection!.content).toContain('Data Freshness: existing');
      284 |       expect(dataGapSection!.content).toContain('Fresh Snapshots: 0/3 captured');
      285 |       expect(dataGapSection!.content).toContain('Moderate Data Gaps (Medium Impact)');

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:282:39)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should provide actionable recommendations despite partial data

    expect(received).toContain(expected) // indexOf

    Expected value: "Capture fresh competitor website snapshots for current market intelligence"
    Received array: ["Improve feature X", "Enhance UX"]

      326 |
      327 |       expect(report.strategicRecommendations.immediate).toContain('Improve feature X');
    > 328 |       expect(report.strategicRecommendations.immediate).toContain('Capture fresh competitor website snapshots for current market intelligence');
          |                                                         ^
      329 |       expect(report.strategicRecommendations.shortTerm).toContain('Establish ongoing competitive intelligence process');
      330 |       expect(report.strategicRecommendations.longTerm).toContain('Build comprehensive competitive intelligence capability');
      331 |     });

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:328:57)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should handle mixed fresh and stale data scenarios

    expect(received).toContain(expected) // indexOf

    Expected substring: "Fresh Snapshots: 2/4 captured"
    Received string:    "# Data Completeness & Limitations¬∑
    ## Report Data Quality
    **Overall Completeness Score:** 65%¬∑¬∑
    **Data Freshness:** mixed¬∑¬∑
    **Quality Tier:** enhanced¬∑
    ## Available Data Sources
    - **Product Information:** ‚úÖ Complete
    - **Competitor Data:** ‚úÖ Available
    - **Fresh Snapshots:** 2/4 captured
    - **Total Competitors:** 4¬∑
    ## Moderate Data Gaps (Medium Impact)
    - **Mixed Data Freshness:** 2 competitors have fresh data, 2 have existing data¬∑
    ## Improving Report Quality¬∑
    To enhance the accuracy and completeness of future reports:¬∑
    - Capture fresh snapshots for all competitors¬∑
    ## Data Collection Status
    This report was generated with the best available data at the time of creation. For the most current competitive intelligence, consider scheduling regular competitor data collection and snapshot updates.
    "

      414 |       
      415 |       const dataGapSection = report.sections.find(s => s.type === 'data_gaps');
    > 416 |       expect(dataGapSection!.content).toContain('Fresh Snapshots: 2/4 captured');
          |                                       ^
      417 |       expect(dataGapSection!.content).toContain('Mixed Data Freshness');
      418 |     });
      419 |

      at Object.toContain (src/services/reports/__tests__/partialDataReportGenerator.test.ts:416:39)

  ‚óè PartialDataReportGenerator ‚Ä∫ generatePartialDataReport ‚Ä∫ should create placeholder sections when section generation fails

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      539 |         section.content.includes('Data Completeness: 25%')
      540 |       );
    > 541 |       expect(hasPlaceholderContent).toBe(true);
          |                                     ^
      542 |     });
      543 |   });
      544 |

      at Object.toBe (src/services/reports/__tests__/partialDataReportGenerator.test.ts:541:37)

FAIL src/__tests__/unit/intelligentCachingErrorScenarios.test.ts
  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle Redis connection failures gracefully

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      68 |     
      69 |     // Should log warning but not crash
    > 70 |     expect(logger.warn).toHaveBeenCalled();
         |                         ^
      71 |     
      72 |     // Try to retrieve data (should fallback to database)
      73 |     (prisma.competitor.findUnique as jest.Mock).mockResolvedValue({

      at Object.toHaveBeenCalled (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:70:25)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle database failures with graceful degradation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      100 |     // Should return null instead of crashing
      101 |     expect(result).toBeNull();
    > 102 |     expect(logger.error).toHaveBeenCalled();
          |                          ^
      103 |   });
      104 |   
      105 |   it('should handle corrupted cache data gracefully', async () => {

      at Object.toHaveBeenCalled (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:102:26)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle corrupted cache data gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "comp-1"
    Received: undefined

      133 |     // Assert - Should get data from database fallback
      134 |     expect(result).toBeDefined();
    > 135 |     expect(result?.id).toBe('comp-1');
          |                        ^
      136 |     expect(logger.warn).toHaveBeenCalledWith(
      137 |       expect.stringContaining('corrupted'),
      138 |       expect.any(Error),

      at Object.toBe (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:135:24)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle consecutive cache failures with circuit breaker

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "circuit breaker", Any<Object>

    Number of calls: 0

      172 |     
      173 |     // Assert - Should skip caching due to circuit breaker
    > 174 |     expect(logger.info).toHaveBeenCalledWith(
          |                         ^
      175 |       expect.stringContaining('circuit breaker'),
      176 |       expect.any(Object)
      177 |     );

      at Object.toHaveBeenCalledWith (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:174:25)

  ‚óè IntelligentCachingService Error Scenarios ‚Ä∫ should handle cache eviction errors gracefully

    TypeError: intelligentCachingService.invalidateCompetitorCache is not a function

      192 |     
      193 |     // Act - Try to clear cache for specific competitor
    > 194 |     await intelligentCachingService.invalidateCompetitorCache('comp-1');
          |                                     ^
      195 |     
      196 |     // Assert - Should log error but not crash
      197 |     expect(logger.error).toHaveBeenCalled();

      at Object.invalidateCompetitorCache (src/__tests__/unit/intelligentCachingErrorScenarios.test.ts:194:37)

FAIL src/__tests__/unit/services/bedrock/bedrockService.test.ts
  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with default configuration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": Any<String>}
    Received: called with 0 arguments

    Number of calls: 1

      78 |       const service = new BedrockService();
      79 |
    > 80 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
         |                                    ^
      81 |         expect.objectContaining({
      82 |           region: expect.any(String)
      83 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:80:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with custom configuration

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-west-2"}
    Received: called with 0 arguments

    Number of calls: 1

      94 |       const service = new BedrockService(customConfig);
      95 |
    > 96 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
         |                                    ^
      97 |         expect.objectContaining({
      98 |           region: 'us-west-2'
      99 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:96:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service with credentials when provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-east-1"}
    Received: called with 0 arguments

    Number of calls: 1

      113 |       const service = new BedrockService(configWithCredentials);
      114 |
    > 115 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      116 |         expect.objectContaining({
      117 |           region: 'us-east-1'
      118 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:115:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service without credentials when not provided

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": "us-east-1"}
    Received: called with 0 arguments

    Number of calls: 1

      127 |       const service = new BedrockService(configWithoutCredentials);
      128 |
    > 129 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      130 |         expect.objectContaining({
      131 |           region: 'us-east-1'
      132 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:129:36)

  ‚óè BedrockService ‚Ä∫ constructor ‚Ä∫ should create service for Mistral provider

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"region": Any<String>}
    Received: called with 0 arguments

    Number of calls: 1

      137 |       const service = new BedrockService({}, 'mistral');
      138 |
    > 139 |       expect(BedrockRuntimeClient).toHaveBeenCalledWith(
          |                                    ^
      140 |         expect.objectContaining({
      141 |           region: expect.any(String)
      142 |         })

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/bedrock/bedrockService.test.ts:139:36)

FAIL src/__tests__/integration/completeUserJourneys.test.ts
  ‚óè Complete User Journey Tests ‚Ä∫ Journey 1: Project Creation to Initial Report ‚Ä∫ should complete the full user journey from project creation to initial report generation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      211 |
      212 |       // Full journey complete - all key steps verified
    > 213 |       expect(logger.info).toHaveBeenCalled();
          |                           ^
      214 |     });
      215 |   });
      216 |   

      at Object.toHaveBeenCalled (src/__tests__/integration/completeUserJourneys.test.ts:213:27)

  ‚óè Complete User Journey Tests ‚Ä∫ Journey 2: Error Recovery During Report Generation ‚Ä∫ should handle errors and recover gracefully during report generation

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      324 |       
      325 |       // Journey complete with error recovery
    > 326 |       expect(logger.warn).toHaveBeenCalled();
          |                           ^
      327 |       expect(reportResult.reportId).toBe('report-456');
      328 |     });
      329 |   });

      at Object.toHaveBeenCalled (src/__tests__/integration/completeUserJourneys.test.ts:326:27)

FAIL src/__tests__/e2e/productVsCompetitorWorkflow.test.ts
  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should extract valid project data from chat message

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      35 |       const extractionResult = projectExtractor.extractProjectData(chatMessage);
      36 |       
    > 37 |       expect(extractionResult.success).toBe(true);
         |                                        ^
      38 |       expect(extractionResult.data).toBeDefined();
      39 |       expect(extractionResult.data!.userEmail).toBe('test-workflow@example.com');
      40 |       expect(extractionResult.data!.projectName).toBe('TestCorp Competitive Analysis');

      at Object.toBe (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:37:40)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should generate comprehensive UX-enhanced report

    expect(received).toBe(expected) // Object.is equality

    Expected: "TestCorp Platform"
    Received: "Mock Product"

      302 |
      303 |       // Verify report metadata
    > 304 |       expect(reportResult.report.metadata.productName).toBe('TestCorp Platform');
          |                                                        ^
      305 |       expect(reportResult.report.metadata.competitorCount).toBe(2);
      306 |       expect(reportResult.report.keyFindings).toContain('UX Analysis Confidence:');
      307 |

      at Object.toBe (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:304:56)

  ‚óè Product vs Competitor Workflow E2E ‚Ä∫ Phase 4.1: Complete Workflow Testing ‚Ä∫ should handle error scenarios gracefully

    expect(received).toContain(expected) // indexOf

    Expected substring: "Invalid input"
    Received string:    "fail is not defined"

      350 |       } catch (error) {
      351 |         expect(error).toBeInstanceOf(Error);
    > 352 |         expect(error.message).toContain('Invalid input');
          |                               ^
      353 |       }
      354 |
      355 |       logger.info('Error scenario validation complete');

      at Object.toContain (src/__tests__/e2e/productVsCompetitorWorkflow.test.ts:352:31)

FAIL src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts
  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should generate UX-enhanced report successfully

    expect(received).toHaveLength(expected)

    Expected length: 3
    Received length: 6
    Received array:  [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "In-depth UX comparison and recommendations", "id": "ux-analysis", "order": 3, "title": "User Experience Analysis", "type": "ux_analysis"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 4, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "Actionable UX recommendations based on competitive analysis", "id": "strategic-ux-recommendations", "order": 5, "title": "Strategic UX Recommendations", "type": "recommendations"}, {"content": "Supporting data and methodology", "id": "appendix", "order": 6, "title": "Data Appendix", "type": "appendix"}]

      352 |
      353 |       expect(result).toBeDefined();
    > 354 |       expect(result.report.sections).toHaveLength(3); // Original + 2 UX sections
          |                                      ^
      355 |       expect(result.report.sections[1].title).toBe('User Experience Analysis');
      356 |       expect(result.report.sections[2].title).toBe('Strategic UX Recommendations');
      357 |       expect(result.report.keyFindings).toContain('UX Analysis Confidence: 85%');

      at Object.toHaveLength (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:354:38)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should handle UX analysis with low confidence

    expect(received).toContain(expected) // indexOf

    Expected value: "UX analysis confidence is below 70%"
    Received array: []

      432 |       );
      433 |
    > 434 |       expect(result.warnings).toContain('UX analysis confidence is below 70%');
          |                               ^
      435 |       expect(result.report.keyFindings).toContain('UX Analysis Confidence: 60%');
      436 |     });
      437 |

      at Object.toContain (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:434:31)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should handle UX analysis errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"cost": 0.012, "errors": [], "generationTime": 1200, "report": {"description": "Mock UX report description", "executiveSummary": "Mock UX summary", "id": "mock-ux-report-id", "keyFindings": ["UX finding 1", "UX Analysis Confidence: 85%"], "keyOpportunities": ["UX opportunity 1"], "keyThreats": ["UX threat 1"], "metadata": {"competitorCount": 2, "generatedAt": "2025-07-10T11:37:52.578Z", "productName": "Mock Product", "template": "UX_ENHANCED", "uxAnalysisIncluded": true, "version": "1.0"}, "sections": [{"content": "Comprehensive executive summary of competitive analysis", "id": "executive-summary", "order": 1, "title": "Executive Summary", "type": "executive_summary"}, {"content": "Detailed feature comparison analysis", "id": "feature-comparison", "order": 2, "title": "Feature Analysis", "type": "feature_comparison"}, {"content": "In-depth UX comparison and recommendations", "id": "ux-analysis", "order": 3, "title": "User Experience Analysis", "type": "ux_analysis"}, {"content": "Market positioning and competitive landscape analysis", "id": "positioning-analysis", "order": 4, "title": "Market Positioning", "type": "positioning_analysis"}, {"content": "Actionable UX recommendations based on competitive analysis", "id": "strategic-ux-recommendations", "order": 5, "title": "Strategic UX Recommendations", "type": "recommendations"}, {"content": "Supporting data and methodology", "id": "appendix", "order": 6, "title": "Data Appendix", "type": "appendix"}], "title": "Mock UX Enhanced Report"}, "tokensUsed": 600, "warnings": []}

      441 |       );
      442 |
    > 443 |       await expect(
          |             ^
      444 |         service.generateUXEnhancedReport(
      445 |           mockAnalysis,
      446 |           mockProduct,

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.expect (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:443:13)

  ‚óè ComparativeReportService - UX Enhancement ‚Ä∫ generateUXEnhancedReport ‚Ä∫ should limit competitors to maximum of 5

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: Anything, Anything, ObjectContaining {"maxCompetitors": 5}

    Number of calls: 0

      503 |
      504 |       // Verify that maxCompetitors option was set to 5
    > 505 |       expect(mockUXAnalyzer.analyzeProductVsCompetitors).toHaveBeenCalledWith(
          |                                                          ^
      506 |         expect.anything(),
      507 |         expect.anything(),
      508 |         expect.objectContaining({

      at Object.toHaveBeenCalledWith (src/__tests__/unit/services/reports/comparativeReportService.ux.test.ts:505:58)

FAIL src/services/analysis/__tests__/userExperienceAnalyzer.test.ts
  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should generate UX analysis successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Test product shows strong UX fundamentals with room for improvement"
    Received: "Mock UX analysis summary"

      87 |
      88 |       expect(result).toBeDefined();
    > 89 |       expect(result.summary).toBe('Test product shows strong UX fundamentals with room for improvement');
         |                              ^
      90 |       expect(result.strengths).toEqual(['Clean design', 'Fast loading']);
      91 |       expect(result.weaknesses).toEqual(['Limited mobile optimization', 'Unclear navigation']);
      92 |       expect(result.opportunities).toEqual(['Mobile-first redesign', 'Enhanced accessibility']);

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:89:30)

  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should handle analysis options correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 2

      113 |
      114 |       expect(result).toBeDefined();
    > 115 |       expect(result.metadata.competitorCount).toBe(1);
          |                                               ^
      116 |     });
      117 |
      118 |     it('should limit competitors based on maxCompetitors option', async () => {

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:115:47)

  ‚óè UserExperienceAnalyzer ‚Ä∫ analyzeProductVsCompetitors ‚Ä∫ should handle malformed AI responses gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "Analysis completed but response format was invalid"
    Received: "Mock UX analysis summary"

      161 |
      162 |       expect(result).toBeDefined();
    > 163 |       expect(result.summary).toBe('Analysis completed but response format was invalid');
          |                              ^
      164 |       expect(result.confidence).toBe(0.3);
      165 |       expect(result.recommendations).toEqual(['Review analysis input data and retry']);
      166 |     });

      at Object.toBe (src/services/analysis/__tests__/userExperienceAnalyzer.test.ts:163:30)

FAIL src/services/reports/__tests__/asyncReportProcessingService.test.ts
  ‚óè Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/workers/ChildProcessWorker.js:181:21)

FAIL src/__tests__/integration/reports.test.ts
  ‚óè Test suite failed to run

    Cannot find module '../../pages/api/reports' from 'src/__tests__/integration/reports.test.ts'

      49 | jest.mock('next-auth');
      50 |
    > 51 | describe('/api/reports', () => {
         |                                 ^
      52 |   let mockPrisma: any;
      53 |   let mockPrismaDefault: any;
      54 |

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (src/__tests__/integration/reports.test.ts:51:57)


Test Suites: 31 failed, 40 passed, 71 total
Tests:       235 failed, 777 passed, 1012 total
Snapshots:   0 total
Time:        53.585 s
Ran all test suites.
‚úÖ Global test teardown complete - Phase 2 optimized
